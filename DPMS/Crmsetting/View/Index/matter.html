<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}bootstrap/css/bootstrap3.3.7.min.css">
    <link type="text/css" rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}font-awesome-4.7.0/css/font-awesome.css" />
    <!-- text fonts -->
    <!--<link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}ace/css/ace-fonts.css" />-->
    <link href="{$Think.const.CSS_URL}EIMPublicTools.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}layim3.0/3.7.6/css/layui.css" media="all">
    <!--数据交互-->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}vue/axios.min0.17.0.js"></script>
    <title>待处理事项</title>
    <style>
        .dataTables_footer {
            border-bottom: 1px solid #e0e0e0;
            padding-top: 12px;
            padding-bottom: 12px;
            background-color: #EFF3F8;
            margin-top: -18px;
        }

        .orderColor {
            color: red;
        }

        .closebtn {
            float: right;
            display: inline-block;
            font-size: 16px;
            width: 10px;
            height: 10px;
            line-height: 10px;
            margin-right: 5px;
        }

        .no-data {
            background: #f9f9f9;
            line-height: 24px;
            margin-top: -18px;
        }
    </style>
    <script>
        var __URL = '__APP__/';
    </script>
    <script>
        function openappinfo(i) {
            //console.log(data);
            if (parent.allData[i].appid == 'eim-43' || parent.allData[i].appid=='eim-44') {
                var url = '/index.php/Crmschedule/Clue/selectdetailed?id=' + parent.allData[i].dataid + '&guid=' + parent.allData[i].guid + '&datauserid=' + parent.allData[i].userid;
                if (parent.allData[i].appid == "eim-44") {
                    url = '/index.php/Crmschedule/Record/selectdetailed?id=' + parent.allData[i].dataid + '&guid=' + parent.allData[i].guid + '&datauserid=' + parent.allData[i].userid;
                }
                //修改未读状态为已读状态
                editHoverad(i);
                parent.YL.open('eimselectdetailed', {
                    title:  parent.allData[i].title,
                    url:url 
                });
               
            } else {
                parent.YL.open(parent.allData[i].appid);
            }


        }
        //修改未读状态为已读状态
        function editHoverad(i) {
            var del_div = document.getElementById('li_' + i);
            var parent_div = document.getElementById('matterData');
            if (del_div) {
                parent_div.removeChild(del_div);
            }
            if (parent.allData[i]._id.length > 0) {
                for (var id in parent.allData[i]._id) {
                    var param = new URLSearchParams();
                    param.append('_id',parent. allData[i]._id[id]);
                    param.append('haveread', '0');
                    axios.post('/index.php/Crmhistorymessageboard/Historymessageboard/update_page_data', param)
                         .then(function (data) {
                             
                         });
                };
            }
        }

        window.onload = function () {
            var list = document.getElementById("matterData");
            console.log(parent.allData);
            for (var i = 0; i < parent.allData.length; i++) {
                if (parent.allData[i].badge != 0) {
                   //如果角标不为0就要追加html了                 
                    list.innerHTML += '<li id="li_'+i+'">您有' + parent.allData[i].badge + '条' + parent.allData[i].status + '的' + parent.allData[i].name + '，请点击< <b style="color:red;cursor:pointer;" onclick="openappinfo(\''+i+'\')">' + parent.allData[i].title + '</b> >查看</li>';
                }
            }          
        }
    </script>
</head>
<body>
    <div id="main-container" class="main-container">
        <div class="main-content">
            <div class="page-content">
                <div class="col-xs-12">
                    <div class="page-header clearfix">
                        <h1 class="text-left">
                            &nbsp;{$MenuName}
                            <small>
                                <i class="ace-icon fa fa-angle-double-right"></i>
                                {$PageName}
                            </small>
                        </h1>
                    </div>
                </div>                
                <div class="col-xs-12">
                    <ul class="layui-timeline">
                        <li class="layui-timeline-item">
                            <i class="layui-icon layui-timeline-axis"></i>
                            <br />
                            <div class="layui-timeline-content layui-text">
                                <ul id="matterData">
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script src="{$Think.const.BOOTSTRAP_URL}layim3.0/3.7.6/layui.js" charset="utf-8"></script>
