<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if lt IE 9]>
    <script type="text/javascript" src="{$Think.const.APP_PUBLIC}html5.js"></script>
    <script type="text/javascript" src="{$Think.const.APP_PUBLIC}respond.min.js"></script>
    <script type="text/javascript" src="{$Think.const.APP_PUBLIC}PIE_IE678.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}bootstrap/css/bootstrap3.3.7.min.css" />
    <!--<link href="{$Think.const.APP_PUBLIC}lib/Hui-iconfont/{$Think.const.CSS_ICON_VERSION}/iconfont.css" rel="stylesheet" type="text/css" />-->
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}ace/css/ace.css" class="ace-main-stylesheet" id="main-ace-style" />
    <link type="text/css" rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}font-awesome-4.7.0/css/font-awesome.css" />
    <!-- text fonts -->
    <!--<link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}ace/css/ace-fonts.css" />-->
    <link rel="stylesheet" href="{$Think.const.CSS_URL}EIMPublicTools.css" />
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}vue/axios.min0.17.0.js"></script>
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}angular/1.4.6/angular.min.js"></script>
    <script>
        var __URL = '__APP__/';
        var table;
        var _dt_pagelength = parseInt("{$_SESSION['PagedataCount']}");
    </script>
    <script>

        var app = angular.module('userlistModule', []);
        app.controller('userlistController', ['$scope', '$http', function ($scope, $http) {
            axios.post(__URL + 'Eimbase/Logportcurrent/async_get_port_current_angular', {})
              .then(function (response) {
                  $scope.$apply(function () {
                      $scope.portcurrent = response.data;
                  });
              })
        }]);


    </script>
    <script>
        var app = angular.module('app', ['ui.grid', 'ui.grid.selection', 'ui.grid.edit', 'ui.grid.grouping',
            'ui.grid.exporter', 'ui.grid.pagination', 'ui.grid.resizeColumns', 'ui.grid.autoResize', 'ui.grid.treeBase']);

        app.controller('MainCtrl', ['$scope', 'i18nService', 'uiGridGroupingConstants', 'uiGridConstants', function ($scope, i18nService, uiGridGroupingConstants, uiGridConstants) {
            // 国际化；
            i18nService.setCurrentLang("zh-cn");

            treeRowHeaderAlwaysVisible: false,
            $scope.gridOptions = {

                enableFiltering:true,//是否可筛选
                enablePagination: true, //是否分页，默认为true
                enablePaginationControls: true, //使用默认的底部分页
                paginationPageSizes: [10, 15, 20, 50, 100, 500, 1000], //每页显示个数可选项
                paginationCurrentPage: 1, //当前页码
                paginationPageSize: 1000, //每页显示个数

                enableSorting: true, //是否排序
                useExternalSorting: false, //是否使用自定义排序规则
                enableGridMenu: true, //是否显示grid 菜单
                showGridFooter: true, //是否显示grid footer
                enableHorizontalScrollbar: 1, //grid水平滚动条是否显示, 0-不显示  1-显示
                enableVerticalScrollbar: 0, //grid垂直滚动条是否显示, 0-不显示  1-显示



                //----------- 选中 ----------------------
                enableFooterTotalSelected: true, // 是否显示选中的总数，默认为true, 如果显示，showGridFooter 必须为true
                enableFullRowSelection: true, //是否点击行任意位置后选中,默认为false,当为true时，checkbox可以显示但是不可选中
                enableRowHeaderSelection: true, //是否显示选中checkbox框 ,默认为true
                enableRowSelection: true, // 行选择是否可用，默认为true;
                enableSelectAll: true, // 选择所有checkbox是否可用，默认为true;
                enableSelectionBatchEvent: true, //默认true
                isRowSelectable: function (row) { //GridRow
                    if (row.entity.age > 45) {
                        row.grid.api.selection.selectRow(row.entity); // 选中行
                    }
                },
                modifierKeysToMultiSelect: false,//默认false,为true时只能 按ctrl或shift键进行多选, multiSelect 必须为true;
                multiSelect: true,// 是否可以选择多个,默认为true;
                noUnselect: false,//默认false,选中后是否可以取消选中
                selectionRowHeaderWidth: 30,//默认30 ，设置选择列的宽度；

                //--------------导出----------------------------------
                exporterAllDataFn: function () {
                    return getPage(1, $scope.gridOptions.totalItems);
                },
                exporterCsvColumnSeparator: ',',
                exporterCsvFilename: 'download.csv',
                exporterFieldCallback: function (grid, row, col, value) {
                    if (value == 50) {
                        value = "可以退休";
                    }
                    return value;
                },
                exporterHeaderFilter: function (displayName) {
                    return 'col: ' + name;
                },
                exporterHeaderFilterUseName: true,
                exporterMenuCsv: true,
                exporterMenuLabel: "Export",
                exporterMenuPdf: true,
                exporterOlderExcelCompatibility: false,
                exporterPdfCustomFormatter: function (docDefinition) {
                    docDefinition.styles.footerStyle = { bold: true, fontSize: 10 };
                    return docDefinition;
                },
                exporterPdfFooter: {
                    text: 'My footer',
                    style: 'footerStyle'
                },
                exporterPdfDefaultStyle: {
                    fontSize: 11, font: 'simblack' //font 设置自定义字体
                },
                exporterPdfFilename: 'download.pdf',
                /* exporterPdfFooter : {
                 columns: [
                   'Left part',
                   { text: 'Right part', alignment: 'right' }
                 ]
                },
                或 */
                exporterPdfFooter: function (currentPage, pageCount) {
                    return currentPage.toString() + ' of ' + pageCount;
                },
                exporterPdfHeader: function (currentPage, pageCount) {
                    return currentPage.toString() + ' of ' + pageCount;
                },
                exporterPdfMaxGridWidth: 720,
                exporterPdfOrientation: 'landscape',//  'landscape' 或 'portrait' pdf横向或纵向
                exporterPdfPageSize: 'A4',// 'A4' or 'LETTER'
                exporterPdfTableHeaderStyle: {
                    bold: true,
                    fontSize: 12,
                    color: 'black'
                },
                exporterPdfTableLayout: null,
                exporterPdfTableStyle: {
                    margin: [0, 5, 0, 15]
                },
                exporterSuppressColumns: ['buttons'],
                exporterSuppressMenu: false,

                //---------------api---------------------
                onRegisterApi: function (gridApi) {
                    $scope.gridApi = gridApi;
                    //分页按钮事件
                    gridApi.pagination.on.paginationChanged($scope, function (newPage, pageSize) {
                        if (getPage) {
                            getPage(newPage, pageSize);
                        }
                    });
                    //行选中事件
                    $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row, event) {
                        if (row) {
                            $scope.testRow = row.entity;
                        }
                    });
                }

            };

            $scope.gridOptions.columnDefs = [
              { name: 'id',displayName: '名称', width: 50, enableFiltering: true },
              { name: 'name', width: 100, pinnedLeft: true, enableFiltering: true },
              {
                  name: 'age', width: 100, pinnedRight: true, enableFiltering: true ,
                  grouping: { groupPriority: 2 },
                  cellFilter: 'groupCompany1'
              },
              { name: 'address.street', width: 150, enableFiltering: true },
              {
                  name: 'address.city', width: 150,
                  grouping: { groupPriority: 1 },
                  cellFilter: 'groupCompany', enableFiltering: true
              },
              { name: 'address.state', width: 50, enableFiltering: true },
              { name: 'address.zip', width: 50, enableFiltering: true },
              { name: 'company', width: 100, enableFiltering: true },
              { name: 'email', width: 100, enableFiltering: true },
              { name: 'phone', width: 200, enableFiltering: true },
              { name: 'about', width: 300, enableFiltering: true },
              { name: 'friends[0].name', displayName: '1st friend', width: 150, enableFiltering: true },
              { name: 'friends[1].name', displayName: '2nd friend', width: 150, enableFiltering: true },
              { name: 'friends[2].name', displayName: '3rd friend', width: 150, enableFiltering: true },
            ];

            axios.post(__URL + 'Eimbase/Logportcurrent/async_get_port_current_angular', {})
             .then(function (response) {
                 $scope.gridOptions.data = response.data;

             });

            var getPage = function (curPage, pageSize) {
                var firstRow = (curPage - 1) * pageSize;
                $scope.gridOptions.totalItems = $scope.gridOptions.data.length;
                $scope.gridOptions.data = $scope.gridOptions.data.slice(firstRow, firstRow + pageSize);
                //或者像下面这种写法
                //$scope.myData = mydefalutData.slice(firstRow, firstRow + pageSize);
            };

            getPage(1, $scope.gridOptions.paginationPageSize);

            $scope.randomSize = function () {
                var newHeight = Math.floor(Math.random() * (300 - 100 + 1) + 300);
                var newWidth = Math.floor(Math.random() * (600 - 200 + 1) + 200);

                angular.element(document.getElementsByClassName('grid')[0]).css('height', newHeight + 'px');
                angular.element(document.getElementsByClassName('grid')[0]).css('width', newWidth + 'px');
            };
        }]);

        app.filter('groupCompany', function () {
            var genderHash = {
                'Herlong': '不清楚 ',
                'Leyner': '不知道',
                'Roland': '不了解',
                'Connerton': '是哪里',
                'Blairstown': '是哪里1',
            };

            return function (input) {
                var result;
                var match;
                if (!input) {
                    return '';
                } else if (result = genderHash[input]) {
                    return result;
                } else if ((match = input.match(/(.+)( \(\d+\))/)) && (result = genderHash[match[1]])) {
                    return result + match[2];
                } else {
                    return input;
                }
            };
        });
        app.filter('groupCompany1', function () {
            var genderHash = {
                38: '不清楚 ',
                22: '不知道',
                35: '不了解',
                40: '是哪里',
                55: '是哪里1',
            };

            return function (input) {
                var result;
                var match;
                if (!input) {
                    return '';
                } else if (result = genderHash[input]) {
                    return result;
                } else if ((match = input.match(/(.+)( \(\d+\))/)) && (result = genderHash[match[1]])) {
                    return result + match[2];
                } else {
                    return input;
                }
            };
        });

    </script>
    <title>端口电流日志</title>
</head>
<body ng-app="userlistModule">
    <div class="container-fluid" ng-controller="userlistController">
        <div class="row-fluid top-10">
            <div class="page-header clearfix">
                <h1 class="col-xs-3 text-left">
                    {$MenuName}
                    <small>
                        <i class="ace-icon fa fa-angle-double-right"></i>
                        {$PageName}
                    </small>
                </h1>
                <div class="col-xs-4 text-center">


                </div>
            </div>
            <div class="well well-sm">
                <form id="formlog">
                    <label>日期范围：</label>
                    <input type="text" name="sTime" value="{$stime}" onfocus="WdatePicker({maxDate:'#F{ $dp.$D(\'txtetime\')||\'%y-%M-%d\'}'})" id="txtstime" class="input-text Wdate radius" style="width: 120px;">
                    -
                    <input type="text" name="eTime" value="{$etime}" onfocus="WdatePicker({minDate:'#F{ $dp.$D(\'txtstime\')}'})" id="txtetime" class="input-text Wdate radius" style="width: 120px;">
                    <label>&nbsp;&nbsp;DPU名称：</label>
                    <span class="select-box radius" style="width:150px;">
                        <select id="seldpu" name="Dpus" class="select radius" onchange="dpuchange(this);" dpuvalue="{$seldpuname}"></select>
                    </span>
                    <span class="select-box radius" style="width:100px;">
                        <select id="selport" name="Ports" class="select radius" portvalue="{$selport}"></select>
                    </span>
                    <label>&nbsp;&nbsp;电流值>=</label>
                    <input type="text" id="txtsvalue" name="sValue" value="{$sValue}" class="input-text radius" style="width: 50px" placeholder="电流值">
                    <label>&nbsp;&nbsp;电流值<=</label>
                    <input type="text" id="=txtevalue" name="eValue" value="{$eValue}" class="input-text radius" style="width: 50px" placeholder="电流值">
                    <input type="text" name="PageNow" value="{$now_page}" id="nowpage" style="display:none">
                    <div class="f-r">
                        {$_SESSION['operation_button']['btn100127']['btn_value']}
                    </div>
                </form>
            </div>
        </div>

        <div class="row-fluid " style="background:#eee">
            <div class="table-header">
                系统日志 <small><i class="ace-icon fa fa-angle-double-right"></i>端口电流日志</small>
            </div>
            <table id="table_port_current" class="table table-condensed table-hover table-striped table-sort table-bordered"></table>
        </div>


        <div class="row" style="background:#eee">
            <div ui-grid="gridOptions" class="col-xs-12 grid" ui-grid-edit ui-grid-auto-resize ui-grid-exporter ui-grid-resize-columns ui-grid-pagination></div>
        </div>
        
    </div>


</body>
</html>
