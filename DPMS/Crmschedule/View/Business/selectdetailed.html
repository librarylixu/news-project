<extend name="angular-base.html" />
<block name="momentjs">

</block>
<block name="headcss">

    <style>
        .table tr td {
            border: 1px solid #ccc;
            background-color: #fff;
            padding-left: 12px;
            padding-right: 12px;
            padding-top: 6px;
            padding-bottom: 6px;
            box-sizing: border-box;
            word-break: break-all;
            line-height: 20px;
            color: #666;
        }

        .box p {
            display: inline;
        }
        
        @media print {
            .noprint {
                display: none;
            }
        }
        @page {
            size: auto; /* auto is the initial value */
            margin-bottom: 0mm; /* this affects the margin in the printer settings */
        }
        i{
            font-style:normal;
        }
        i b{
            font-style:italic;
        }
         .form-control.ta-scroll-window{
             min-height:80px;
             height:auto;
             clear:both;
         }
    </style>
</block>
<block name="headjs">
    <script src="{$Think.const.BOOTSTRAP_URL}angular-sanitize/{$Think.const.ANGULAR_VERSION}angular-sanitize.min.js"></script>
    <script src="{$Think.const.BOOTSTRAP_URL}angular-file-upload/angular-file-upload.min.js"></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-rangy.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-sanitize.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular.min.js'></script>
    <script>
        var _id = '{$id}';
        //存一份userid
        var _userid = "{$userid}";
    </script>
</block>
<block name="pageContent">
    <!--页头-->
    <main class="js-canvi-content canvi-content">
        <div class="container" style="font-family: 微软雅黑;width:1000px;">
            <div class="row">
                <div class="page-header clearfix col-xs-12" style="padding:30px 30px; border-bottom-style: solid; ">
                    <h1 class="col-xs-3 text-left" style="width:100%;">
                        {$MenuName}
                        <small>
                            <i class="ace-icon fa fa-angle-double-right"></i>
                            {$PageName}
                        </small>
                    </h1>
                    <div class="col-xs-4 text-right noprint f-r">
                        <a ng-click="print()" class="btn btn-warning btn-sm">
                            <!-- 此处可暂时保留原方法（防止带有编辑/添加/删除等按钮） -->
                            <i class="ace-icon fa fa-print"></i>&nbsp;打印
                        </a>
                        <a ng-click="refresh()" class="btn btn-success btn-sm">
                            <!-- 此处可暂时保留原方法（防止带有编辑/添加/删除等按钮） -->
                            <i class="glyphicon glyphicon-refresh"></i>&nbsp;刷新
                        </a>
                    </div>
                </div>
            </div>
            <div class="row">
                <h3 class="col-xs-3 text-left" style="width:60%; margin-bottom:20px;">
                    出差名称:
                    <small>
                        <span ng-bind="businessData.name"></span>
                    </small>
                </h3>
            </div>
            <div class="row">
                <table class="table" style="width:1000px;">
                    <tr class="info">
                        <td colspan="4">基本信息</td>
                    </tr>
                    <tr>
                        <td class="text-right" style="width:150px">出差人</td>
                        <td style="width:370px">
                            <span ng-bind="service.privateDateObj.usersData[businessData.userid].description"></span>
                        </td>
                        <td class="text-right" style="width:150px">创建时间</td>
                        <td style="width:370px">
                            <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                            <span ng-bind="formatDate(businessData.createtime)"></span>
                        </td>

                    </tr>
                    <tr>
                        <td class="text-right">关联客户</td>
                        <td>
                            <span ng-repeat="item in businessData.refcustomerid.split(',') track by $index">
                                <span ng-if="service.privateDateObj.customerinfoData[item]" ng-bind="service.privateDateObj.customerinfoData[item].name"></span><i ng-if="businessData.refcustomerid.length>1&&$index!==businessData.refcustomerid.split(',').length-1">；</i>
                            </span>
                        </td>
                        <td class="text-right">关联项目</td>
                        <td>
                            <span ng-repeat="item in businessData.refprojectid.split(',')  track by $index">
                                <span ng-if="service.privateDateObj.projectData[item]" ng-bind="service.privateDateObj.projectData[item].name"></span><i ng-if="businessData.refprojectid.length>1&&$index!==businessData.refprojectid.split(',').length-1">；</i>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">联系人</td>
                        <td>
                            <span ng-repeat="item in contactData track by $index">
                                <span ng-if="item" ng-bind="item.name"></span>(职位：<span ng-bind="item.position"></span>;&nbsp;联系方式：<span ng-bind="item.mobilephone"></span>)
                            </span>
                        </td>
                        <td class="text-right">出差地点</td>
                        <td>
                            <span ng-if="businessData.place" ng-bind="businessData.place"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">出差审批人</td>
                        <td>
                            <b ng-bind="service.privateDateObj.usersData[businessData.assignid].description"></b>
                        </td>
                        <td class="text-right" style="width:15%;">预计结束时间</td>
                        <td>
                            <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                            <span ng-bind="formatDate(businessData.estimatetime,'yyyy-mm-dd')"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">开始时间</td>
                        <td>
                            <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                            <span ng-bind="formatDate(businessData.starttime,'yyyy-mm-dd')"></span>
                        </td>
                        <td class="text-right">结束时间</td>
                        <td>
                            <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                            <span ng-bind="formatDate(businessData.endtime)"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right" style="width:150px">当前状态</td>
                        <td style="width:370px">
                            <span class="label" ng-class="service.privateDateObj.businessstatusData[businessData.status].type" ng-bind="service.privateDateObj.businessstatusData[businessData.status].name"></span>
                        </td>
                        <td class="text-right" style="width:150px">抄送</td>
                        <td style="width:370px">
                            <span class="label c-info" style="margin-right:3px;display:inline-block" ng-repeat="item in businessData.refusers.split(',')  track by $index" ng-bind="service.privateDateObj.usersData[item].username+':'+service.privateDateObj.usersData[item].description" ng-if="businessData.refusers && businessData.refusers.length > 0"></span>
                            <span class="label c-info" style="margin-right:3px;display:inline-block" ng-if="businessData.refusers == null">暂无抄送人</span>
                        </td>
                    </tr>
                    <tr class="info">
                        <td colspan="4"><b>出差描述</b></td>
                    </tr>
                    <tr style="height:100px;">
                        <td colspan="4">
                            <div class="left-10 top-10" ng-bind-html="businessData.mark"></div>
                        </td>
                    </tr>
                    <tr class="info">
                        <td colspan="4"><b>审批备注</b></td>
                    </tr>
                    <tr style="height:100px;">
                        <td colspan="4">
                            <div class="left-10 top-10" ng-bind-html="businessData.statusmark"></div>
                        </td>
                    </tr>
                    <tr class="info">
                        <td colspan="3" style="border-right: none"><b>出差报告</b></td>
                        <td class="text-right" style="border-left: none;">
                            <a ng-if="businessData.status==1&&service.userid==businessData.userid" ng-click="changeupdate()" class="btn btn-success btn-xs noprint"><i class="glyphicon glyphicon-pencil"></i>&nbsp;编辑</a>
                            <a ng-if="businessData.status==1&&service.userid==businessData.userid&&contentchange" ng-click="changeremove()" class="btn btn-success btn-xs noprint"><i class="glyphicon glyphicon-remove"></i>&nbsp;关闭</a>
                        </td>
                    </tr>
                    <tr style="height:100px;">
                        <td colspan="4">
                            <div class="left-10 top-10" ng-if="disabled" ng-bind-html="businessDataMessage.message"></div>
                            <!--<div text-angular="text-angular" ng-if="!disabled" ng-model="businessDataMessage.message"></div>-->
                            <!-- 加载编辑器的容器 -->
                            <script class="col-xs-12" style="padding: 0px;" id="tailedcontainer" name="content" type="text/plain">
                            </script>
                        </td>
                    </tr>
                </table>
                <div class="text-right clearfix noprint col-xs-12">
                    <div class="f-r" ng-if="businessData.status==1&&service.userid==businessData.userid">
                        <!--<a ng-if="disabled == false" ng-click="changeTrue();saveResultdescription();"
                           class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;保存</a>-->
                        <a ng-if="disabled == false" ng-click="alertUpload('1')" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;保存并提交</a>
                    </div>
                    <div class="f-r" ng-if="service.userid==businessData.assignid">                       
                        <a ng-if="businessData.status==3&&disabled == true" ng-click="alertUpload('2')" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;完成出差</a>
                        <a ng-if="businessData.status==0" ng-click="alertConfirm(businessData)" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;审批</a>
                    </div>
                </div>
                &nbsp;
                &nbsp;
            </div>
        </div>
    </main>
    <!-- 审批模态框 -->
    <aside class="approvalmodaltemplate canvi-navbar">
        <div class="canvi-user-info">
            <div class="canvi-user-info__data">
                <span class="canvi-user-info__title" ng-bind="approvalModal.title"></span>
                <!--<a href="#" class="canvi-user-info__meta">XXXX编辑</a>-->
                <div class="canvi-user-info__close" ng-click="approvalModal.toggle();"></div>
            </div>

        </div>
        <div>
            <form name="Form" class="container-fluid" verify-scope="tipStyle: 0">
                <div class="row" style="line-height:28px;">
                    <label class="col-xs-3 text-right">出差名称：</label>
                    <small ng-bind="selectItem.name"></small>
                </div>
                <div class="row" style="line-height:28px;">
                    <label class="col-xs-3 text-right">出差人：</label>
                    <small ng-bind="service.privateDateObj.usersData[selectItem.userid].description"></small>
                </div>
                <div class="row" style="line-height:28px;">
                    <label class="col-xs-3 text-right"><b class="c-red">*</b>审批结果：</label>
                    <input type="radio" class="radio-inline" ng-model="selectItem.status" value="1" />同意
                    <input type="radio" class="radio-inline" ng-model="selectItem.status" value="2" />驳回
                </div>
                <div class="row" style="line-height:28px;">
                    <label class="col-xs-3 text-right">审批备注：</label>
                    <textarea class="form-control" ng-model="selectItem.statusmark" placeholder="选填项"></textarea>
                </div>
                &nbsp;
                <div class="col-xs-12 text-center">
                    <button class="btn btn-primary btn-sm" ng-verify="control:'Form'" type="button" ng-click="save(selectItem.idbusiness)" title="请检查数据是否正确填写！">
                        保存
                    </button>
                    <button class="btn btn-warning btn-sm" type="button" ng-click="approvalModal.close();">取消</button>
                </div>
            </form>
        </div>
    </aside>   
</block>

<block name="scriptTemplate">

</block>

<block name="footjs">
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmschedule/Business/detailmodal.js?v={$Think.const.CRM_VERSION}"></script>
    <!-- 配置文件 -->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.all.js"></script>
</block>
