<extend name="angular-base.html" />
<block name="momentjs">
</block>
<block name="headcss">
  
</block>
<block name="headjs">
    <!--select start-->
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select.css">
    <script src="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select.js"></script>
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select2.css">
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/selectize.default.css">
    <!--select end-->
    <link rel="stylesheet" href="{$Think.const.PAGE_URL}css/crmSchedule/Workerorder/workerorder.css" /><!-- 这里公用了工单css -->
    <link rel="stylesheet" href="{$Think.const.CSS_URL}upload.css" />   
    <script src="{$Think.const.BOOTSTRAP_URL}angular-file-upload/angular-file-upload.min.js"></script>
    <script src="{$Think.const.BOOTSTRAP_URL}angular-waterfall-master/angular-waterfall.js"></script>
    <script>
        var userid = "{$userid}";
    </script>
</block>
<block name="pageContent">
    <main class="js-canvi-content canvi-content">
        <div class="col-xs-12">
            <!--操作区域-->
            <div class="btn-box">
                <page-btn></page-btn>
                <!--展示检索条件区域-->
                <div class="search-box">
                    <!--<select class="select" ng-model="status" ng-options="v.name for v in statusData" ng-change="addTags('status');"><option value="" ng-selected=""></option></select>-->
                    <ui-select multiple ng-model="service.refcustomer" theme="select2" on-select="addTags('refcustomer',$item)">
                        <ui-select-match placeholder="检索客户属性" ng-bind=""></ui-select-match>
                        <ui-select-choices repeat="person.value as (key, person) in service.refcustomerallData | filter: { value: { name: $select.search }} track by $index">
                            <div ng-bind-html="person.value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                    <select class="select" ng-model="user" ng-options="v.description for (k,v) in selectUserData" ng-change="addTags('user');">
                        <option value='' disabled selected style='display:none;' ng-selected="">下拉检索创建人</option>
                    </select>
                    <span class="input-search">
                        <input type="text" placeholder="标题检索 ..." class="search-input "  ng-model="filtername">
                        <i class="fa fa-search search-icon"></i>
                    </span>
                </div>
            </div>
            <!--条件检索区-->
            <div class="text-right">
                <span class="tag" ng-repeat="item in tagsData" ng-class="item.key">
                    <span ng-if="item.key!='userid'" ng-bind="item.value.name"></span>
                    <span ng-if="item.key=='userid'" ng-bind="item.value.description"></span>
                    <button type="button" class="close" ng-click="removeTag(item)">×</button>
                </span>
            </div>
        </div>
        <!--表格展示区-->
        <div class="col-xs-12">
            <div class="text-right">
                共<b class="blue" ng-if="service.privateDateObj.customerinfoData" ng-bind="service.customerinfoDataArr.length"></b>条客户信息
                <!--<div ng-include="'__APP__/Crmbase/Baseinfo/setpaging'"></div>-->
            </div>
            <table class="table" ng-init="customerinfoDataCount={count:0};orderName = '-createtime'" style="margin-bottom:2px;">
                <thead>
                    <tr>
                        <th style="width:5%;">序号</th>
                        <th style="width:20%;" class="mousehand" ng-click="orderName=(orderName=='name'?'-name':'name')">客户名称<i class="fa" ng-class="orderName=='name'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:30%;">
                            <span class="mousehand">
                                客户属性
                            </span>
                        </th>
                        <th class="mousehand" style="width:10%;" ng-click="orderName=(orderName=='userid'?'-userid':'userid')">创建人<i class="fa" ng-class="orderName=='userid'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th class="mousehand" style="width:15%;" ng-click="orderName=(orderName=='-createtime'?'createtime':'-createtime')">创建时间<i class="fa" ng-class="orderName=='-createtime'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:30%;">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <!--ng-class="item.assignid==service.userid?'bg-pink-red':''"-->
                    <tr ng-repeat="(key,item) in service.customerinfoDataArr | orderBy:orderName |filterByAttr:filtername:customerinfoDataCount track by $index" class="profile-activity">
                        <td><span class="badge" ng-bind="key+1"></span></td>
                        <td>
                            <span>
                                <!-- 客户名称 -->
                                <i ng-if="item.icon" class="pull-left thumbicon {{item.icon}} no-hover"></i>
                                <a class="user" href="" ng-click="selectdetailed(item)" ng-bind="item.name"></a>
                            </span>
                        </td>
                        <td>
                            <!-- 客户属性 -->
                            <!-- 客户阶段 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customerstageData[item.refstageids].name"></span>
                            <!-- 市场大区 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customermarketData[item.refmarketids].name"></span>
                            <!-- 信用等级 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customercreditData[item.refcreditids].name"></span>
                            <!-- 客户状态 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customerstatusData[item.refstatusids].name"></span>
                            <!-- 客户类型 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customertypeData[item.reftypeids].name"></span>
                            <!-- 客户来源 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customersourceData[item.refsourceids].name"></span>
                            <!-- 客户行业 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customerindustryData[item.refindustryids].name"></span>
                            <!-- 客户级别 --><span class="label label-info left-5" ng-bind="service.privateDateObj.customerlevelData[item.reflevelids].name"></span>
                        </td>
                        <td>
                            <div>
                                <!-- 客户创建人 -->
                                <span class="label c-info" ng-bind="(service.privateDateObj.usersData[item.userid].description ? service.privateDateObj.usersData[item.userid].description :service.privateDateObj.usersData[item.userid].username)"></span>
                            </div>
                        </td>
                        <!--创建时间-->
                        <td>
                            <span ng-bind="formatDate(item.createtime,'yyyy-mm-dd')"></span>
                        </td>
                        <td>
                            <a href="javascript:;" ng-click="selectdetailed(item)" title="详细" class="btn btn-xs green"><i class="ace-icon fa fa-search"></i>&nbsp;详细</a>
                            <a href="javascript:;" ng-if="service.refedit && item.userid==service.userid" ng-click="updateInfo(item)" title="修改" class="btn btn-xs green"><i class="ace-icon fa fa-pencil "></i>&nbsp;修改</a>
                            <a href="javascript:;" ng-if="service.refdel  && item.userid==service.userid" ng-click="remove(item)" class="btn btn-xs  green"><i class="ace-icon fa fa-times"></i>&nbsp;删除</a>
                            <a href="javascript:;" ng-if="item.userid==service.userid" ng-click="openrecord(item)" class="btn btn-xs"><i class="ace-icon fa fa-book"></i>&nbsp;添加跟进记录</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!--<div class="text-right footer"><a href="javascrip:;">页面分页栏</a></div>-->
    </main>    
    <!--模态框-->
    <aside class="customerinfomodaltemplate canvi-navbar">
        <div class="canvi-user-info">
            <div class="canvi-user-info__image">
                <img src="{$Think.const.APP_PUBLIC}win10-ui/img/icon/group.png">
            </div>
            <div class="canvi-user-info__data">
                <span class="canvi-user-info__title" ng-bind="customerinfoModal.title"></span>
                <!--<a href="#" class="canvi-user-info__meta">XXXX编辑</a>-->
                <div class="canvi-user-info__close" ng-click="customerinfoModal.toggle();"></div>
            </div>
        </div>
        <div>
            <div>
                <form name="Form" class="container-fluid" verify-scope="">
                    <table class="table">
                        <!--基本信息-->
                        <tbody>
                            <tr class="info">
                                <td colspan="6">基本信息</td>
                            </tr>
                            <tr>
                                <td class="text-right tdmiddle" style="vertical-align: middle;">
                                    <span class="top-10">
                                        <b class="c-red">*(必填)</b>客户名称
                                    </span>

                                </td>
                                <td colspan="2">   
                                    <div class="input-group col-xs-12">
                                        <input type="text" class="form-control " ng-verify="min:1, max:25" ng-readonly="Action>1" id="check" ng-keyup="DoubleName=true" ng-model="selectItem.name" placeholder="输入1~25位字符名称">
                                        <span class="input-group-btn" title="用来检查当前客户是否已经被添加过">
                                            <a ng-show="DoubleName" href="javascript:;" class="btn btn-default c-red" ng-click="checkName()">
                                                <span class="glyphicon glyphicon-search"></span>
                                                客户查重
                                            </a>
                                        </span>
                                    </div><!-- /input-group -->
                                </td>
                                <td class="text-right" style="width: 15%; vertical-align: middle;">简称</td>
                                <td colspan="2">
                                    <input type="text"  ng-verify="{required:false,min:1, max:25}" class="form-control col-xs-12" ng-model="selectItem.abbreviation" placeholder="输入1~25位字符名称" />
                                </td>
                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;"><b class="c-red">*(必填)</b>办公电话</td>
                                <td colspan="2">
                                    <input type="text" class="form-control col-xs-12"
                                            ng-verify=""
                                            ng-model="selectItem.officephone" placeholder="输入电话号码" />
                                </td>
                                <td class="text-right" style="vertical-align: middle;">传真</td>
                                <td colspan="2">
                                    <input type="text" 
                                           ng-model="selectItem.fax" class="form-control col-xs-12" 
                                           placeholder="请输入传真号码（非必填）" />
                                </td>

                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;">网址</td>
                                <td colspan="5">
                                    <input ng-verify="{min:0,max:70 ,pattern:/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&:/~\+#]*[\w\-\@?^=%&/~\+#])?/,errmsg:'网址格式不正确',required:false}" 
                                           type="text" ng-model="selectItem.url" class="form-control" placeholder="请输入网址" />
                                </td>
                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;"><b class="c-red">*(必填)</b>客户地址</td>
                                <td colspan="5">
                                    <input type="text" ng-verify="pattern:/[\u4e00-\u9fa5]/, errmsg:'需要输入中文' " class="form-control" ng-model="selectItem.address" placeholder="请输入中文" />
                                </td>
                            </tr>
                        </tbody>
                        <!--类别信息-->
                        <tbody>
                            <tr class="info">
                                <td colspan="6">类别信息</td>
                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;">客户类型</td>
                                <td colspan="2">
                                    <ui-select style="width:100%" ng-model="selectItem.reftypeids">
                                        <ui-select-match placeholder="请选择客户类型">
                                            <span ng-bind="$select.selected.value.typename" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customertypeData | filter: { value: { typename: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.typename | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                                <td class="text-right" style="vertical-align: middle;">客户等级</td>
                                <td colspan="2">
                                    <ui-select style="width:100%" ng-model="selectItem.reflevelids">
                                        <ui-select-match placeholder="请选择客户等级">
                                            <span ng-bind="$select.selected.value.levelname" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customerlevelData | filter: { value: { levelname: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.levelname | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;">客户行业</td>
                                <td colspan="2">
                                    <ui-select style="width:100%" ng-model="selectItem.refindustryids">
                                        <ui-select-match placeholder="请选择客户行业">
                                            <span ng-bind="$select.selected.value.industryname" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customerindustryData | filter: { value: { industryname: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.industryname | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                                <td class="text-right" style="vertical-align: middle;">客户来源</td>
                                <td colspan="2">
                                    <!--<select style="width:100%" ng-options="item.idcustomersource as item.name for (key,item) in service.privateDateObj.customersourceData" ng-model="Source.selectItem.refsourceids"></select>-->
                                    <ui-select style="width:100%" ng-model="selectItem.refsourceids">
                                        <ui-select-match placeholder="请选择客户来源">
                                            <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customersourceData | filter: { value: { name: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>

                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;">所属区域</td>
                                <td colspan="2">
                                    <ui-select style="width:100%" ng-model="selectItem.refmarketids">
                                        <ui-select-match placeholder="请选择客户市场">
                                            <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customermarketData | filter: { value: { name: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                                <td class="text-right" style="vertical-align: middle;">信用等级</td>
                                <td colspan="2">
                                    <ui-select style="width:100%" ng-model="selectItem.refcreditids">
                                        <ui-select-match placeholder="请选择客户信用等级">
                                            <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customercreditData | filter: { value: { name: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-right" style="vertical-align: middle;">客户状态</td>
                                <td colspan="2">
                                    <ui-select style="width:100%" ng-model="selectItem.refstatusids">
                                        <ui-select-match placeholder="请选择客户状态">
                                            <span ng-bind="$select.selected.value.status" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customerstatusData | filter: { value: { status: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.status | highlight: $select.search"></div>
                                        </ui-select-choices> 
                                    </ui-select>
                                </td>
                                <td class="text-right" ng-if="0" style="vertical-align: middle;">客户省级</td>
                                <td colspan="2" ng-if="0">
                                    <ui-select style="width:100%" ng-model="selectItem.refmarketids">
                                        <ui-select-match placeholder="请选择客户市场">
                                            <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customermarketData | filter: { value: { name: $select.search }} " style="max-height: 150px;">
                                            <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                            </tr> 
                        </tbody>   
                        <!--客户联系人信息-->
                        <tbody>
                                <tr class="info">
                                    <td colspan="6" style="vertical-align: middle;">
                                    <span>
                                        <b class="c-red">*(必填)</b>客户联系人信息
                                    </span>
                                    <button type="button" ng-click="add_contact()" class="btn btn-xs btn-success f-r add_contactbtn">添加联系人</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <b class="c-red">*(必填)</b>
                                        姓名
                                    </td>
                                    <td>
                                        <b class="c-red">*(必填)</b>
                                        职位
                                    </td>
                                    <td>
                                        <b class="c-red">*(必填)</b>联系电话
                                    </td>
                                    <td>其他联系电话</td>
                                    <td>邮箱</td>
                                    <td>操作</td>
                                </tr>  
                            <tr ng-repeat="item in  selectItem.refcontactids" ng-if="service.privateDateObj.contactData[item]">
                                <td style="width: 15%; vertical-align: middle;">
                                    <span ng-bind="service.privateDateObj.contactData[item].name" ng-show="!service.privateDateObj.contactData[item]._edit"></span>
                                    <input type="text" class="form-control" ng-model="service.privateDateObj.contactData[item]._name" ng-show="service.privateDateObj.contactData[item]._edit" required="required" />
                                </td>
                                <td style="width: 10%; vertical-align: middle;">
                                    <span ng-bind="service.privateDateObj.contactData[item].position" ng-show="!service.privateDateObj.contactData[item]._edit"></span>
                                    <input type="text" class="form-control" ng-model="service.privateDateObj.contactData[item]._position" ng-show="service.privateDateObj.contactData[item]._edit" required="required" />
                                </td>
                                <td style="width: 20%; vertical-align: middle;">
                                    <span ng-bind="service.privateDateObj.contactData[item].mobilephone" ng-show="!service.privateDateObj.contactData[item]._edit"></span>
                                    <input type="text" class="form-control" ng-model="service.privateDateObj.contactData[item]._mobilephone" ng-show="service.privateDateObj.contactData[item]._edit" required="required" />
                                </td>
                                <td style="width: 20%; vertical-align: middle;">
                                    <span ng-bind="service.privateDateObj.contactData[item].phone" ng-show="!service.privateDateObj.contactData[item]._edit"></span>
                                    <input type="text" class="form-control" ng-model="service.privateDateObj.contactData[item]._phone" ng-show="service.privateDateObj.contactData[item]._edit" />
                                </td>
                                <td style="width: 20%; vertical-align: middle;">
                                    <span ng-bind="service.privateDateObj.contactData[item].email" ng-show="!service.privateDateObj.contactData[item]._edit"></span>
                                    <input type="text" class="form-control" ng-model="service.privateDateObj.contactData[item]._email" ng-show="service.privateDateObj.contactData[item]._edit" />
                                </td>
                                <td style="width: 15%; vertical-align: middle;">
                                    <button class="btn  btn-xs btn-info" type="button"
                                            ng-click="update_contact(item,true)"
                                            ng-show="!service.privateDateObj.contactData[item]._edit">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button class="btn  btn-xs btn-info" type="button"
                                            ng-click="update_contact(item,false)"
                                            ng-show="service.privateDateObj.contactData[item]._edit">
                                        <i class="fa fa-save"></i> 保存
                                    </button>
                                    <button class="btn  btn-xs btn-info" type="button"
                                            ng-click="del_contact(item,false)"
                                            ng-show="service.privateDateObj.contactData[item]._edit">
                                        <i class="fa fa-save"></i>取消
                                    </button>
                                    <button class="btn  btn-xs btn-warning" type="button" ng-show="!service.privateDateObj.contactData[item]._edit" ng-click="del_contact(item)"><i class="fa fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>   
                        <!--其他信息-->
                        <tbody>
                            <tr class="info">
                                <td colspan="6">其他信息</td>
                            </tr>
                            <tr>
                                <td class="text-right">抄送人</td>
                                <td colspan="5">
                                    <ui-select multiple ng-model="selectItem.refusers" theme="select2" style="width:100%;">
                                        <ui-select-match placeholder="请选择抄送">
                                            <span ng-bind="$item.value.description" style="margin-right: 5px;">
                                            </span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item.value.idusers  as (key,item) in service.privateDateObj.usersData | filter: { value: { description: $select.search }}" style="max-height: 150px;">
                                            <div ng-bind-html="item.value.description | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </td>
                            </tr>
                        </tbody>
                        <tbody>
                            <tr>
                                <td colspan="6" class="text-center">
                                    <button class="btn btn-primary" ng-disabled="saveone" ng-verify="control:'Form'" type="button" ng-click="save()" ng-if="Action<2" title="请检查数据是否正确填写">
                                        保存全部信息
                                    </button>
                                    <button class="btn btn-primary" type="button" ng-click="save();" ng-if="Action==2">删除</button>
                                    <button class="btn btn-warning" type="button" ng-click="customerinfoModal.close();">取消</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>          
        </div>
    </aside>
    <!-- 添加跟进记录模态框 -->
    <aside class="addRecordtemplate canvi-navbar">
        <div class="canvi-user-info">
            <div class="canvi-user-info__data">
                <span class="canvi-user-info__title" ng-bind="recordModal.title"></span>
                <!--<a href="#" class="canvi-user-info__meta">XXXX编辑</a>-->
                <div class="canvi-user-info__close" ng-click="recordModal.toggle();"></div>
            </div>

        </div>
        <div>
            <form name="Form" class="container-fluid" verify-scope="tipStyle: 0">
                <div class="row" style="line-height:28px;">
                    <label class="col-xs-3 text-right"><b class="c-red">*</b>跟进标题</label>
                    <input type="text" ng-verify="min:1, max:25" class="col-xs-4" ng-model="selectItem.title" placeholder="输入1~25位字符标题" />
                </div>
                <!--<div class="row top-10 clearfix" style="line-height:28px;">
                    <label class="col-xs-3 text-right"><b class="c-red">*</b>工单类型</label>
                    <div class="col-xs-8" style="padding: 0px;">
                        <ui-select ng-model="selectItem.type" ng-verify="option:0">
                            <ui-select-match placeholder="请选择工单类型">
                                <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                </span>
                            </ui-select-match>
                            <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.workordertypeData track by $index" style="max-height: 150px;">
                                <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>-->
                <div class="row top-10 clearfix" style="line-height:28px;">
                    <label class="col-xs-3 text-right"><b class="c-red">*</b>跟进内容</label>
                    <!--<div class="col-xs-8" style="padding: 0px;" text-angular="text-angular" placeholder="请在此输入问题描述" ng-model="selectItem.__mark"></div>-->
                    <!-- 加载编辑器的容器 -->
                    <script class="col-xs-8" style="padding: 0px;" id="container" name="content" type="text/plain">
                    </script>
                </div>
                <div class="row top-10" style="line-height:28px;">
                    <label class="col-xs-3 text-right">关联客户</label>
                    <div class="col-xs-8" style="padding: 0px;">
                        <ui-select ng-model="selectItem.refcustomerid" on-select="save_customer($item)">
                            <ui-select-match placeholder="请关联客户">
                                <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                </span>
                            </ui-select-match>
                            <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customerinfoData | filter: { value: { name: $select.search ,userid:service.userid}} track by $index" style="max-height: 150px;">
                                <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div ng-if="selectItem.refcustomerid" class="row top-10" style="line-height:28px;">
                    <label class="col-xs-3 text-right">关联项目</label>
                    <div class="col-xs-8" style="padding:0px;">
                        <ui-select ng-model="selectItem.refprojectid" on-select="save_project($item)">
                            <ui-select-match placeholder="请选择项目">
                                <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                </span>
                            </ui-select-match>
                            <ui-select-choices repeat="item.key as (key,item) in selectProjectdata |filter: { value: { name: $select.search }} track by $index" style="max-height: 150px;">
                                <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>

                <div ng-if="selectItem.refcustomerid" class="row top-10" style="line-height:28px;">
                    <label class="col-xs-3 text-right">关联联系人</label>
                    <div class="col-xs-8" style="padding:0px;">
                        <ui-select multiple ng-model="selectItem.refcontactid" theme="select2" style="width:100%;">
                            <ui-select-match placeholder="请选择联系人">
                                <span ng-bind="$item.value.name" style="margin-right: 5px;">
                                </span>
                            </ui-select-match>
                            <ui-select-choices repeat="item.key as (key,item) in selectContactData |filter: { value: { name: $select.search }} track by $index" style="max-height: 150px;">
                                <span ng-bind-html="item.value.name | highlight: $select.search"></span>
                                &nbsp;(职位：<span ng-bind="item.value.position"></span> &nbsp;联系方式：<span ng-bind="item.value.mobilephone"></span>)
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="row top-10" style="line-height:28px;">
                    <label class="col-xs-3 text-right">抄送</label>
                    <div class="col-xs-8" style="padding-left:0px;">
                        <ui-select multiple ng-model="selectItem.refusers" theme="select2" style="width:100%;">
                            <ui-select-match placeholder="请选择抄送">
                                <span ng-bind="$item.value.description" style="margin-right: 5px;">
                                </span>
                            </ui-select-match>
                            <ui-select-choices repeat="item.value.idusers  as (key,item) in service.privateDateObj.usersData | filter: { value: { description: $select.search }}" style="max-height: 150px;">
                                <div ng-bind-html="item.value.description | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="col-xs-12 text-center top-10">
                    <button class="btn btn-primary btn-sm" ng-verify="control:'Form'" type="button" ng-click="saveData()" title="请检查数据是否正确填写！">
                        保存
                    </button>
                    <button class="btn btn-warning btn-sm" type="button" ng-click="recordModal.close();">取消</button>
                </div>
                <br />
                <br />
                <br />
            </form>
        </div>

    </aside>     
</block>
<block name="scriptTemplate">
</block>
<block name="footjs">
    <script type="text/javascript" src='{$Think.const.PAGE_URL}js/Crmcustomerinfo/Customerinfo/index.js?v={$Think.const.CRM_VERSION}'></script>
    <script type="text/javascript" src="{$Think.const.JS_URL}directive.pagebtn.js"></script>
    <script type="text/javascript" src="{$Think.const.JS_URL}directive.editconfix.js"></script>
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmcustomerinfo/Customerinfo/uploadBtn.js"></script>
    <!-- 配置文件 -->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.all.js"></script>
</block>