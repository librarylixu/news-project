<extend name="angular-base.html" />
<block name="momentjs">

</block>
<block name="headcss">

    <style>
        .table tr td {
            border: 1px solid #ccc;
            background-color: #fff;
            padding-left: 12px;
            padding-right: 12px;
            padding-top: 6px;
            padding-bottom: 6px;
            box-sizing: border-box;
            word-break: break-all;
            line-height: 20px;
            color: #666;
        }

        .box p {
            display: inline;
        }

        @media print {
            .noprint {
                display: none;
            }
        }

        @page {
            size: auto; /* auto is the initial value */
            margin-bottom: 0mm; /* this affects the margin in the printer settings */
        }

        i {
            font-style: normal;
        }

            i b {
                font-style: italic;
            }

        .form-control.ta-scroll-window {
            min-height: 80px;
            height: auto;
            clear: both;
        }
    </style>
</block>
<block name="headjs">
    <script src="{$Think.const.BOOTSTRAP_URL}angular-sanitize/{$Think.const.ANGULAR_VERSION}angular-sanitize.min.js"></script>
    <script src="{$Think.const.BOOTSTRAP_URL}angular-file-upload/angular-file-upload.min.js"></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-rangy.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-sanitize.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular.min.js'></script>
    <script>
        var _id = '{$id}';
        //存一份userid
        var _userid = "{$userid}";
    </script>
</block>
<block name="pageContent">
    <!--页头-->



    <div class="container" style="font-family: 微软雅黑;width:1040px;">
        <div class="row">
            <div class="page-header clearfix col-xs-12" style="padding:30px 30px; border-bottom-style: solid; ">
                <h1 class="col-xs-3 text-left" style="width:100%;">
                    {{service.customerinfoData.name}}
                    <small>
                        <i class="ace-icon fa fa-angle-double-right"></i>
                        {$PageName}
                    </small>
                </h1>
                <div class="col-xs-4 text-right noprint f-r">
                    <a ng-click="print()" class="btn btn-warning btn-sm">
                        <!-- 此处可暂时保留原方法（防止带有编辑/添加/删除等按钮） -->
                        <i class="ace-icon fa fa-print"></i>&nbsp;打印
                    </a>
                    <a ng-click="refresh()" class="btn btn-success btn-sm">
                        <!-- 此处可暂时保留原方法（防止带有编辑/添加/删除等按钮） -->
                        <i class="glyphicon glyphicon-refresh"></i>&nbsp;刷新
                    </a>
                </div>
            </div>
        </div>
        <div class="row">
            <h3 class="col-xs-3 text-left" style="width:60%; margin-bottom:20px;">
                工单名称:
                <small>
                    <span ng-bind="service.workorderData.title"></span>
                </small>
            </h3>
        </div>
        <div class="row">
            <table class="table" style="width:1040px;">
                <tr class="info">
                    <td colspan="4">基本信息</td>
                </tr>
                <tr>
                    <td class="text-right" style="width:150px">工单创建人</td>
                    <td style="width:370px">
                        <span ng-bind="service.usersData[service.workorderData.userid].description"></span>
                    </td>
                    <td class="text-right" style="width:150px">创建时间</td>
                    <td style="width:370px">
                        <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                        <span ng-bind="formatDate(service.workorderData.createtime)"></span>
                    </td>

                </tr>
                <tr>
                    <td class="text-right">关联客户</td>
                    <td>
                        <span ng-repeat="item in service.workorderData.refcustomerid.split(',')  track by $index">
                            <span ng-if="service.customerinfoData[item]" ng-bind="service.customerinfoData[item].name"></span><i ng-if="service.workorderData.refcustomerid.split(',').length>1">；</i>
                        </span>
                    </td>
                    <td class="text-right">关联项目</td>
                    <td>
                        <span ng-repeat="item in service.workorderData.refprojectid.split(',')  track by $index">
                            <span ng-if="service.projectData[item]" ng-bind="service.projectData[item].name"></span><i ng-if="service.workorderData.refprojectid.split(',').length>1">；</i>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="text-right">联系人</td>
                    <td colspan="3">
                        <span ng-repeat="item in service.workorderData.refcontactid.split(',')  track by $index ">
                            <span ng-if="service.contactData[item]" ng-bind="service.contactData[item].name+':'+service.contactData[item].mobilephone"></span>
                            <i ng-if="service.workorderData.refcontactid.split(',').length>1">；</i>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="text-right">工单指派给</td>
                    <td>
                        <b ng-bind="service.usersData[service.workorderData.assignid].description"></b>
                    </td>
                    <td class="text-right" style="width:15%;">期望解决</td>
                    <td>
                        <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                        <span ng-bind="formatDate(service.workorderData.expectationendtime,'yyyy-mm-dd')"></span>
                    </td>
                </tr>
                <tr>
                    <td class="text-right">开始时间</td>
                    <td>
                        <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                        <span ng-bind="formatDate(service.workorderData.starttime)"></span>
                    </td>
                    <td class="text-right">结束时间</td>
                    <td>
                        <i class="ace-icon orange fa fa-clock-o bigger-110 noprint"></i>&nbsp;
                        <span ng-bind="formatDate(service.workorderData.endtime)"></span>
                    </td>
                </tr>
                <tr>
                    <td class="text-right" style="width:150px">当前状态</td>
                    <td style="width:370px">
                        <span class="label" ng-class="statusData[service.workorderData.status].type" ng-bind="statusData[service.workorderData.status].name"></span>
                    </td>
                    <td class="text-right" style="width:150px">抄送</td>
                    <td style="width:370px">
                        <span class="label c-info" style="margin-right:3px;display:inline-block" ng-repeat="item in service.workorderData.refusers.split(',')  track by $index" ng-bind="service.usersData[item].username+':'+service.usersData[item].description"></span>
                    </td>
                </tr>
                <tr class="info">
                    <td colspan="4"><b>问题描述</b></td>
                </tr>
                <tr style="height:100px;">
                    <td colspan="4">
                        <div class="left-10 top-10" ng-bind-html="service.workorderDataMessage.causedescription"></div>
                    </td>
                </tr>
                <tr class="info">
                    <td colspan="3" style="border-right: none"><b>结果描述</b></td>
                    <td class="text-right" style="border-left: none;"><a ng-if="service.workorderData.status==1&&service.userid==service.workorderData.assignid" ng-click="changeFalse()" class="btn btn-success btn-xs noprint"><i class="glyphicon glyphicon-refresh"></i>&nbsp;编辑</a></td>
                </tr>
                <tr style="height:100px;">
                    <td colspan="4">
                        <div class="left-10 top-10" ng-if="disabled" ng-bind-html="service.workorderDataMessage.resultdescription"></div>
                        <div text-angular="text-angular" ng-if="!disabled" ng-model="service.workorderDataMessage.resultdescription"></div>
                    </td>
                </tr>
            </table>
            <div class="text-right clearfix noprint col-xs-12">
                <div class="f-r" ng-if="service.workorderData.status==1&&service.userid==service.workorderData.assignid">
                    <a ng-if="disabled == false" ng-click="changeTrue();saveResultdescription();"
                       class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;保存</a>
                    <a ng-if="disabled == false" ng-click="alertUpload('1')" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;保存并提交</a>
                    <a ng-if="disabled == true" ng-click="alertUpload('2')" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;提交</a>
                </div>
                <div class="f-r" ng-if="service.workorderData.status==2&&service.userid==service.workorderData.userid">
                    <a ng-click="alertOver(service.workorderData);" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;结单</a>

                    <a ng-click="alertBack(service.workorderData)" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;驳回</a>
                </div>
                <div class="f-r" ng-if="service.workorderData.status==0&&service.userid==service.workorderData.assignid">
                    <a ng-click="alertConfirm(service.workorderData)" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;确认工单</a>
                    <a ng-click="alertOther(service.workorderData)" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;改派工单</a>
                </div>
                <div class="f-r" style="padding-left:5px;padding-right:5px;">
                    <a ng-if="service.workorderData.userid==service.userid&&service.workorderData.status<3" ng-click="alertStop(service.workorderData);" class="btn btn-success btn-sm"><i class="glyphicon glyphicon-refresh"></i>&nbsp;中止</a>
                </div>
            </div>
            <table class="table col-xs-12">
                <tr class="info">
                    <td><b>历史记录</b></td>
                </tr>
                <tr>
                    <td>
                        <div>
                            <div style="display:inline-block;">
                                <i class="ace-icon orange fa fa-clock-o bigger-110"></i>
                                <span ng-bind="formatDate(service.workorderData.createtime)"></span>
                            </div>
                            <div style="display:inline-block;" class="box">
                                &nbsp;由[<b ng-bind="service.usersData &nbsp;[service.workorderData.userid].description"></b>]创建了工单
                            </div>
                        </div>
                        <div ng-repeat="item in service.historicallogData" ng-if="item.datatype&&item.datatype!='0'">
                            <div style="display:inline-block;">
                                <i class="ace-icon orange fa fa-clock-o bigger-110"></i>
                                <span ng-bind="formatDate(item.time)"></span>
                            </div>
                            <div style="display:inline-block;" class="box" ng-if="item.datatype=='1'">
                                &nbsp;由[<b ng-bind="service.usersData[item.userid].description"></b>]改派了工单<i ng-if="item.text">，并填写了改派原因：<b ng-bind-html="item.text"></b></i>
                            </div>
                            <div style="display:inline-block;" class="box" ng-if="item.datatype=='2'">
                                &nbsp;[<b ng-bind="service.usersData[item.userid].description"></b>]驳回了工单<i ng-if="item.text">，并添加了驳回原因：<b ng-bind-html="item.text"></b></i>
                            </div>
                            <div style="display:inline-block;" class="box" ng-if="item.datatype=='3'">
                                &nbsp;[<b ng-bind="service.usersData[item.userid].description"></b>]中止了工单<i ng-if="item.text">，并填写了中止原因：<b ng-bind-html="item.text"></b></i>
                            </div>
                            <div style="display:inline-block;" class="box" ng-if="item.datatype=='4'">
                                &nbsp;由[<b ng-bind="service.usersData[item.userid].description"></b>]结单<i ng-if="item.text">，并添加了结语：<b ng-bind-html="item.text"></b></i>
                            </div>
                            <div style="display:inline-block;" class="box" ng-if="item.datatype=='5'">
                                &nbsp;由[<b ng-bind="service.usersData[item.userid].description"></b>]确认了工单
                            </div>
                            <div style="display:inline-block;" class="box" ng-if="item.datatype=='6'">
                                &nbsp;由[<b ng-bind="service.usersData[item.userid].description"></b>]提交了工单
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>



    </div>



    <!--评论组件-->
    <!--<div page-comment />-->
</block>

<block name="scriptTemplate">

</block>

<block name="footjs">
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmcustomerinfo/Customerinfo/detailmodal.js"></script>
    <!-- 配置文件 -->
    <!--<script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <!--<script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.all.js"></script>
    <script type="text/javascript" src="{$Think.const.JS_URL}directive.pagecomment.js"></script>-->
</block>
