<!DOCTYPE html>
<html>
<head>
    <title>百度地图示例</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }

        #container {
            height: 60%;
        }
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=zpVzOQ0lYreh1hZELnPhHGbGLvVvzjnk"></script>
   
</head>
<body>
    <div id="container"></div>
    <div id="r-result">请输入:<input type="text" id="suggestId" size="20" value="百度" style="width:150px;" /></div>
    <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
    <div id="log"></div>
    <script>
        var map = new BMap.Map("container");// 创建地图实例  
     
        var point = new BMap.Point(116.374185, 40.121357);// 创建点坐标  
        map.centerAndZoom(point, 15);// 初始化地图，设置中心点坐标和地图级别  

        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放

       // map.addControl(new BMap.NavigationControl({ type: BMAP_NAVIGATION_CONTROL_SMALL }));//平移缩放控件
      //  map.addControl(new BMap.ScaleControl({ offset: new BMap.Size(150, 5) }));//控件位置偏移
      //  map.addControl(new BMap.OverviewMapControl());
      //  map.addControl(new BMap.MapTypeControl());
        map.setCurrentCity("北京"); // 仅当设置城市信息时，MapTypeControl的切换功能才能可用   
        
        /*
        自定义控件 start
        */
        // 定义一个控件类，即function    
        function ZoomControl() {
            // 设置默认停靠位置和偏移量  
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(10, 10);
        }
        // 通过JavaScript的prototype属性继承于BMap.Control   
        ZoomControl.prototype = new BMap.Control();

        // 自定义控件必须实现initialize方法，并且将控件的DOM元素返回   
        // 在本方法中创建个div元素作为控件的容器，并将其添加到地图容器中   
        ZoomControl.prototype.initialize = function (map) {
            // 创建一个DOM元素   
            var div = document.createElement("div");
            // 添加文字说明    
            div.appendChild(document.createTextNode("放大2级"));
            // 设置样式    
            div.style.cursor = "pointer";
            div.style.border = "1px solid gray";
            div.style.backgroundColor = "white";
            // 绑定事件，点击一次放大两级    
            div.onclick = function (e) {
                map.zoomTo(map.getZoom() + 2);
            }
            // 添加DOM元素到地图中   
            map.getContainer().appendChild(div);
            // 将DOM元素返回  
            return div;
        }

        // 创建控件实例    
        var myZoomCtrl = new ZoomControl();
        // 添加到地图当中    
        map.addControl(myZoomCtrl);

        /*
      自定义控件 end
      */

        //添加信息窗口
        var opts = {
            width: 250,     // 信息窗口宽度    
            height: 100,     // 信息窗口高度    
            title: "宏福苑小区"  // 信息窗口标题   
        }
        var infoWindow = new BMap.InfoWindow("昌平区", opts);  // 创建信息窗口对象    
        map.openInfoWindow(infoWindow, map.getCenter());      // 打开信息窗口

        var geocoder = new BMap.Geocoder();
        map.addEventListener("click", function (e) {
            console.log("您点击了地图。");
            geocoder.getLocation(e.point, function (rs) {

                console.log(rs.address); //地址描述(string)

                console.log(rs.addressComponents);//结构化的地址描述(object)
                console.log(rs.addressComponents.province); //省
                console.log(rs.addressComponents.city); //城市
                console.log(rs.addressComponents.district); //区县
                console.log(rs.addressComponents.street); //街道
                console.log(rs.addressComponents.streetNumber); //门牌号

                console.log(rs.surroundingPois); //附近的POI点(array)

                console.log(rs.business); //商圈字段，代表此点所属的商圈(string)
            });

        });

        map.addEventListener("dragend", function(){    
            var center = map.getCenter();    
            console.log("地图中心点变更为：" + center.lng + ", " + center.lat);    
        }
        );
        //城市检索
        var local = new BMap.LocalSearch(map, {
            renderOptions: { map: map }
        });

        //local.search("鸿懋商务大厦");


        var options = {
            onSearchComplete: function (results) {
                if (local.getStatus() == BMAP_STATUS_SUCCESS) {
                    // 判断状态是否正确      
                    var s = [];
                    for (var i = 0; i < results.getCurrentNumPois() ; i++) {
                        s.push(results.getPoi(i).title + ", " + results.getPoi(i).address);
                    }
                    document.getElementById("log").innerHTML = s.join("<br>");
                }
            }
        };

        var local = new BMap.LocalSearch(map, options);
        //local.search("鸿懋商务大厦");

    </script>

    <script>
        // 百度地图API功能
        function G(id) {
            return document.getElementById(id);
        }        

        var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
            {
                "input": "suggestId"
            , "location": map
            });

        ac.addEventListener("onhighlight", function (e) {  //鼠标放在下拉列表上的事件
            var str = "";
            var _value = e.fromitem.value;
            var value = "";
            if (e.fromitem.index > -1) {
                value = _value.province + _value.city + _value.district + _value.street + _value.business;
            }
            str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

            value = "";
            if (e.toitem.index > -1) {
                _value = e.toitem.value;
                value = _value.province + _value.city + _value.district + _value.street + _value.business;
            }
            str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
            G("searchResultPanel").innerHTML = str;
        });

        var myValue;
        ac.addEventListener("onconfirm", function (e) {    //鼠标点击下拉列表后的事件
            var _value = e.item.value;
            myValue = _value.province + _value.city + _value.district + _value.street + _value.business;
            G("searchResultPanel").innerHTML = "onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

            setPlace();
        });

        function setPlace() {
            map.clearOverlays();    //清除地图上所有覆盖物
            function myFun() {
                var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
                map.centerAndZoom(pp, 18);
                map.addOverlay(new BMap.Marker(pp));    //添加标注
            }
            var local = new BMap.LocalSearch(map, { //智能搜索
                onSearchComplete: myFun
            });
            local.search(myValue);
        }
    </script>
</body>
</html>