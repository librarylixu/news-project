<extend name="angular-base.html" />
<block name="momentjs">
</block>
<block name="headcss">

</block>
<block name="headjs">
    <!--select start-->
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select.css">
    <script src="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select.js"></script>
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select2.css">
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/selectize.default.css">
    <!--select end-->
    <link rel="stylesheet" href="{$Think.const.PAGE_URL}css/crmSchedule/Workerorder/workerorder.css" /><!-- 这里公用了工单css -->
    <link rel="stylesheet" href="{$Think.const.CSS_URL}upload.css" />
    <script src="{$Think.const.BOOTSTRAP_URL}angular-file-upload/angular-file-upload.min.js"></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-rangy.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-sanitize.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular.min.js'></script>
    <script>
        var userid = "{$userid}";
        var _appid = "{$appid}";
        //初始化翻页数据
        var _maxSize = 5;
        var _thisPageCount = 1;
    </script>
</block>
<block name="pageContent">
    <div class="col-xs-12">
        <!--操作区域-->
        <div class="btn-box">
            <page-btn></page-btn>&nbsp;
            <!--展示检索条件区域-->
            <span class="display" ng-click="search=!search"><span ng-bind="search?'隐藏':'点击'"></span>根据条件检索</span>
            <div class="text-right">
                <span class="label label-primary" style="cursor:pointer; " ng-click="selectchart()">查看流线图&nbsp;&nbsp;<i class="fa fa-bar-chart"></i></span>
            </div>
            <div ng-if="search" class="top-10">
                <div class="col-xs-12">
                    <div style="float:left;width:240px;">
                        <p class="input-group">
                            <input style="border-radius:0;" ng-click="open1()" type="text" class="form-control" current-text="今天" clear-text="清空" close-text="关闭" uib-datepicker-popup ng-model="service.start" ng-readonly="true" is-open="popup1.opened" datepicker-options="dateOptions1" ng-required="true" close-text="Close" />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-sm btn-warning" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </p>
                    </div>
                    <span style="float:left;line-height:36px;margin:0 8px;">至</span>
                    <div style="float:left;width:240px;">
                        <p class="input-group">
                            <input style="border-radius:0;" ng-click="open2()" type="text" class="form-control" current-text="今天" clear-text="清空" close-text="关闭" uib-datepicker-popup ng-model="service.end" ng-readonly="true" is-open="popup2.opened" datepicker-options="dateOptions2" ng-required="true" close-text="Close" />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-sm btn-warning" ng-click="open2()"><i class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </p>
                    </div>
                </div>
                <div class="col-xs-12">
                    <span class="col-xs-2">
                        日志类型：
                        <select class="form-control" ng-model="service.logtypeSelect" title="结果">
                            <option value="customer">客户</option>
                            <option value="project">项目</option>
                            <option value="workorder">工单</option>
                        </select>
                    </span>
                    <span class="col-xs-2">操作人：<select class="form-control" ng-model="service.usersSelect" ng-options="item.description for item in service.privateDateObj.usersData" title="操作人"></select></span>
                    <span class="col-xs-2">
                        结果：
                        <select class="form-control" ng-model="service.resultSelect" title="结果">
                            <option value="0">失败</option>
                            <option value="1">成功</option>
                            <option value="2">未知</option>
                        </select>
                    </span>
                    <span class="col-xs-2">
                        操作类型：
                        <select class="form-control" ng-model="service.typeSelect" title="操作类型">
                            <option value="0">添加</option>
                            <option value="1">修改</option>
                            <option value="2">删除</option>
                            <option value="3">查询</option>
                        </select>
                    </span>
                    <button class="btn btn-sm btn-info" style="margin-left: 8px; margin-top: 20px;" ng-click="selectwhere()">查询</button>
                </div>
            </div>
        </div>
        <!--条件检索区-->
        <div class="text-right">
            <span class="tag" ng-repeat="item in tagsData" ng-class="item.key">
                <span ng-if="item.key=='status' || item.key=='type'" ng-bind-html="item.value.name"></span>
                <span ng-if="item.key!='status' && item.key!='type'" ng-bind="item.value.description"></span>
                <button type="button" class="close" ng-click="removeTag(item)">×</button>
            </span>
        </div>
    </div>
    <!--表格展示区-->
    <div class="col-xs-12">
        <table class="table table table-striped table-bordered table-hover table-condensed table-responsive">
            <thead>
                <tr>
                    <th>图标</th>
                    <th>日志种类</th>
                    <th>操作类型</th>
                    <th>操作人</th>
                    <th>结果</th>
                    <th>时间</th>
                    <th style="width:25%;">结果描述</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="item in service.SystemlogData track by $index">
                    <td><i class="fa fa-user-circle fa-lg"></i></td>
                    <td><span ng-bind="iflogtype(item,1)" ng-class="iflogtype(item,2)"></span></td>
                    <td><span ng-bind="systemtype(item.type,1)" ng-class="systemtype(item.type,2)"></span></td>
                    <td><span class="label c-info" ng-bind="service.privateDateObj.usersData[item.userid].description"></span></td>
                    <td><span ng-bind="isresult(item,1)" ng-class="isresult(item,2)"></span></td>
                    <td>
                        <span ng-bind="formatDate(item.time)"></span>
                    </td>
                    <td ng-bind="item.message"></td>
                </tr>
            </tbody>
        </table>
        <div>
            <div style="float:right; margin-left:10px;">
                当前<b class="blue" ng-bind="bigTotalItems"></b>条日志
                共<b class="blue" ng-bind="num"></b>页
            </div>
            <div style="float:right;margin-top:-26px;">
                <ul uib-pagination total-items="bigTotalItems" items-per-page="maxSize" max-size="2" boundary-link-numbers="true" first-text="首页" last-text="末页" next-text="下一页" previous-text="上一页" ng-model="bigCurrentPage" num-pages="num" class="pagination-sm" ng-click="selectwhere()" boundary-links="true" force-ellipses="true"></ul>
            </div>
        </div>
    </div>
</block>
<block name="scriptTemplate">
</block>

<block name="footjs">
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmlog/Systemlog/index.js"></script>
    <script type="text/javascript" src="{$Think.const.JS_URL}directive.pagebtn.js"></script>
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmlog/Systemlog/uploadBtn.js"></script>
</block>
​