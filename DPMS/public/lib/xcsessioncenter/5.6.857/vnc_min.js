var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(h,q,w){h!=Array.prototype&&h!=Object.prototype&&(h[q]=w.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(h){var q=0;return $jscomp.iteratorPrototype(function(){return q<h.length?{done:!1,value:h[q++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};$jscomp.iteratorFromArray=function(h,q){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var w=0,I={next:function(){if(w<h.length){var M=w++;return{value:q(M,h[M]),done:!1}}I.next=function(){return{done:!0,value:void 0}};return I.next()}};I[Symbol.iterator]=function(){return I};return I};
$jscomp.polyfill=function(h,q,w,I){if(q){w=$jscomp.global;h=h.split(".");for(I=0;I<h.length-1;I++){var M=h[I];M in w||(w[M]={});w=w[M]}h=h[h.length-1];I=w[h];q=q(I);q!=I&&null!=q&&$jscomp.defineProperty(w,h,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6-impl","es3");var svManager={getInstance:function(){var h=window.$vnc;return h&&h.running&&h.running()?h:null}};
function connvertServer(h){var q={};q.id=h.id;q.server=h.id;q.displayName=h.displayName||h.id;if(h=h.vnc){for(var w in h)q[w]=h[w];q.pwd=h.password||""}return q}
svGlobal.Vnc=function(h,q,w,I){function M(a){return"on"==a||"true"==a}function Ha(a,b){function e(a){a-m>d&&0<c.width&&(D.repaint(c.x,c.y,c.width,c.height),c.width=0,m=a);l=requestAnimationFrame(e)}var f=[],g=null,c=new hi5.graphic.Rectangle(0,0,0,0),k="Uint8ClampedArray"in window;this.width=a;this.height=b;var d=J.animation||62,h=!1,D=this,E=null,m=0,l=0;this.pause=function(a){h=a};this.release=function(){cancelAnimationFrame(l);E=f=g=D=null};this.isPaused=function(){return h};this.setContext=function(c){c!=
g&&(g||!c||c.createImageData(1,1).data.buffer||(k=!1),g=c,null!=g&&(E=g.createImageData(a,b)))};this.getContext=function(){return g};this.resize=function(c,n){for(var e=0;e<n;e++)f[e]=new Uint32Array(c);D.width=a=c;D.height=b=n;null!=g&&(E=g.createImageData(a,b))};D.resize(a,b);this.getBuffer=function(){return f};this.setRGB=function(a,b,c){f[b][a]=c|4278190080};this.getRGB=function(a,b){return f[b][a]};this.setRGBs=function(a,b,c,g,e,k,d){var n=a+c;g=b+g;if(e.subarray)for(;b<g;b++,k+=d)f[b].set(e.subarray(k,
k+c),a);else for(var r;b<g;b++,k+=d){var v=k;r=f[b];for(c=a;c<n;c++)r[c]=e[v++]}};this.moveArea=function(a,b,c,g,e,k){if(0<k)for(e=a+e,k=b+k,--g;0<=g;g--)f[k+g].set(f[b+g].subarray(a,a+c),e);else if(0>k){e=a+e;k=b+k;for(var n=0;n<g;n++)f[k+n].set(f[b+n].subarray(a,a+c),e)}else if(0<e){e=a+e;k=b+k;var n=f,d;for(--c;0<=c;c--){var r=e+c;var h=a+c;for(d=0;d<g;d++)n[k+d][r]=n[b+d][h]}}else{e=a+e;k=b+k;var n=f;for(d=0;d<c;d++){h=e+d;var v=a+d;for(r=0;r<g;r++)n[k+r][h]=n[b+r][v]}}};this.getRGBs=function(a,
b,c,e){var g=_Uint32Array(c*e);g[0]=0;var n=f;c=a+c;e=b+e;for(var k=0,d=b;d<e;d++)for(b=a;b<c;b++)g[k++]=n[d][b];return g};this.repaint=function(c,e,d,h){var n=E.data,r=0,F,v;0>c&&(d+=c,c=0);0>e&&(h+=e,e=0);c+d>a&&(d=a-c);e+h>b&&(h=b-e);var A=c+d;var D=e+h;if(k)for(n=new Uint32Array(n.buffer),v=e;v<D;v++)n.set(f[v].subarray(c,A),r),r+=a;else{var m=4*(a-d)|0;for(v=e;v<D;v++){for(F=c;F<A;F++){var l=f[v][F];n[r++]=l&255;n[r++]=l>>8&255;n[r++]=l>>16&255;n[r++]=255}r+=m}}g.putImageData(E,c,e,0,0,d,h)};
this.postPaint=function(a,b,e,g){0<c.width?c.union(a,b,e,g):(c.x=a,c.y=b,c.width=e,c.height=g)};this.commitPaint=function(){0<c.width&&(this.repaint(c.x,c.y,c.width,c.height),c.width=0)};this.startAnimation=function(){l=requestAnimationFrame(e)};this.fillRect=function(a,b,c,e,g){c=a+c;e=b+e;for(var k=b;k<e;k++)if(f[k].fill)f[k].fill(g,a,c);else{var n=f[k];for(b=a;b<c;b++)n[b]=g}}}function ua(){var a=h.indexOf("://"),b=h.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+
"//"+b}function Ia(a){if(!ea)return"";a=hi5.browser.httpGet(ua()+"/CLIP?s="+ea+"&t="+Date.now(),!1);setTimeout(function(){l.send("883")},999);return a}function U(a,b,e){this.need=a;this.handler=b;this.repeat=e||1}function va(a){var b=0,e=0,f=new Uint8Array(a),g=this,c=new U(0,null,0);this.release=function(){g=f=c=null};this.getHandler=function(){return c};this.getData=function(){return f};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=function(){return e};this.set=
function(a,c,g){f=a;b=c;e=g};this.handle=function(){c.handler(g,c)};this.setHandler=function(a){a&&1>a.need&&svGlobal.logger.warn("need < 1");(c=a)&&e-b>=a.need&&a.handler(g,a)};this.getByte=function(){return f[b++]};this.peekByte=function(){return f[b]};this.getBE32=function(){return f[b++]<<24|f[b++]<<16|f[b++]<<8|f[b++]};this.getBE16=function(){return f[b++]<<8|f[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=function(a,c){if(c)for(var e=0;e<a;e++)c[e]=f[b++];else return e=
b,b+=a,f.subarray(e,b)};this.copyToByteArray=function(a,b,c,e){hi5.Arrays.arraycopy(f,c,a,b,e)};this.getString16LE=function(a,b){for(var c="",e=a;e<b;)var g=f[e++]|f[e++]<<8,c=c+String.fromCharCode(g);return c}}function wa(){var a="";m&&M(m.connectif)&&m.symlink&&"sessionStorage"in window&&(a="SV_"+m.symlink,m.user&&(a+=m.user));return a}function Ja(){var a=wa(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function Ka(){if(!H){if(ha)l=ha,ca(m.width,m.height);else{var a=hi5.tool.replaceQuery(h,
"pwd","x")+Ja();hi5.browser.binaryWS()&&(a+="&binary=on");var b=window.opener;if(b){var e=null;try{e=b.__sparkUser}catch(g){}e&&(b=e.account,e=e.session,b&&(a+="&account="+b),e&&(a+="&session="+e))}l=new WebSocket(a+("&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0)),"vnc");l.binaryType="arraybuffer"}aa.ws=l;svGlobal.logger.info(h);l.onopen=La;var f=new hi5.DataBuffer([],0,0);l.onmessage=function(a){a=a.data;if("string"!=typeof a){var b=new Uint8Array(a);null!=S&&S.add(new RecordingObj(b,
0,a.byteLength));switch(b[0]){case 48:x.set(b,2,b-2);x.handle();break;case 56:f.attach(b,2,b.length-2);xa(f.getUnicodeString(f.getEnd()-f.getPosition(),!1));break;case 60:if(fa||ga)switch(f.attach(b,2,b.length-2),f.getByte()){case 32:if(y&&!y.isPaused()){a=f.getLittleEndian16();b=f.getLittleEndian16();var e=f.getLittleEndian16();var g=f.getLittleEndian32(),h=d.sessionInfo.appInfo.sessions[g];u&&u.moveCursor(b,e,!0,h,g,a)}}break;case 62:f.attach(b,2,b.length-2);ia(f.getUnicodeString(f.getEnd()-f.getPosition(),
!1));break;case 146:f.attach(b,2,b.length-2);switch(f.getByte()){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;l.send(a.buffer);break;case 1:N&&N.check();break;case 6:aa.remoteLockFlags=f.getLittleEndian32(),aa.checkLockFlags=!0}break;default:svGlobal.logger.warn("invalid type:"+b[0])}}else switch(e=parseInt(a.substring(0,2),16),b=a.substring(2),e){case 26:a=JSON.parse(b);if(a.name){svGlobal.logger.info("msg="+b);if(d.onerror)d.onerror(a);b=__svi18n.errorCode["S"+a.name]||"";b+=a.message;d.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:0!=J.drawLicense&&u.drawLicense(b);break;case 56:xa(b);break;case 59:a=hi5.Base64.dec(b,0);ja=a[3]<<24|a[2]<<16|a[1]<<8|a[0];ja&64&&d.showMessage(__svi18n.info.recording);u.setFeature(ja);break;case 61:a=JSON.parse(b);switch(a.type){case 0:ca(a.width,a.height);K=a.color/8|0;"ignoreCursor"in a&&(ka=a.ignoreCursor);"trackCursorLocally"in a&&(fa=a.trackCursorLocally,ya(u));a.server&&(d.server=a.server,d.setTitle&&(document.title=
m.displayName||d.server));u&&u.setAutoScale(!0);if(d.onopened)d.onopened(a);break;case 1:a=a.duration;if(d.onprogress)d.onprogress(a,void 0);break;case 2:2==a.status?(la(),H=!0):(b=0==a.status,y.pause(b),b||y.repaint(0,0,y.width,y.height),a.warn&&d.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:ia(b);break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}};l.onclose=da;l.onerror=Ma}}function Na(a,b){var e=0,f=!1;this.width=a;this.interval=b;var g=0;this.start=
function(){f||(f=!0,e=setInterval(function(){if(u&&H){var b=u.getThumbnail(a);b&&b.length!=g&&(l.send("8E7"+b),g=b.length)}},b))};this.stop=function(){clearInterval(e)}}function Oa(a,b){!P||P.width==a&&P.interval==b||(P.stop(),P=null);P||(P=new Na(a,b));P.start()}function xa(a){a=JSON.parse(a);ea=a.session;a.server=d.server;var b=hi5.$("joinSelect");b&&(b.value=a.joinMode);if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined||ga||(d.mode=0,x.setHandler(ma),W=new na);var b=J.page&&J.page.joinvnc||
"joinvnc.html",b=location.protocol+"//"+location.host+"/"+b+"?id="+a.numericId,e=a.webAddress;if(e&&0<e.length){var f=e.indexOf("://"),e=e.substring(f+3),f=e.indexOf("/");0<f&&(e=e.substring(0,f));e.toLowerCase()!=location.host.toLowerCase()&&(b+="&gateway="+e)}a.joinLink=b;d.sessionInfo.appInfo=a;a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.info("Client:"+svGlobal.version+" server:"+a.ver);if(d.onsessionstart)d.onsessionstart(d.sessionInfo)}function ya(a){fa?ka&&a.setCursor({system:"default",
none:!1,result:"default"}):hi5.browser.isIE?a.setCursor({system:"none",none:!0,result:"none"}):a.setCursor({result:"url(data:image/x-icon;base64,AAACAAEAICACAAAAAAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAgAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAABQUFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAADgAAAA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8f////H////x////8=) 0 0, none"})}
function La(a){svGlobal.logger.info("opened...");H=!0;l.send("87"+navigator.userAgent);if(d.onopen)d.onopen()}function Ma(a){svGlobal.logger.warn(a)}function da(a){if(d){svGlobal.logger.warn("closed ...");(a=wa())&&d.sessionInfo.appInfo&&0==d.mode&&(sessionStorage[a]=d.sessionInfo.appInfo.session);x&&x.getHandler()&&x.getHandler().handler==oa&&d.onautherror&&d.onautherror();ba=H=!1;N&&(N.stop(),N=null);if(d&&d.onclose)d.onclose(za);try{null!=S&&(S.exit(),S=null),u&&(u.onclipdata=null,u.close(),u=
null)}catch(b){}Aa=Ba=L=B=h=null;x&&(x.release(),x=null);Q=null;l&&(l.onopen=null,l.onmessage=null,l.onclose=null,l=l.onerror=null);R&&(R.release(),R=null);W&&(W.release(),W=null);u=aa=pa=ma=G=L=null;y&&(y.release(),y=null);d&&(d=null);window&&window.$vnc&&(window.$vnc=null);null!=S&&(S.exit(),S=null)}}function Ca(){var a=new Uint8Array(2);a[0]=147;a[1]=M(m.share)?1:0;l.send(a.buffer);x.setHandler(new U(24,function(a){if(d.onloggedin)d.onloggedin();l.send("8D");var b=d.sessionInfo;b.width=X=a.getBE16();
b.height=Y=a.getBE16();b.bpp=a.getByte();b.depth=a.getByte();b.bigEndian=0!=a.getByte();b.trueColor=0!=a.getByte();b.redMax=a.getBE16();b.greenMax=a.getBE16();b.blueMax=a.getBE16();b.redShift=a.getByte();b.greenShift=a.getByte();b.blueShift=a.getByte();a.skip(3);for(var f=a.getBE32(),g="",c=0;c<f;c++)g+=String.fromCharCode(a.getByte());b.name=g;svGlobal.logger.info("server name:"+g);d.setTitle&&(document.title=g);ca(X,Y);a=[];b=m.encoding;8==m.color&&"Tight"==b&&(b="ZRLE");switch(b){case "Tight":a.push(7);
a.push(16);a.push(5);a.push(0);break;case "Raw":a.push(0);a.push(16);a.push(7);a.push(5);a.push(0);16==m.color&&(m.color=32);break;case "Hextile":a.push(5);a.push(16);a.push(7);a.push(0);16==m.color&&(m.color=32);break;default:a.push(16),a.push(7),a.push(5),a.push(0),16==m.color&&(m.color=32)}a.push(1);fa&&(a.push(4294967057),a.push(4294967064));a.push(4294967038);a.push(4294967035);"0"!=m.compression&&a.push(4294967040+parseInt(m.compression||6));"0"!=m.quality&&a.push(4294967264+parseInt(m.quality||
5));a.push(4294967073);b=a.length;f=new Uint8Array(5+4*b);f[0]=147;f[1]=2;f[3]=b>>8&255;f[4]=b&255;for(g=0;g<b;g++)f[5+4*g]=a[g]>>24&255,f[6+4*g]=a[g]>>16&255,f[7+4*g]=a[g]>>8&255,f[8+4*g]=a[g]&255;l.send(f.buffer);a=parseInt(m.color);switch(a){case 32:qa(32,24,!1,!0,255,255,255,0,8,16);break;case 16:qa(16,16,!1,!0,31,63,31,11,5,0);break;case 8:qa(8,8,!1,!0,7,7,3,0,3,6);break;default:svGlobal.logger.warn("invliad color depath:"+a)}K=a/8|0;R.setBytesPerPixel(K);ra(0,0,X,Y,!1);x.setHandler(pa);ba=!0;
void 0!=m.recording&&"on"==m.recording&&(a=m,S=new RecordingManager,S.setHeader({name:a.server,width:a.width,height:a.height,color:a.server_bpp,namesuffix:".vncv",filetag:"VNCV",duration:0}));J.pingInterval&&d.startPing(J.pingInterval);if(d.onready)d.onready()}))}function oa(a){a=a.getBE32();svGlobal.logger.info("sec rst: "+a);var b={code:a,message:""};switch(a){case 0:Ca();return;case 1:b.message=__svi18n.vnc.authError;break;case 2:b.message="Too many failed authentication";break;default:b.message=
"Unknown auth error"+a}x.setHandler(null);d.onautherror&&d.onautherror(b)||(d.showMessage(b.message),d.close())}function qa(a,b,e,f,g,c,d,h,A,D){var k=new Uint8Array(21);k[0]=147;k[1]=0;k[5]=a;k[6]=b;k[7]=e?1:0;k[8]=f?1:0;k[9]=g>>8&255;k[10]=g&255;k[11]=c>>8&255;k[12]=c&255;k[13]=d>>8&255;k[14]=d&255;k[15]=h;k[16]=A;k[17]=D;l.send(k.buffer)}function ra(a,b,e,f,g){var c=new Uint8Array(11);c[0]=147;c[1]=3;c[2]=g?1:0;c[3]=a>>8&255;c[4]=a&255;c[5]=b>>8&255;c[6]=b&255;c[7]=e>>8&255;c[8]=e&255;c[9]=f>>
8&255;c[10]=f&255;l.send(c.buffer)}function na(){var a=new TINF;a.init(2==d.mode?120:0);var b=new va(0),e=new Uint32Array(4096),f=new Uint32Array(128);this.release=function(){f=e=null;a.release();a=null;b.release();b=null};this.getHistory=function(){var b=[90],c=a.getHistory().length,e=c&255;b.push(c>>8&255);b.push(e);return b=b.concat(a.getHistory())};this.setHistory=function(b){a.setHistory(b)};this.decode=function(g,c,d,h,l,D){var k,F=g.getBE32();g=g.getBytes(F);g=a.uncompress(g,0);b.set(g.dest,
0,g.destIndex);var m=f,A,n=b.getByte,r=e;for(g=d;g<d+l;g+=64){var v=Math.min(d+l-g,64);for(F=c;F<c+h;F+=64){var z=Math.min(c+h-F,64);var t=n();var p=0!=(t&128);t&=127;if(1==K)for(k=0;k<t;k++)m[k]=V[n()];else for(k=0;k<t;k++)m[k]=n()|n()<<8|n()<<16|4278190080;if(1!=t||D){if(p)if(0==t)for(t=0,A=t+z*v;t<A;){var O=1==K?V[n()]:n()|n()<<8|n()<<16|4278190080;k=1;do p=n(),k+=p;while(255==p);if(r.fill)r.fill(O,t,t+k),t+=k;else for(;0<k--;)r[t++]=O}else for(t=0,A=t+z*v;t<A;){O=n();k=1;if(0!=(O&128)){do p=n(),
k+=p;while(255==p)}O&=127;O=m[O];if(r.fill)r.fill(O,t,t+k),t+=k;else for(;0<k--;)r[t++]=O}else if(p=z*v,0==t)if(1==K)for(k=0;k<p;k++)r[k]=V[n()];else for(k=0;k<p;k++)r[k]=n()|n()<<8|n()<<16|4278190080;else for(A=16<t?8:4<t?4:2<t?2:1,k=t=0;k<v;k++){O=t+z;for(var u=p=0;t<O;)0==u&&(p=n(),u=8),u-=A,r[t++]=m[p>>u&(1<<A)-1&127]}D||y.setRGBs(F,g,z,v,r,0,z)}else y.fillRect(F,g,z,v,m[0])}}D||y.postPaint(c,d,h,l)}}function Da(){function a(a,b,c,e,f){this.draw=function(){Q.fillStyle=f;Q.fillRect(a,b,c,e)};this.type=
0;this.ready=function(){return!0}}function b(a,b,c){this.draw=function(){Q.putImageData(c,a,b)};this.type=1;this.ready=function(){return!0}}function e(a,b,c){this.draw=function(){Q.drawImage(c,a,b)};this.type=2;this.ready=function(){return!!c.src&&c.complete};this.image=c}function f(){var a=l[h];a||(a=new TINF,a.init(2==d.mode?120:0),l[h]=a);return a}function g(a){var b=a.getByte(),c=b&127;b&128&&(b=a.getByte(),c|=(b&127)<<7,b&128&&(c|=a.getByte()<<14));return c}function c(a){if(3==m)return"rgb("+
a.getByte()+","+a.getByte()+","+a.getByte()+")";var b=a.getByte()|a.getByte()<<8;a=b>>8&248;var c=b>>3&252,b=b<<3&255;return"rgb("+(a|a>>5)+","+(c|c>>6)+","+(b|b>>5)+")"}function k(a){var b=a>>8&248,c=a>>3&252;a=a<<3&255;return b|b>>5|(c|c>>6)<<8|(a|a>>5)<<16|4278190080}var h=0,m=3,l={},u={data:[0],length:0},y=Array(256);y[0]=0;this.inUse=!1;var Z=this;this.setBytesPerPixel=function(a){m=3<a?3:a};var q=new function(){function a(){for(;0<b.length;){var a=b[0];if(!a.ready())break;a.draw();b.shift()}}
var b=[];this.push=function(c){b.push(c);2==c.type?c.image.onload=a:a()}};this.release=function(){l=u=y=Z=q=null};this.getHistory=function(){var a=[84],b=Object.keys(l).length;a.push(b);for(var c in l)if(l.hasOwnProperty(c)){a.push(parseInt(c));var b=l[c].getHistory(),e=b.length,f=e&255;a.push(e>>8&255);a.push(f);a=a.concat(b)}return a};this.setHistory=function(a){for(var b=0,c=a[b++],e=0;e<c;e++){var f=a[b++],k=a[b++],g=a[b++],g=(k&255)<<8|g&255,k=a.slice(b,b+g),b=b+g,g=l[f];g||(g=new TINF,g.init(2==
d.mode?120:0),l[f]=g);g.setHistory(k)}};this.drawImageData=function(a,c,e){q.push(new b(c,e,a))};this.decode=function(d,F,l,A,t,D){Z.inUse||(Z.inUse=!0);var n=d.getByte();switch(n>>4){case 8:D?d.skip(m):q.push(new a(F,l,A,t,c(d)));break;case 9:n=g(d);A=hi5.Base64.enc(d.getData(),n,d.getPosition());d.skip(n);D||(D=new Image,q.push(new e(F,l,D)),D.src="data:image/jpeg;base64,"+A);break;default:if(h=(n&48)>>4,n=n&64?d.getByte():0,1==n){n=d.getByte;var r=n()+1;var v=2!=r?A*t:t*((A+7)/8|0);var p=0;var E;
if(3==m)for(;p<r;p++)y[p]=n()|n()<<8|n()<<16|4278190080;else for(;p<r;p++)y[p]=k(n()|n()<<8);12>v?(u.data=d.getBytes(v),u.length=v):(n=g(d),d=f().uncompress(d.getBytes(n),0),u.data=d.dest,u.length=d.destIndex);var z=u.data;n=Q.createImageData(A,t);if("Uint8ClampedArray"in window){var C=new Uint32Array(n.data.buffer);if(2!=r)for(p=0;p<v;p++)C[p]=y[z[p]];else{d=0;v=(A+7)/8|0;for(var B=0;B<t;B++){p=B*v;for(var w=0;w<(A/8|0);w++)for(r=z[p+w],E=7;0<=E;E--)C[d++]=y[r>>E&1];r=8-A%8;for(E=7;E>=r;E--)C[d++]=
y[z[p+w]>>E&1]}}}else if(C=n.data,d=0,2!=r)for(p=0;p<v;p++)r=y[z[p]],C[d++]=r&255,C[d++]=r>>8&255,C[d++]=r>>16&255,C[d++]=255;else{d=0;v=(A+7)/8|0;for(var x,B=0;B<t;B++){p=B*v;for(w=0;w<(A/8|0);w++)for(r=z[p+w],E=7;0<=E;E--)x=y[r>>E&1],C[d++]=x&255,C[d++]=x>>8&255,C[d++]=x>>16&255,C[d++]=255;r=8-A%8;for(E=7;E>=r;E--)x=y[z[p+w]>>E&1],C[d++]=x&255,C[d++]=x>>8&255,C[d++]=x>>16&255,C[d++]=255}}D||q.push(new b(F,l,n))}else if(0==n){n=A*t*m;11<n&&(n=g(d));r=A*t;z=r*m;z=11<z?f().uncompress(d.getBytes(n),
0).dest:d.getBytes(z);n=Q.createImageData(A,t);C=n.data;A=d=0;if(3==m)for(p=0;p<r;p++)C[d++]=z[A++],C[d++]=z[A++],C[d++]=z[A++],C[d++]=255;else for(p=0;p<r;p++)t=k(z[A++]|z[A++]<<8),C[d++]=t&255,C[d++]=t>>8&255,C[d++]=t>>16&255,C[d++]=255;D||q.push(new b(F,l,n))}else svGlobal.logger.info("xx filter:"+n)}}}function ia(a){var b=parseInt(a.substring(0,1),16),e=a.substring(1),f=!1;var g=d.sessionInfo.appInfo;switch(b){case 0:var c=JSON.parse(e);la();H=!0;f=c.width;g=c.height;if(f==X&&g==Y)break;ca(f,
g);break;case 1:d.reconnectOnResize=!1;c=JSON.parse(e);g.sessions[c.numericId]=c.name||c.__ip;d.onsessionjoin&&(f=d.onsessionjoin(c));if(f)break;d.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(e);delete g.sessions[c.numericId];d.onsessionexit&&(f=d.onsessionexit(c));if(f)break;d.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(e);g.joinMode!=c.mode&&(g.joinMode=c.mode,a=hi5.$("joinSelect"))&&
(a.value=c.mode);if(g.hasControl)break;u.setReadOnly(!1,2==c.mode);if(g=hi5.$("requestControl"))g.disabled=!0;d.ongivecontrol&&(f=d.ongivecontrol());if(f)break;d.showMessage(__svi18n.info.givecontrol);break;case 4:c=JSON.parse(e);u.setReadOnly(!0,2==c.mode);g.hasControl=!1;if(g=hi5.$("requestControl"))g.disabled=!1;d.ontakebackcontrol&&(f=d.ontakebackcontrol());if(f)break;d.showMessage(__svi18n.info.nocontrol);break;case 5:c=JSON.parse(e);d.onrequirecontrol&&(f=d.onrequirecontrol(c));if(f)break;f=
__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);hi5.notifications.notify({title:f,msg:__svi18n.info.recontrol,cbYes:function(){d.giveControl(c.numericId);this.destroy()},cbNo:function(){d.refuseControl(c.numericId);this.destroy()}});break;case 9:c=JSON.parse(e);0<c.interval&&0<c.width?Oa(c.width,c.interval):P&&(P.stop(),P=null);break;case 10:if(1==a.length)l.send("8E8"+hi5.Base64.enc(Pa()));else if(Qa(hi5.Base64.dec(a.substring(1),0)),d.refreshOutput(),ba=!0,d.onloggedin)d.onloggedin();
N&&N.check(15555);break;case 11:c=JSON.parse(e),d.onrequirejoin&&(f=d.onrequirejoin(c)),f||(f=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]),hi5.notifications.notify({title:f,msg:__svi18n.info.reqjoin,cbYes:function(){d.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){d.allowJoin(c.numericId,!1);this.destroy()}}))}}function Pa(){var a=W.getHistory(),b=R.getHistory();return a.concat(b)}function Qa(a){var b=0,e=a[b++];if(90==e){var e=a[b++],d=a[b++];if(e=(e&255)<<8|d&255)W.setHistory(a.slice(b,
b+e)),b+=e}e=a[b++];84==e&&R.setHistory(a.slice(b))}function Ra(a){if(!d.openLink)return!1;var b=a;a=a.toLowerCase();var e=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");e||(0==a.indexOf("www.")?(e=!0,a="http://"+a):0==a.indexOf("ftp.")&&(e=!0,a="ftp://"+a));if(e){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(d.onurlredirection&&d.onurlredirection(e))return!0;u.processLink(b);return!0}return!1}
function Sa(a,b,e,d,g,c,k,h,l){this.cache_idx=a;this.rawData=b;this.none=!b;this.hotX=e;this.hotY=d;this.width=g;this.height=c;this.xorSize=h;this.andSize=l;this.result="";this.distance=0;this.bpp=k;this.system="";this.init=function(){if(this.distance){var a=0;if(b)for(var c=0,e=b.length;c<e;c++)0!=b[c]&&(a+=c%g+(c/g|0));this.distance=a}this.system||(a=507==this.distance?"text":"",this.system=a)};a="";if(!this.system&&b){var f=g*c*4;k=62+f+h+l;var F=new Uint8Array(k);k=new hi5.DataBuffer(F,0,k);k.setLittleEndian16(0);
k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(g);k.setByte(c);k.setByte(0);k.setByte(0);k.setLittleEndian16(e);k.setLittleEndian16(d);k.setLittleEndian32(40+f+h+l);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(g);k.setLittleEndian32(2*c);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(h+l);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);for(e=c-1;0<=e;e--)for(d=0;d<g;d++)c=b[g*e+d],
k.setByte(c&255),k.setByte(c>>8&255),k.setByte(c>>16&255),k.setByte(c>>24&255);hi5.browser.isIE||(a="data:image/x-icon;base64,"+hi5.Base64.enc(k.getData()))}this.url=a}function Ea(a,b,e,d,g){var c=null,f=d*g,h=0,l=a.getPosition(),m=a.getData();if(R.inUse){c=Q.createImageData(d,g);if(4==K){if("Uint8ClampedArray"in window)for(g=new Uint32Array(c.data.buffer),h=0;h<f;h++)g[h]=m[l++]<<16|m[l++]<<8|m[l++]|4278190080,l++;else for(g=c.data,d=4*f;h<d;)g[h++]=m[l+2],g[h++]=m[l+1],g[h++]=m[l],g[h++]=255,l+=
4;a.skip(4*f)}else if(1==K){if("Uint8ClampedArray"in window)for(g=new Uint32Array(c.data.buffer),h=0;h<f;h++)g[h]=V[m[l++]];else{g=c.data;d=4*f;for(var u;h<d;)u=V[m[l++]],g[h++]=u&255,g[h++]=u>>8&255,g[h++]=u>>16&255,g[h++]=255}a.skip(f)}R.drawImageData(c,b,e)}else{switch(K){case 4:if(0==l%4){l+=3;for(h=0;h<f;h++)m[l]=255,l+=4;c=new Uint32Array(a.getData().buffer,a.getPosition(),f)}else for(c=new Uint32Array(f),h=0;h<f;h++)c[h]=m[l++]|m[l++]<<8|m[l++]<<16|4278190080,l++;a.skip(4*f);break;case 1:c=
new Uint32Array(f);for(h=0;h<f;h++)c[h]=V[m[l++]];a.skip(f)}y.setRGBs(b,e,d,g,c,0,d);y.postPaint(b,e,d,g)}}function ca(a,b){X=a;Y=b;m.width=a;m.height=b;y.resize(a,b);u&&u.setSize(a,b);if(d.onresolutionchange)d.onresolutionchange(a,b)}function Ta(a){if(ba&&a&&(a=a.getData("text/plain"))){var b=a.length,e=new Int8Array(9+b);e[0]=147;e[1]=6;e[5]=b>>24&255;e[6]=b>>16&255;e[7]=b>>8&255;e[8]=b&255;for(var d=0;d<b;d++)e[9+d]=a.charCodeAt(d);l.send(e.buffer)}}function la(){H=!1;R=new Da;W=new na}function sa(a,
b,e,d){ba&&(Fa=a,(a?1<<b:0)!=L[1]||e!=(L[2]<<8|L[3])||d!=(L[4]<<8|L[5]))&&(L[2]=a?1<<b:0,L[3]=e>>8&255,L[4]=e&255,L[5]=d>>8&255,L[6]=d&255,l.send(L.buffer))}function T(a,b,e){B[2]=a?1:0;B[5]=b>>24;B[6]=b>>16;B[7]=b>>8;B[8]=b;183==e?e=84:197==e&&(e=198);ta&&(B[2]=0,B[3]=0,B[4]=a?1:0,B[9]=e>>24,B[10]=e>>16,B[11]=e>>8,B[12]=e);l.send(B.buffer);if(d.onkey)d.onkey(a,b,e)}function Ga(a,b){var e=Ba[b.toLowerCase()];e?d.writeScancode(a,e):(e=b.length,0!=e&&(1==e?d.writeKeyCode(a,b.toUpperCase().charCodeAt(0)):
a&&d.writeText(b)))}this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;this.CAP_QEMU_KEY=1;var ha="object"==typeof h?h:null,ga="object"==typeof h||0<h.indexOf("/PLAY?");ga?(this.mode=1,ha&&(h=""),h+="&touchpad=on"):0<h.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var J=hi5.appcfg||{img:{},toolbar:{fadable:!0}},m=hi5.tool.queryToObj(h.substring(h.indexOf("?")+1)),N=null,za=!1,ea="",ta=!1;!m.width&&q&&(m.width=q,h+="&width="+q);!m.wHeight&&w&&(m.height=
w,h+="&height="+w);!m.color&&I&&(m.color=I,h+="&color="+I);m.color||(m.color=32);var ka=void 0==m.ignoreCursor||M(m.ignoreCursor),fa=void 0==m.trackCursorLocally||M(m.trackCursorLocally);this.server=m.server;this.port=parseInt(m.port,10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var u=null,H=!1,ba=!1,ja=0,S=null;window.$vnc=this;var x=new va(4194304);this.running=function(){return H};var d=this,l=null,K=4,X=1024,Y=768,V=[-16777216,-16777180,-16777143,-16777107,
-16777070,-16777034,-16776997,-16776961,-16768E3,-16767964,-16767927,-16767891,-16767854,-16767818,-16767781,-16767745,-16758528,-16758492,-16758455,-16758419,-16758382,-16758346,-16758309,-16758273,-16749312,-16749276,-16749239,-16749203,-16749166,-16749130,-16749093,-16749057,-16739840,-16739804,-16739767,-16739731,-16739694,-16739658,-16739621,-16739585,-16730624,-16730588,-16730551,-16730515,-16730478,-16730442,-16730405,-16730369,-16721152,-16721116,-16721079,-16721043,-16721006,-16720970,-16720933,
-16720897,-16711936,-16711900,-16711863,-16711827,-16711790,-16711754,-16711717,-16711681,-11206656,-11206620,-11206583,-11206547,-11206510,-11206474,-11206437,-11206401,-11197440,-11197404,-11197367,-11197331,-11197294,-11197258,-11197221,-11197185,-11187968,-11187932,-11187895,-11187859,-11187822,-11187786,-11187749,-11187713,-11178752,-11178716,-11178679,-11178643,-11178606,-11178570,-11178533,-11178497,-11169280,-11169244,-11169207,-11169171,-11169134,-11169098,-11169061,-11169025,-11160064,-11160028,
-11159991,-11159955,-11159918,-11159882,-11159845,-11159809,-11150592,-11150556,-11150519,-11150483,-11150446,-11150410,-11150373,-11150337,-11141376,-11141340,-11141303,-11141267,-11141230,-11141194,-11141157,-11141121,-5636096,-5636060,-5636023,-5635987,-5635950,-5635914,-5635877,-5635841,-5626880,-5626844,-5626807,-5626771,-5626734,-5626698,-5626661,-5626625,-5617408,-5617372,-5617335,-5617299,-5617262,-5617226,-5617189,-5617153,-5608192,-5608156,-5608119,-5608083,-5608046,-5608010,-5607973,-5607937,
-5598720,-5598684,-5598647,-5598611,-5598574,-5598538,-5598501,-5598465,-5589504,-5589468,-5589431,-5589395,-5589358,-5589322,-5589285,-5589249,-5580032,-5579996,-5579959,-5579923,-5579886,-5579850,-5579813,-5579777,-5570816,-5570780,-5570743,-5570707,-5570670,-5570634,-5570597,-5570561,-65536,-65500,-65463,-65427,-65390,-65354,-65317,-65281,-56320,-56284,-56247,-56211,-56174,-56138,-56101,-56065,-46848,-46812,-46775,-46739,-46702,-46666,-46629,-46593,-37632,-37596,-37559,-37523,-37486,-37450,-37413,
-37377,-28160,-28124,-28087,-28051,-28014,-27978,-27941,-27905,-18944,-18908,-18871,-18835,-18798,-18762,-18725,-18689,-9472,-9436,-9399,-9363,-9326,-9290,-9253,-9217,-256,-220,-183,-147,-110,-74,-37,-1],y;y?y.resize(1024,768):y=new Ha(1024,768);var Q=y.getContext();this.writeKeyComb=function(a){var b=a.split("+"),d=b.length;if(0!=d){for(var f=null,g=0;g<d;g++)a=b[g],""==a&&""==f&&(a="Add"),""!=a&&Ga(!0,a),f=a;for(g=d-1;0<=g;g--)a=b[g],""==a&&""==f&&(a="Add"),""!=a&&Ga(!1,a),f=a}};var aa=new function(){this.ws=
null;this.capsLock=this.numLock=!1;this.setJoinMode=d.setJoinMode;this.requestControl=d.requestControl;this.writeKeyComb=d.writeKeyComb;this.remoteLockFlags=this.localLockFlags=0;this.checkLockFlags=!0;this.getAppMode=function(){return d.mode};this.send=function(a){H&&this.ws.send(a)};this.sendInput=function(a){d.writeRawInput(a);if(d.onactivity)d.onactivity(a)};this.getAppInfo=function(){return d.sessionInfo.appInfo};this.onresize=function(a){};this.onorientationchange=function(a){};this.getClipData=
Ia;this.onfocus=function(a){};this.fileCallback=[];this.getShareFiles=function(a,b){this.ws.send("3A5"+a);this.fileCallback.push(b)};this.notifyFiles=function(a){for(var b=this.fileCallback,d=0,f=b.length;d<f;d++)b[d](a)};this.getFile=function(a){window.open(d.getFileUrl(a))};this.removeFile=function(a){uploadMgr&&uploadMgr.fileService.remove(a)};this.getFileLink=function(a){return ua()+"/DOWNLOAD?s="+ea+"&f="+a};this.getGateway=function(){return h};this.reconnect=function(a,b,d){};this.sendKeyboardSyncFlags=
function(a){var b=this.remoteLockFlags;(b&7)!=a&&((b&4)!=(a&4)&&(T(!0,65549,58),T(!1,65549,58)),(b&2)!=(a&2)&&(T(!0,65407,69),T(!1,65407,69)),(b&1)!=(a&1)&&(T(!0,65300,70),T(!1,65300,70)));this.remoteLockFlags=this.localLockFlags=a}};void 0!=J.displayMsg&&(this.displayMsg=J.displayMsg);void 0!=J.reconnectTimes&&(this.reconnectTimes=J.reconnectTimes);void 0!=J.openLink&&(this.openLink=J.openLink);void 0!=J.setTitle&&(this.setTitle=J.setTitle);"boolean"==typeof J.useWSS&&(h=(J.useWSS?"wss":"ws")+h.substring(h.indexOf("://")));
this.getURL=function(){return h};var Ua=parseInt(m.server_bpp||m.color||24);this.getColor=function(){return Ua};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);l.send(b.buffer)};this.startPing=function(a,b){b=b||0;N||(N=new hi5.tool.ResponseMonitor(function(){d.sendPing()},function(){if(H&&d.onnoresponse)return d.onnoresponse()}));N.setInterval(a,b);var e=new Uint8Array(4);e[0]=146;e[1]=2;e[2]=a;e[3]=b;l.send(e.buffer);d.sendPing()};this.stopPing=function(){N&&
N.stop()};var P=null;this.setJoinMode=function(a){H&&l.send("8E1"+a)};this.refuseControl=function(a){H&&l.send("8E3"+a)};this.giveControl=function(a){H&&l.send("8E4"+a)};this.requestControl=function(){H&&l.send("8E2")};this.allowJoin=function(a,b){H&&l.send("8EA"+a+"\t"+(b?1:0))};this.play=function(){l.send("F3")};this.pause=function(){l.send("F2")};this.scan=function(a){l.send("F4"+(a?"1":"0"))};this.seek=function(a){u&&H&&(l.send("F4"+(a?"1":"0")+"\t"+(a/u.getScale()|0)),y.pause(!0))};this.run=
function(){Ka();y.startAnimation()};this.hide=function(){u&&u.hide()};this.showMessage=function(a){d.displayMsg&&a&&hi5.notifications.notify({msg:a})};this.close=function(){za=!0;if(l&&H)try{for(;l&&l.readyState!=WebSocket.CLOSING&&l.readyState!=WebSocket.CLOSED;)l.send("85"),l.close()}finally{da()}else da()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(da):window.addEventListener("unload",da,!1);var ma=new U(12,function(a){if(82!=a.getByte()||70!=a.getByte()||66!=a.getByte())d.showMessage(__svi18n.vnc.notvnc),
d.close();else{a.skip(1);d.sessionInfo.major=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);a.skip(1);d.sessionInfo.minor=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);svGlobal.logger.info("RFB major: "+d.sessionInfo.major+" minor: "+d.sessionInfo.minor);a.skip(1);a=new Uint8Array(13);for(var b=0;13>b;b++)a[b]="\u0093RFB 003.003\n".charCodeAt(b);l.send(a.buffer);x.setHandler(new U(4,function(a){a=a.getBE32();var b=0,e=0;svGlobal.logger.info("sec type:"+a);switch(a){case 1:Ca();
break;case 2:x.setHandler(new U(12,function(a){svGlobal.logger.info("vnc auth");var c=new Uint8Array(17);c[0]=32;a.copyToByteArray(c,1,a.getPosition(),16);a.skip(16);a=m.pwd||"";8<a.length&&(a=a.substring(0,8));var d=[0,0,0,0,0,0,0,0];b=0;for(e=a.length;b<e;b++)d[b]=a.charCodeAt(b);a=new DesCipher(d);a.encrypt(c,1,c,1);a.encrypt(c,9,c,9);l.send(c.buffer);x.setHandler(new U(4,oa))}));break;case -6:x.setHandler(new U(24,function(a){svGlobal.logger.info("NTLM auth");var c=new Uint8Array(345);c[0]=33;
a.copyToByteArray(c,1,a.getPosition(),24);a.skip(24);a=m.user;var d=25;if(a)for(b=0,e=a.length;b<e;b++){var f=a.charCodeAt(b);c[d++]=f&255;c[d++]=f>>8&255}d=281;if(a=m.pwd)for(b=0,e=a.length;b<e;b++)f=a.charCodeAt(b),c[d++]=f&255,c[d++]=f>>8&255;l.send(c.buffer);x.setHandler(new U(4,oa))}));break;default:d.showMessage(__svi18n.vnc.securityError),d.close()}}))}});x.setHandler(ma);this.refreshOutput=function(a,b,d,f){a=a||0;b=b||0;ra(a,b,d?d-a+1:X,f?f-b+1:Y,!1)};var pa=new U(1,function(a){var b=a.getByte();
switch(b){case 0:a.skip(1);b=a.getBE16();for(var e=0;e<b;e++){var f=a.getBE16();var g=a.getBE16();var c=a.getBE16();var k=a.getBE16();var h=a.getBE32()>>>0;switch(h){case 4294967073:ca(c,k);break;case 240:case 4294967056:0!=c*k&&a.skip(((c+7)/8|0)*k*2+6);break;case 4294967057:if(0!=c*k)if(ka)a.skip(c*k*K+((c+7)/8|0)*k);else{var l;var m=a;h=(c+7)/8|0;var q=h*k;var w=c*k,Z=new Uint32Array(w),x=m.getBytes(w*K),n=m.getBytes(q),r=0,v=0;for(q=0;q<k;q++){for(l=0;l<c/8;l++){var z=n[q*h+l];for(m=7;0<=m;m--)0!=
(z>>m&1)?1!=K&&(r=4278190080|(x[4*v+2]&255)<<16|(x[4*v+1]&255)<<8|x[4*v]&255):r=0,Z[v++]=r}for(m=7;m>=8-c%8;m--)r=0!=(n[q*h+l]>>m&1)?1==K?0:4278190080|(x[4*v+2]&255)<<16|(x[4*v+1]&255)<<8|x[4*v]&255:0,Z[v++]=r}f=new Sa(0,Z,f,g,c,k,4,4*w,w/8|0);u.setCursor(f)}break;case 4294967064:break;case 0:0<c*k&&Ea(a,f,g,c,k);break;case 1:h=a.getBE16();w=a.getBE16();R.inUse?Q.putImageData(Q.getImageData(h,w,c,k),f,g):(y.moveArea(h,w,c,k,f-h,g-w),y.repaint(f,g,c,k));break;case 5:Va.decode(a,f,g,c,k);break;case 7:R.decode(a,
f,g,c,k,!1);break;case 16:W.decode(a,f,g,c,k,!1);break;case 4294967035:f=a.getByte();g=0!=(f&4);c=0!=(f&2);k=0!=(f&1);aa.remoteLockFlags=f;aa.checkLockFlags=!0;if(d.onLockKeyState)d.onLockKeyState({capsLock:g,numLock:c,scrollLock:k});svGlobal.logger.info("LED state, capsLock:"+g+" numLock:"+c+" scrollLock:"+k);break;case 4294967038:B=new Uint8Array(13);B[0]=147;B[1]=255;B[2]=0;ta=!0;u.setUnicode(!1);if(d.oncapability)d.oncapability(d.CAP_QEMU_KEY);break;default:svGlobal.logger.warn("Encoding "+h+
" is not supported")}}ra(0,0,X,Y,!0);break;case 1:svGlobal.logger.warn("xxx color map");break;case 2:break;case 3:a.skip(3);b=a.getBE32();0<b&&(a=a.getBytes(b),b=String.fromCharCode.apply(null,a),d.onservercopy&&d.onservercopy(b)||Ra(b)||u.copyToClip("text/plain;"+b));break;case 48:b=a.getString16LE(0,a.getEnd());ia(b);a.skip(a.getEnd()-a.getPosition());break;default:svGlobal.logger.warn("XX PDU:"+b)}});2!=d.mode&&1!=d.mode||x.setHandler(pa);var R=new Da,W=new na,Va=new function(){var a=0,b=0;this.decode=
function(d,f,g,c,h){var e=f+c,k=g+h;b=a=0;for(var l=g;l<k;l+=16)for(var m=Math.min(16,k-l),u=f;u<e;u+=16){var q=d,w=u,n=l,r=Math.min(16,e-u),v=m,z=q.getByte();if(0!=(z&1))Ea(q,w,n,r,v,!1);else if(0!=(z&2)&&(1==K?a=V[q.getByte()]:(a=q.getByte()|q.getByte()<<8|q.getByte()<<16|4278190080,q.skip(1))),y.fillRect(w,n,r,v,a),0!=(z&4)&&(1==K?b=V[q.getByte()]:(b=q.getByte()|q.getByte()<<8|q.getByte()<<16|4278190080,q.skip(1))),0!=(z&8)){var r=q.getByte(),t;if(0!=(z&16))if(1==K)for(t=0;t<r;t++){b=V[q.getByte()];
var p=q.getByte();z=p>>4;v=p&15;p=q.getByte();var x=1+(p>>4);p=1+(p&15);y.fillRect(w+z,n+v,x,p,b)}else for(t=0;t<r;t++)b=q.getByte()|q.getByte()<<8|q.getByte()<<16|4278190080,q.skip(1),p=q.getByte(),z=p>>4,v=p&15,p=q.getByte(),x=1+(p>>4),p=1+(p&15),y.fillRect(w+z,n+v,x,p,b);else for(t=0;t<r;t++)p=q.getByte(),z=p>>4,v=p&15,p=q.getByte(),x=1+(p>>4),p=1+(p&15),y.fillRect(w+z,n+v,x,p,b)}}y.postPaint(f,g,c,h)}};this.resetStatus=la;this.addSurface=function(a){u=a;ga&&a.setPlayerMode();y.setContext(u.context);
Q=y.getContext();a.setAutoScale(0<d.mode);a.setSize(X,Y);a.setController(aa);a.setFastCopy(M(m.fastCopy));a.setTouchpad(M(m.touchpad));a.setClipboard(M(m.mapClipboard));a.run(99997);u.setImageCursor(!1);ya(u);a.onclipdata=Ta};var L=new Uint8Array(7);L[0]=147;L[1]=5;var Fa=!1,G=new Uint8Array(13);G[0]=147;G[1]=5;G[7]=5;G[8]=0;this.mouseDown=function(a,b,d){sa(!0,d,a,b)};this.mouseMove=function(a,b){sa(Fa,0,a,b)};this.mouseUp=function(a,b,d){sa(!1,d,a,b)};this.writeKeyCode=function(a,b){d.writeRawInput("8B"+
(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){H&&("number"==typeof a?(d.writeRawInput("840\t"+a),d.writeRawInput("8449152\t"+a)):d.writeRawInput("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){d.writeRawInput("86"+a)};var Aa={57:32,201:65365,209:65366,207:65367,199:65360,203:65361,200:65362,205:65363,208:65364,183:65377,84:65377,197:65299,198:65299,210:65379,211:65535,184:65514,219:65515,220:65516,1:65307,14:65288,15:65289,28:65293,29:65507,42:65505,54:65506,56:65513,59:65470,60:65471,
61:65472,62:65473,63:65474,64:65475,65:65476,66:65477,67:65478,68:65479,87:65480,88:65481,55:65450,69:65407,70:65300,71:65429,72:65431,73:65434,74:65453,75:65430,76:65437,77:65432,78:65451,79:65436,80:65433,81:65435,82:65438,83:65439,156:65430,157:65508,181:65455},Wa={260:417,728:418,321:419,317:421,346:422,352:425,350:426,356:427,377:428,381:430,379:431,261:433,731:434,322:435,318:437,347:438,711:439,353:441,351:442,357:443,378:444,733:445,382:446,380:447,340:448,258:451,313:453,262:454,268:456,
280:458,282:460,270:463,272:464,323:465,327:466,336:469,344:472,366:473,368:475,354:478,341:480,259:483,314:485,263:486,269:488,281:490,283:492,271:495,273:496,324:497,328:498,337:501,345:504,367:505,369:507,355:510,729:511,294:673,292:678,304:681,286:683,308:684,295:689,293:694,305:697,287:699,309:700,266:709,264:710,288:725,284:728,364:733,348:734,267:741,265:742,289:757,285:760,365:765,349:766,312:930,342:931,296:933,315:934,274:938,290:939,358:940,343:947,297:949,316:950,275:954,291:955,359:956,
330:957,331:959,256:960,302:967,278:972,298:975,325:977,332:978,310:979,370:985,360:989,362:990,257:992,303:999,279:1004,299:1007,326:1009,333:1010,311:1011,371:1017,361:1021,363:1022,8254:1150,12290:1185,12300:1186,12301:1187,12289:1188,12539:1189,12530:1190,12449:1191,12451:1192,12453:1193,12455:1194,12457:1195,12515:1196,12517:1197,12519:1198,12483:1199,12540:1200,12450:1201,12452:1202,12454:1203,12456:1204,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,
12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12516:1236,12518:1237,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12531:1245,12443:1246,12444:1247,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,
1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1106:1697,1107:1698,1105:1699,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,8470:1712,
1026:1713,1027:1714,1025:1715,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1102:1728,1072:1729,1073:1730,1094:1731,1076:1732,1077:1733,1092:1734,1075:1735,1093:1736,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1103:1745,1088:1746,1089:1747,1090:1748,1091:1749,1078:1750,1074:1751,1100:1752,1099:1753,1079:1754,1096:1755,1101:1756,1097:1757,1095:1758,1098:1759,1070:1760,1040:1761,1041:1762,1062:1763,1044:1764,
1045:1765,1060:1766,1043:1767,1061:1768,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1071:1777,1056:1778,1057:1779,1058:1780,1059:1781,1046:1782,1042:1783,1068:1784,1067:1785,1047:1786,1064:1787,1069:1788,1065:1789,1063:1790,1066:1791,902:1953,904:1954,905:1955,906:1956,938:1957,908:1959,910:1960,939:1961,911:1963,901:1966,8213:1967,940:1969,941:1970,942:1971,943:1972,970:1973,912:1974,972:1975,973:1976,971:1977,944:1978,974:1979,913:1985,914:1986,915:1987,916:1988,
917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2E3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,963:2034,962:2035,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,9143:2209,9484:2210,9472:2211,8992:2212,8993:2213,9474:2214,9121:2215,9123:2216,9124:2217,9126:2218,
9115:2219,9117:2220,9118:2221,9120:2222,9128:2223,9132:2224,8804:2236,8800:2237,8805:2238,8747:2239,8756:2240,8733:2241,8734:2242,8711:2245,8764:2248,8771:2249,8660:2253,8658:2254,8801:2255,8730:2262,8834:2266,8835:2267,8745:2268,8746:2269,8743:2270,8744:2271,8706:2287,402:2294,8592:2299,8593:2300,8594:2301,8595:2302,9670:2528,9618:2529,9225:2530,9228:2531,9229:2532,9226:2533,9252:2536,9227:2537,9496:2538,9488:2539,9492:2541,9532:2542,9146:2543,9147:2544,9148:2546,9149:2547,9500:2548,9508:2549,9524:2550,
9516:2551,8195:2721,8194:2722,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8212:2729,8211:2730,8230:2734,8229:2735,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8453:2744,8210:2747,9001:2748,9002:2750,8539:2755,8540:2756,8541:2757,8542:2758,8482:2761,9747:2762,9665:2764,9655:2765,9675:2766,9647:2767,8216:2768,8217:2769,8220:2770,8221:2771,8478:2772,8242:2774,8243:2775,10013:2777,9644:2779,9664:2780,9654:2781,9679:2782,9646:2783,9702:2784,9643:2785,
9645:2786,9651:2787,9661:2788,9734:2789,8226:2790,9642:2791,9650:2792,9660:2793,9756:2794,9758:2795,9827:2796,9830:2797,9829:2798,10016:2800,8224:2801,8225:2802,10003:2803,10007:2804,9839:2805,9837:2806,9794:2807,9792:2808,9742:2809,8981:2810,8471:2811,8248:2812,8218:2813,8222:2814,60:2979,62:2982,175:3008,8869:3010,8970:3012,95:3014,8728:3018,9109:3020,8868:3022,8968:3027,8866:3036,8867:3068,8215:3295,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,
1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,
3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,12593:3745,
12594:3746,12595:3747,12596:3748,12597:3749,12598:3750,12599:3751,12600:3752,12601:3753,12602:3754,12603:3755,12604:3756,12605:3757,12606:3758,12607:3759,12608:3760,12609:3761,12610:3762,12611:3763,12612:3764,12613:3765,12614:3766,12615:3767,12616:3768,12617:3769,12618:3770,12619:3771,12620:3772,12621:3773,12622:3774,12623:3775,12624:3776,12625:3777,12626:3778,12627:3779,12628:3780,12629:3781,12630:3782,12631:3783,12632:3784,12633:3785,12634:3786,12635:3787,12636:3788,12637:3789,12638:3790,12639:3791,
12640:3792,12641:3793,12642:3794,12643:3795,4520:3796,4521:3797,4522:3798,4523:3799,4524:3800,4525:3801,4526:3802,4527:3803,4528:3804,4529:3805,4530:3806,4531:3807,4532:3808,4533:3809,4534:3810,4535:3811,4536:3812,4537:3813,4538:3814,4539:3815,4540:3816,4541:3817,4542:3818,4543:3819,4544:3820,4545:3821,4546:3822,12653:3823,12657:3824,12664:3825,12671:3826,12673:3827,12676:3828,12678:3829,12685:3830,12686:3831,4587:3832,4592:3833,4601:3834,8361:3839,8364:5028,338:5052,339:5053,376:5054},B=new Uint8Array(9);
B[0]=147;B[1]=4;this.writeRawInput=function(a){if(ba){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");var e=0;switch(b){case 128:d.mouseDown(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 129:d.mouseUp(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 130:d.mouseMove(parseInt(a[0]),parseInt(a[1]));return;case 131:b=0!=parseInt(a[2]);e=parseInt(a[0]);a=parseInt(a[1]);ba&&(G[2]=b?16:8,G[3]=e>>8&255,G[4]=e&255,G[5]=a>>8&255,G[6]=a&255,G[9]=G[3],G[10]=G[4],G[11]=G[5],
G[12]=G[6],l.send(G.buffer));return;case 132:e=Aa[a[1]]||0;var f=0==a[0];T(f,e,parseInt(a[1],10));break;case 139:f=0==a[0];e=parseInt(a[1]);T(f,e,parseInt(a[2]));break;case 134:if(!ta){f=0;for(var g=a[0].length;f<g;f++){e=a[0].charCodeAt(f);if(255<e)var c=Wa[e],e=c?c:e|16777216;T(!0,e,0);T(!1,e,0)}}}1>e&&svGlobal.logger.info("Unknowncode: "+a[1]+" type:"+b)}};var Ba={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,
altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78}};
