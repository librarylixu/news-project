var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(g,p,q){if(null==g)throw new TypeError("The 'this' value for String.prototype."+q+" must not be null or undefined");if(p instanceof RegExp)throw new TypeError("First argument to String.prototype."+q+" must not be a regular expression");return g+""};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(g,p,q){g!=Array.prototype&&g!=Object.prototype&&(g[p]=q.value)};
$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(g,p,q,y){if(p){q=$jscomp.global;g=g.split(".");for(y=0;y<g.length-1;y++){var I=g[y];I in q||(q[I]={});q=q[I]}g=g[g.length-1];y=q[g];p=p(y);p!=y&&null!=p&&$jscomp.defineProperty(q,g,{configurable:!0,writable:!0,value:p})}};
$jscomp.polyfill("String.prototype.startsWith",function(g){return g?g:function(g,q){var p=$jscomp.checkStringArgs(this,g,"startsWith");g+="";for(var I=p.length,ga=g.length,ra=Math.max(0,Math.min(q|0,p.length)),V=0;V<ga&&ra<I;)if(p[ra++]!=g[V++])return!1;return V>=ga}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(g){return g?g:function(g,q,y){var p=this.length||0;0>q&&(q=Math.max(0,p+q));if(null==y||y>p)y=p;y=Number(y);0>y&&(y=Math.max(0,p+y));for(q=Number(q||0);q<y;q++)this[q]=g;return this}},"es6-impl","es3");var svManager={getInstance:function(){var g=window.$ssh;return g&&g.running&&g.running()?g:null}};
function connvertServer(g){var p={};p.id=g.id;p.server=g.id;p.displayName=g.displayName||g.id;if(g=g.ssh){for(var q in g)p[q]=g[q];p.user=g.username||"";p.pwd=g.password||""}return p}
svGlobal.SSH=function(g,p,q,y){function I(a){return"on"==a||"true"==a}function ga(){var a=g.indexOf("://"),b=g.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function ra(a){return sa?hi5.browser.httpGet(ga()+"/CLIP?s="+sa+"&t="+(new Date).getTime(),!1):""}function V(a,b){b&&(H=b);a&&(J=a,ta=(J-1)*k);Ia=1==H&&J==Math.floor(q/k)}function Ca(a,b){var d=Math.floor(b/k),c=Math.floor(a/w),e=null;E&&(e=l.getImageData(0,0,Math.min(c*w,F),Math.min(d*k,W*k)));p=a;
q=b;x.setSize(a,b);N.width=a;N.height=b;l.textBaseline="top";var h=n.fontFamily||"Courier New";0<h.indexOf(" ")&&(h="'"+h+"'");l.font=n.fontSize+"px "+h;ua();e&&l.putImageData(e,0,0);W=d;X=c;F=X*w;V(Math.floor(q/k));z=new Ja(X,W);if(f.onresolutionchange)f.onresolutionchange(p,q)}function va(a){u.send(a)}function Ka(a,b,d){this.need=a;this.handler=b;this.repeat=d||1}function bb(a){O=new RecordingManager;O.setHeader({name:0<a.user.length?a.server+"_"+a.user:a.server,width:a.width,height:a.height,color:a.fontSize,
namesuffix:".sshv",filetag:"SSHV",duration:0})}function cb(a,b){var d=0,c=!1;this.width=a;this.interval=b;var e=0;this.start=function(){c||(c=!0,d=setInterval(function(){if(x&&E){var c=x.getThumbnail(a);c&&c.length!=e&&(u.send("8E7"+c),e=c.length)}},b))};this.stop=function(){clearInterval(d)}}function db(a,b){!K||K.width==a&&K.interval==b||(K.stop(),K=null);K||(K=new cb(a,b));K.start()}function eb(a){var b=parseInt(a.substring(0,1),16),d=a.substring(1);a=!1;var c=f.sessionInfo.appInfo;switch(b){case 1:var e=
JSON.parse(d);f.onsessionjoin&&(a=f.onsessionjoin(e));if(a)break;f.showMessage(__svi18n.info.joinsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 2:e=JSON.parse(d);f.onsessionexit&&(a=f.onsessionexit(e));if(a)break;f.showMessage(__svi18n.info.exitsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 3:e=JSON.parse(d);c.joinMode!=e.mode&&(c.joinMode=e.mode,b=hi5.$("joinSelect"))&&(b.value=e.mode);if(c.hasControl)break;x.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;f.ongivecontrol&&
(a=f.ongivecontrol());if(a)break;f.showMessage(__svi18n.info.givecontrol);break;case 4:x.setReadOnly(!0);c.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;f.ontakebackcontrol&&(a=f.ontakebackcontrol());if(a)break;f.showMessage(__svi18n.info.nocontrol);break;case 5:e=JSON.parse(d);f.onrequirecontrol&&(a=f.onrequirecontrol(e));if(a)break;a=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);hi5.notifications.notify({title:a,msg:__svi18n.info.recontrol,cbYes:function(){f.giveControl(e.numericId);
this.destroy()},cbNo:function(){f.refuseControl(e.numericId);this.destroy()}});break;case 6:x.setTouchRemoting(!0);break;case 7:e=JSON.parse(d);e.width&&e.height&&Ca(e.width,e.height);break;case 8:e=JSON.parse(d);if(f.onrequestcredential&&f.onrequestcredential(e))break;x.requestCredential(e);break;case 9:e=JSON.parse(d);0<e.interval&&0<e.width?db(e.width,e.interval):K&&(K.stop(),K=null);break;case 11:e=JSON.parse(d),f.onrequirejoin&&(a=f.onrequirejoin(e)),a||(a=__svi18n.info.title.applyArgs([e.name,
e.numericId,e.__ip]),hi5.notifications.notify({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){f.allowJoin(e.numericId,!0);this.destroy()},cbNo:function(){f.allowJoin(e.numericId,!1);this.destroy()}}))}}function ba(a){ha.style.display=a?"none":"block"}function fb(a){svGlobal.logger.info("opened...");E=!0;u.send("87"+navigator.userAgent);if(f.onopen)f.onopen()}function gb(a){svGlobal.logger.warn(a)}function wa(a){svGlobal.logger.warn("closed ...");ba(!0);ia=E=!1;if(f&&f.onclose)f.onclose();try{null!=
O&&(O.exit(),O=null),x&&x.close()}catch(b){}Y&&(Y.release(),Y=null);N=l=null;u&&(u.onopen=null,u.onmessage=null,u.onclose=null,u=u.onerror=null);x=La=null;f&&(f=null);window&&window.$ssh&&(window.$ssh=null);null!=O&&(O.exit(),O=null)}function Ma(){10>n.fontSize&&(n.fontSize=10);13>n.fontSize?k=n.fontSize+6:12<n.fontSize&&19>n.fontSize?k=n.fontSize+8:18<n.fontSize&&25>n.fontSize?k=n.fontSize+12:24<n.fontSize&&(k=n.fontSize+16);n.lineHeight&&(k=parseInt(n.lineHeight));Na=(k-n.fontSize)/2|0;l.textBaseline=
"top";var a=n.fontFamily||"Courier New";0<a.indexOf(" ")&&(a="'"+a+"'");l.font=n.fontSize+"px "+a;w=l.measureText("X").width;W=parseInt(q/k);X=parseInt(p/w);F=X*w;V(parseInt(q/k));z=new Ja(X,W)}function Da(){ua();t=r=0;Ma();ha.style.width=w+"px";ha.style.height=k+"px";remotectrl.style.cursor="text";ia=!0}function Oa(a){switch(a){case 0:break;case 5:break;case 7:break;case 8:Ea();break;case 9:a=r/w/8;a=parseInt(a)+1;r=8*a*w;ja();break;case 10:t+=k;ja();break;case 11:t+=k;ja();break;case 12:break;case 13:if(T){if(T&&
(a=z.getSingleLine(L(),T,M()))){if(f.oncommand)f.oncommand(a);a.startsWith("cd /")&&x.setDirectory(a.substring(3))}T=0}r=0;t>(J-1)*k&&(t=(J-1)*k);break;case 14:break;case 15:break;default:console.log("Unknown C0 control:"+a)}}function hb(a){var b=a.getPosition();if(!Q.parse(a))return a.setPosition(b-2),!1;a=Q.count;b=Q.parameters;switch(Q.command){case 64:0==a&&(b[0]=1);a=b[0];for(var b="",d=a*w,c=l.getImageData(r,t,F-r-d,k),e=0;e<a;e++)b+=" ";ca(b);r-=d;l.putImageData(c,r+d,t);z.insertSpace(a,M(),
L());break;case 65:0==a&&(b[0]=1);t-=(b[0]||1)*k;break;case 66:0==a&&(b[0]=1);t+=(b[0]||1)*k;break;case 67:0==a&&(b[0]=1);r+=(b[0]||1)*w;break;case 68:0==a&&(b[0]=1);r-=(b[0]||1)*w;break;case 69:0==a&&(b[0]=1);t+=b[0]*k;r=0;break;case 70:0==a&&(b[0]=1);t-=b[0]*k;r=0;break;case 71:0==a&&(b[0]=1);xa(0,b[0]);break;case 72:case 102:0==a&&(b[0]=b[1]=1);xa(b[0]||1,b[1]||1);break;case 74:a||(b[0]=0);switch(b[0]){case 0:l.fillStyle=C;l.fillRect(r,t,F-r,W*k-t);l.fillStyle=A;z.clearEOS(M(),L());break;case 1:l.fillStyle=
C;l.fillRect(0,0,r,t);l.fillStyle=A;z.clearBOS(M(),L());break;case 2:ua();t=r=0;z.cleanScreen();break;case 3:ua();t=r=0;z.cleanScreen();break;default:console.log("invalid CSI J:"+b[0])}break;case 75:a||(b[0]=0);switch(b[0]){case 0:Pa();break;case 1:l.fillStyle=C;l.fillRect(0,t,r,k);l.fillStyle=A;z.clearBOL(M(),L());break;case 2:l.fillStyle=C;l.fillRect(0,t,F,k);l.fillStyle=A;z.clearLine(L());break;default:console.log("invalid CSI K:"+b[0])}break;case 76:case 84:a||(b[0]=1);Qa(b[0]);break;case 77:case 83:a||
(b[0]=1);Ra(b[0]);break;case 80:a||(b[0]=1);a=b[0];b=r+a*w;b=l.getImageData(b,t,F-b,k);Pa();l.putImageData(b,r,t);z.deleteChars(M(),L(),a);break;case 88:a||(b[0]=1);a=b[0];l.fillStyle=C;l.fillRect(r,t,a*w,k);l.fillStyle=A;z.eraseChars(M(),L(),a);break;case 90:a||(b[0]=1);r=8*((r/w/8|0)-b[0]+1)*w;ja();break;case 100:a||(b[0]=1);xa(b[0]);break;case 101:a||(b[0]=1);xa(L()+b[0]);break;case 104:if(63==Q.mode)switch(b[0]){case 7:console.log("wraparound mode on");ka=!0;break;case 25:ba(!1);break;case 45:console.log("reverse-wraparound mode on");
break;case 1E3:case 1001:case 1002:case 1003:console.log("mouse tracking on"),la=b[0]}break;case 108:if(63==Q.mode)switch(b[0]){case 7:ka=!1;break;case 25:ba(!0);break;case 45:console.log("reverse-wraparound mode off");break;case 1E3:case 1001:case 1002:case 1003:la=0}break;case 109:0==a&&(a=1,b[0]=0);for(d=0;d<a;d++)switch(b[d]){case 0:ma(7);na(0);Fa(!1);break;case 1:Fa(!0);break;case 2:break;case 4:break;case 5:case 8:break;case 7:ma(0);na(7);break;case 27:ma(7);na(0);break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:ma(b[d]-
30);break;case 38:return 2==b[d+1]&&(A="rgb("+b[d+2]+","+b[d+3]+","+b[d+4]+")",l.fillStyle=A),!0;case 39:ma(7);break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:na(b[d]-40);break;case 48:return 2==b[d+1]&&(C="rgb("+b[d+2]+","+b[d+3]+","+b[d+4]+")"),!0;case 49:na(0);1==d&&39==b[0]&&Fa(!1);break;default:return console.log("TODO: SGR="+Q.toString()),!0}break;case 114:Q.mode||V(b[1],b[0]);break;default:console.log("TODO: CSI="+Q.toString())}return!0}function Qa(a){a||(a=1);var b=(H-
1)*k,d=l.getImageData(0,b,F,(J-H-a+1)*k);l.fillStyle=C;l.fillRect(0,b,F,k*a);l.putImageData(d,0,(H+a-1)*k);l.fillStyle=A;z.scrollUp(a,H,J)}function Ra(a){a||(a=1);var b=(H-1)*k,d=J*k,c=a*k,e=b+c,e=l.getImageData(0,e,F,d-e);l.fillStyle=C;l.fillRect(0,d-c,F,c);l.fillStyle=A;l.putImageData(e,0,b);z.scrollDown(a,H,J)}function ja(){ka&&r>F&&(r=0,t+=k);if(ka&&t>ta){for(;t>ta;)t-=k;if(Ia)l.drawImage(N,0,-k),l.fillStyle=C,l.fillRect(0,ta,p,k),z.appendLines(1);else{var a=l.getImageData(0,0+(H-0)*k,F,(J-H)*
k);l.fillStyle=C;l.fillRect(0,(H-1)*k,F,(J-H+1)*k);l.putImageData(a,0,0+(H-1)*k)}l.fillStyle=A}}function Ea(){r-=w;0>r&&(r=0)}function L(){return parseInt(t/k)+1}function M(){return parseInt(r/w)+1}function xa(a,b){b&&(r=(b-1)*w,0>r&&(r=0));a&&(t=(a-1)*k)}function na(a){C=ya[a];C||(C=n.bgColor||"black",console.log("xx colorIndex:"+a))}function ma(a){Sa=a;A=oa[a];A||(A=n.fgColor||"white",console.log("xx colorIndex:"+a));l.fillStyle=A}function Fa(a){oa=a?Ta:ya;A=oa[Sa]}function Pa(){l.fillStyle=C;l.fillRect(r,
t,F-r,k);l.fillStyle=A;z.clearEOL(M(),L())}function ua(){l.fillStyle=C;l.fillRect(0,0,N.width,N.height);l.fillStyle=A}function ca(a){if(a){z.writeText(M(),L(),a);C==A&&console.log("text:"+a+" bgColor:"+C+" fgColor:"+A);Ua=a.length;var b=Ua*w;l.fillStyle=C;l.fillRect(r,t,b,k);l.fillStyle=A;l.fillText(a,r,t+Na);r+=b;ja()}}function ib(a,b){for(var d=a.getPosition(),c,e="",h=a.getEnd(),m=a.getData();d<h;)if(c=m[d++],c!=b)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(c);
break;case 12:case 13:e+=String.fromCharCode((c&31)<<6|m[d++]&63);break;case 14:e+=String.fromCharCode((c&15)<<12|(m[d++]&63)<<6|(m[d++]&63)<<0)}else break;a.setPosition(d);return e}function jb(a){if(E)return(a=a.getData("text/plain"))?(a=a.replace(/\r\n/g,"\n"),R(a),!0):!1}function Va(){if(P){var a=!!P.value;P.value=z.toString();a||(a=new hi5.ui.Lightbox(document.getElementById("copydialog")),a.show(),x&&x.setIgnorePaste(!1),a.onclose=function(){P.value=""});setTimeout(function(){P.scrollTop=P.scrollHeight},
10)}}function kb(a){var b={},d=0,c=a;this.enabled=!1;hi5.EventControl(this);var e=this,h=null,m=0,v=!0,D=!0;this.setDownload=function(a){v=a};this.setUpload=function(a){D=a};this.release=function(){b=c=a=e=null};this.read=function(c,m,h){var v=b[b[c]];if("undefined"!=typeof v){var D=v.name;if(1>v.size)f.showMessage(__svi18n.file.zero+D,null,3E3);else{var D=v.slice(m,m+h),g=new FileReader;g.onloadend=function(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(c,m,h,
b,v.preferPaste),d+=h,e.fireEvent("progress",[d]))};g.readAsArrayBuffer(D)}}};this.mkdirs=function(c){e.enabled&&("/"!=c.charAt(c.length-1)&&(c+="/"),a.start([c],0,!0))};this.addFiles=function(c,d){var h=c.length;if(h&&e.enabled&&D){var v=d&&!!(Z&65536);m=Date.now();for(var g=0;g<h;g++){var da=c[g];d&&(da.preferPaste=!0);var k=da.fullPath||da.name;if(f.beforeupload&&f.beforeupload(da,k,v))return;e.fireEvent("beforeupload",[da,k,v]);k=encodeURIComponent(k);b[k]=da}a.start(c,d);e.fireEvent("uploadstarted",
[v])}};this.removeFile=function(a){c.remove(a)};this.confirmId=function(a,c,e){b[a]=c;e&&(d+=parseInt(e))};this.close=function(a){var c=!0,h={size:d,duration:Date.now()-m};if(a){var v=b[a];if(v){c=b[v].preferPaste;delete b[a];delete b[v];a=decodeURIComponent(v);if(f.onfileuploaded)f.onfileuploaded(a,c,h);e.fireEvent("fileuploaded",[a,c&&!!(Z&65536),h])}for(var D in b)return}else b={};m=d=0;e.fireEvent("uploaded",[c&&!!(Z&65536),h]);if(f.onuploaded)f.onuploaded(c&&!!(Z&65536),h)};this.cancelAll=function(){c.cancelAll();
if(f.onuploadingCancelled)f.onuploadingCancelled();e.fireEvent("uploadingCancelled");e.close()};this.list=function(a,b){h=b;c.list(a)};this.notifyFiles=function(a){h&&h(a);e.fireEvent("files")};this.download=function(){v&&c.download()}}function lb(){function a(a,d){var c=d.length,b=new Uint8Array(2+2*c);b[0]=58;b[1]=a;for(var h,m=2,v=0;v<c;v++)h=d.charCodeAt(v),b[m++]=h&255,b[m++]=h>>8&255;va(b.buffer)}this.start=function(a,d,c){for(var b=a.length,h=20*b+2,m=0,v=new Uint8Array(8),D=2,g,f,k;m<b;m++)h=
c?h+2*(encodeURIComponent(a[m]).length+1):h+2*(encodeURIComponent(a[m].fullPath||a[m].name).length+1);h=new Uint8Array(h);h[0]=58;h[1]=0;d&&(h[1]|=128);for(m=0;m<b;m++){d=c?0:a[m].size;h[D++]=d&255;h[D++]=d>>8&255;h[D++]=d>>16&255;h[D++]=d>>24&255;D+=4;c||hi5.NumUtils.toBytes(a[m].lastModified||a[m].lastModifiedDate.getTime(),v);h.set(v,D);D+=12;d=encodeURIComponent(c?a[m]:a[m].fullPath||a[m].name);g=d.length;for(f=0;f<g;f++)k=d.charCodeAt(f),h[D++]=k&255,h[D++]=k>>8&255;D+=2}va(h.buffer)};this.send=
function(a,d,c,e,h){var b=new Uint8Array(22+c);b[0]=58;b[1]=3;h&&(b[1]|=128);h=2;b[h++]=a&255;b[h++]=a>>8&255;b[h++]=a>>16&255;b[h++]=a>>24&255;b[h++]=d&255;b[h++]=d>>8&255;b[h++]=d>>16&255;b[h++]=d>>24&255;h+=4;b[h++]=c&255;b[h++]=c>>8&255;b[h++]=c>>16&255;b[h++]=c>>24&255;b.set(e,h+4);va(b.buffer)};this.remove=function(b){a(6,b)};this.list=function(b){a(5,b)};this.cancelAll=function(){a(7,"")};this.download=function(){a(136,"")}}function Wa(a){I(n.mapDisk)&&(G||(G=new kb(new lb),G.enabled=!0),a.setFileHandler(G))}
function R(a){if(a){a=unescape(encodeURIComponent(a));var b=a.length+1,d=new Uint8Array(b);d[0]=147;for(var c=1;c<b;c++)d[c]=a.charCodeAt(c-1);u.send(d.buffer)}}function Ja(a,b,d){function c(){var c=Array(a);hi5.Arrays.fill(c,0,a," ");return c}var e=0,h=[];if(!d||10>d/b)d=10*b;this.writeText=function(a,b,d){b--;a--;var m=h[e+b];m||(m=c(),h[e+b]=m);b=0;for(var v=d.length;b<v;b++)m[b+a]=d[b]};this.appendLines=function(a){e+=a};this.scrollDown=function(a,b,d){d=e+d-1-a;for(b=e+b-1;b<=d;b++)h[b]=h[b+
a];d++;for(b=0;b<a;b++)h[d+b]=c()};this.scrollUp=function(a,b,d){b=e+b-1+a;for(d=e+d-1;d>=b;d--)h[d]=h[d-a];b--;for(d=0;d<a;d++)h[b-d]=c()};this.cleanScreen=function(){e=h.length;if(e>=d){var a=2*b;h.splice(0,a);e-=a}};this.clearEOS=function(c,d){d--;c--;for(var m=e+d,f,g,v=0,k=b-d;v<k;v++)if(g=h[m+v])for(f=c;f<a;f++)g[f]=" "};this.clearBOS=function(a,b){b--;a--;for(var c=e,d,m,f=0;f<b;f++)if(m=h[c+f])for(d=0;d<a;d++)m[d]=" "};this.clearLine=function(b){b--;hi5.Arrays.fill(h[e+b],0,a," ")};this.clearBOL=
function(a,b){b--;a--;var c=h[e+b];if(c)for(var d=0;d<a;d++)c[d]=" "};this.clearEOL=function(b,c){c--;b--;var d=h[e+c];if(d)for(var m=b;m<a;m++)d[m]=" "};this.eraseChars=function(a,b,c){b--;a--;if(b=h[e+b]){var d=a;for(a+=c;d<a;d++)b[d]=" "}};this.deleteChars=function(a,b,c){b--;a--;(b=h[e+b])&&b.splice(a,c)};this.insertSpace=function(a,b,c){c--;b--;if(c=h[e+c]){for(var d=c.length-1;d>=b;d--)c[d+a]=c[d];for(d=0;d<a;d++)c[b+d]=" "}};this.getSingleLine=function(a,b,c){a--;b--;c--;var d="";if(a=h[e+
a])for(;b<c;b++)d+=a[b];return d.trim()};this.getMultiLines=function(b,c,d,f){if(f<c)return this.getMultiLines(d,f,b,c);var m=f-c+1;if(1>m)return null;if(1==m)return this.getSingleLine(c,b,d);b=this.getSingleLine(c,b,a);d=this.getSingleLine(f,1,d);m-=2;c+=e;for(var g=0;g<m;g++)b=(f=h[g+c])?b+("\r\n"+f.join("")):b+"\r\n\r\n";return b+"\r\n"+d};this.toString=function(){for(var a="",b=0,c=h.length;b<c;b++)h[b]&&(a+=h[b].join("")),a+="\r\n";return a}}sessionStorage&&sessionStorage.clear();var T=0,S=null;
this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;this.getHistory=function(){return z.toString()};var Ga="object"==typeof g?g:null,Xa="object"==typeof g||0<g.indexOf("/PLAY?");Xa?(this.mode=1,Ga&&(g=""),g+="&touchpad=on"):0<g.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var B=hi5.appcfg||{img:{},toolbar:{fadable:!0}},n=hi5.tool.queryToObj(g.substring(g.indexOf("?")+1));n.color||(n.color=32);var P=I(n.mapClipboard)?document.getElementById("copytextarea"):
null,z=null;P&&(P.value="");this.server=n.server;this.port=parseInt(n.port,10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var x=null,E=!1,ia=!1,Z=0,sa="",la=0,G=null;B.copyDialog=!0;var r=0,t=0,w=0,k=18,Na=0,ya="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),Ta="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),oa=ya,A=n.fgColor||oa[7],C=n.bgColor||oa[0],Sa=0,ka=!0;n.wraparoundMode&&(ka=I(n.wraparoundMode));
var H=1,J=24,ta=0,Ia=!0,ha=document.getElementById("cursorID"),W=0,X=0,F=0,Ua=0,O=null;window.$ssh=this;var Y=new function(a){var b=0,d=0,c=new Uint8Array(a),e=this,h=new Ka(0,null,0);this.needMore=!1;this.release=function(){e=c=h=null};this.getHandler=function(){return h};this.getData=function(){return c};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=function(){return d};this.has=function(a){return d-b>=a};this.set=function(a){var e=a.length,h=d-b;if(1>h)d=e,
c=a;else{var f=c.subarray(b,d);d=h+e;e=new Uint8Array(d);e.set(f);e.set(a,h);c=e}b=0};this.handle=function(){h.handler(e,h)};this.setHandler=function(a){a&&1>a.need&&svGlobal.logger.warn("need < 1");(h=a)&&d-b>=a.need&&a.handler(e,a)};this.getByte=function(){return c[b++]};this.peekByte=function(){return c[b]};this.getBE32=function(){return c[b++]<<24|c[b++]<<16|c[b++]<<8|c[b++]};this.getBE16=function(){return c[b++]<<8|c[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=
function(a,d){if(d)for(var e=0;e<a;e++)d[e]=c[b++];else return e=b,b+=a,c.subarray(e,b)};this.copyToByteArray=function(a,b,d,e){hi5.Arrays.arraycopy(c,d,a,b,e)}}(4194304);this.__que=Y;this.running=function(){return E};this.setColorTable=function(a){ya=a};this.setColorTableBright=function(a){Ta=a};this.loadbalanceToken=B.loadbalanceTokenName?B.loadbalanceTokenName+"="+hi5.tool.uuid():"";var f=this,u=null;p||(p=window.innerWidth);n.width=p;g+="&width="+p;q||(q=window.innerHeight);n.height=q;g+="&height="+
q;y=(y=y||n.fontSize)?parseInt(y):13;n.fontSize?(y=parseInt(n.fontSize,10),n.fontSize=y):(n.fontSize=y,g+="&fontSize="+y);var Ya,N=document.createElement("canvas"),l;this.modifyURL=function(a){f.loadbalanceToken&&(a+="&"+f.loadbalanceToken);return a};this.__write=va;this.getFileUrl=function(a){return f.modifyURL(ga()+"/DOWNLOAD?s="+sa+"&f="+a)};this.listFiles=function(a,b){G&&G.list(a,b)};var La=new function(a){this.setJoinMode=f.setJoinMode;this.requestControl=f.requestControl;this.writeKeyComb=
f.writeKeyComb;this.getAppMode=function(){return f.mode};this.send=function(b){"891"!=b&&E&&a.__write(b)};this.sendInput=function(a){f.writeRawInput(a);if(f.onactivity)f.onactivity(a)};var b=null;this.getAppInfo=function(){return f.sessionInfo.appInfo};this.onresize=function(a){if(a=a.target.svSurface){a=a.getFreeSpace();var c=a.width,e=a.height;hi5.browser.isTouch||hi5.browser.isOpera||!E||(b&&(clearTimeout(b),b=null),b=setTimeout(function(){Ca(c,e);var a=p,b=q;var d=parseInt(a/w);var f=parseInt(b/
k);u.send("ED"+d+"\t"+f+"\t"+a+"\t"+b)},200))}};this.onorientationchange=function(a){};this.getClipData=ra;this.onfocus=function(a){};this.getShareFiles=a.listFiles;this.getFile=function(b){var c=a.getFileUrl(b);f.ondownload&&f.ondownload({fileName:b,url:c})||window.open(c)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return g};this.reconnect=function(a,b,e){}}(this);void 0!=B.displayMsg&&(this.displayMsg=B.displayMsg);void 0!=B.reconnectTimes&&(this.reconnectTimes=B.reconnectTimes);
void 0!=B.openLink&&(this.openLink=B.openLink);void 0!=B.setTitle&&(this.setTitle=B.setTitle);"boolean"==typeof B.useWSS&&(g=(B.useWSS?"wss":"ws")+g.substring(g.indexOf("://")));this.getURL=function(){return g};var mb=parseInt(n.server_bpp||n.color||24);this.getColor=function(){return mb};this.run=function(){if(!E){if(Ga)u=Ga,Da();else{Ma();var a=g+="&cols="+X+"&rows="+W;hi5.browser.binaryWS()&&(a+="&binary=on");var b=window.opener;if(b){var d=null;try{d=b.__sparkUser}catch(c){}d&&(b=d.account,d=
d.session,b&&(a+="&account="+b),d&&(a+="&session="+d))}g=a+("&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0));a=0==f.mode&&B.wsPost?g.substring(0,g.indexOf("?"))+"?_METHOD=post":g;u=new WebSocket(a,"ssh");u.binaryType="arraybuffer"}svGlobal.logger.info(g);u.onopen=fb;void 0!=n.recording&&"on"==n.recording&&bb(n);u.onmessage=function(a){a=a.data;if("string"!=typeof a){var b=new Uint8Array(a);null!=O&&O.add(new RecordingObj(b,0,a.byteLength));Y.set(b);Y.handle()}else{var c=parseInt(a.substring(0,
2),16),b=a.substring(2);switch(c){case 0:a=g.substring(g.indexOf("?")+1);u.send("00"+a);u.send("87"+navigator.userAgent);break;case 15:a=JSON.parse(b);u.send("8D");if(f){f.sessionInfo.protocolVersion=a.protocolVersion;if(f.onready)f.onready();if(f.onloggedin)f.onloggedin();B.pingInterval&&f.startPing(B.pingInterval);G&&(G.enabled=!0)}ba(!1);break;case 26:a=JSON.parse(b);if(a.name){svGlobal.logger.info("msg="+b);if(f.onerror)f.onerror(a);b=__svi18n.errorCode["S"+a.name]||"";b+=a.message;f.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:0!=B.drawLicense&&x.drawLicense(b);break;case 56:a=JSON.parse(b);sa=a.session;a.server=f.server;if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;var b=B.page&&B.page.joinssh||"joinssh.html",b=location.protocol+"//"+location.host+"/"+b+"?id="+a.numericId,d=a.webAddress;d&&0<d.length&&(c=d.indexOf("://"),d=d.substring(c+3),c=d.indexOf("/"),0<c&&(d=d.substring(0,c)),d.toLowerCase()!=
location.host.toLowerCase()&&(b+="&gateway="+d));a.joinLink=b;f.sessionInfo.appInfo=a;a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);Da();if(f.onsessionstart)f.onsessionstart(f.sessionInfo);break;case 58:if(G)if(a=parseInt(b.charAt(0),10),b=b.substring(1),5==a)G.notifyFiles(JSON.parse(b));else switch(b=b.split("\t"),a){case 1:G.confirmId(b[0],b[1],b[2]);break;case 2:G.read(b[0],parseInt(b[1],10),parseInt(b[2],10));break;case 4:G.close(b[0]);break;
case 9:a='<a href="'+b[0]+'" download="'+b[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>",surfaces.getFocused().showMessage({msg:a,title:__svi18n.info.download})}break;case 59:a=hi5.Base64.dec(b,0);Z=a[3]<<24|a[2]<<16|a[1]<<8|a[0];Z&64&&f.showMessage(__svi18n.info.recording);x.setFeature(Z);break;case 61:a=JSON.parse(b);switch(a.type){case 0:n.fontSize=parseInt(a.fontSize);p=a.width;q=a.height;Da();x.setAutoScale(!0);Ca(p,q);if(b=a.server)f.server=a.server,f.setTitle&&(document.title=n.displayName||
f.server);(b=a.mapDisk)&&Wa(x);ba(!1);Za=a.length;if(f.onopened)f.onopened(a);break;case 1:a=a.duration;if(f.onprogress)f.onprogress(a,Za);break;case 2:2==a.status?E=!0:(b=0==a.status,a.warn&&f.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:eb(b);break;case 91:ia=!0;ca(__svi18n.info.user||b);U=!0;break;case 93:t+=k;r=0;ca(__svi18n.info.password||b);za=!0;break;case 148:break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}}};u.onclose=wa;u.onerror=gb}};this.setJoinMode=
function(a){E&&u.send("8E1"+a)};this.refuseControl=function(a){E&&u.send("8E3"+a)};this.giveControl=function(a){E&&u.send("8E4"+a)};this.requestControl=function(){E&&u.send("8E2")};this.play=function(){u.send("F3")};this.pause=function(){u.send("F2")};this.scan=function(a){u.send("F4"+(a?"1":"0"))};this.seek=function(a){x&&E&&u.send("F4"+(a?"1":"0")+"\t"+(a/x.getScale()|0))};var K=null,U=!1,za=!1,aa="",Za=0;this.hide=function(){x&&(ba(!0),x.hide())};this.showMessage=function(a){f.displayMsg&&a&&hi5.notifications.notify({msg:a})};
this.close=function(){if(u&&E)try{u.send("85"),u.close()}catch(a){}else wa()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(wa):window.addEventListener("unload",wa,!1);var nb=new Ka(1024,function(a){var b=r,d=t;for(a.needMore=!1;a.has(1);){var c=a.getByte();if(31>=c)if(27==c){a:if(c=a,c.has(1)){var e=c.getByte();switch(e){case 40:c.getByte();break;case 41:c.getByte();break;case 55:break;case 61:break;case 62:break;case 68:Ra();break;case 77:Qa();break;case 92:console.log("ST");break;
case 93:console.log("OSC:"+ib(c,7));break;case 91:c=hb(c);break a;default:console.log("unkown cmd for ESC:"+e)}c=!0}else c.skipBack(1),c=!1;if(!c)return}else Oa(c);else if(!(128<=c&&159>=c)){a.skipBack(1);a:{for(var c=a,e=c.getPosition(),f,g="",k=c.getEnd(),l=c.getData();e<k;)if(f=l[e++],31<f&&(128>f||159<f)){if(177!=f)switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(f);break;case 12:case 13:if(e<k)g+=String.fromCharCode((f&31)<<6|l[e++]&63);else{c.needMore=
!0;c=g;break a}break;case 14:if(1<k-e)g+=String.fromCharCode((f&15)<<12|(l[e++]&63)<<6|(l[e++]&63)<<0);else{c.needMore=!0;c=g;break a}}}else{e--;break}c.setPosition(e);c=g}ca(c);if(a.needMore)return}}if(b!=r||d!=t)ha.style.top=t+"px",ha.style.left=r+"px";Ya.drawImage(N,0,0);S&&S.check()});Y.setHandler(nb);var Q={mode:0,parameters:[0],count:0,trailing:0,command:0,toString:function(){var a="CSI, ";this.mode&&(a+="mode:"+String.fromCharCode(this.mode));0<this.count&&(a+=" parameters:"+this.parameters.slice(0,
this.count).join(";"));this.trailing&&(a+=" trailing:"+String.fromCharCode(this.trailing));return a+=" cmd:"+String.fromCharCode(this.command)},parse:function(a){var b=0,d=!1,c=a.getByte();if(!c)return!1;if(60<=c&&63>=c)this.mode=c,c=a.getByte();else if(this.mode=0,31>=c||128<=c&&159>=c)Oa(c),c=a.getByte();if(!c)return!1;for(this.count=0;48<=c&&57>=c||59==c;)if(59==c?(this.parameters[this.count]=d?b:null,this.count++,b=0,d=!1):(b=10*b+(c-48),d=!0),c=a.getByte(),!c)return!1;d?(this.parameters[this.count]=
b,this.count++):0<this.count&&(this.parameters[this.count]=1,this.count++);if(32<=c&&47>=c){if(this.trailing=c,c=a.getByte(),!c)return!1}else this.trailing=0;64<=c&&127>=c?this.command=c:(this.command="",console.log("Invalid CSI final char:"+String.fromCharCode(c)));return!0}};this.showHistory=Va;this.getUploadManager=function(){return G};this.addSurface=function(a){x=a;Xa&&a.setPlayerMode();Ya=x.context;N.width=p;N.height=q;l=N.getContext("2d",{alpha:!1});a.forceTextArea=!0;a.alwaysPaste=!0;a.setAutoScale(0<
f.mode);a.setSize(p,q);a.setController(La);a.setFastCopy(I(n.fastCopy));a.setTouchpad(I(n.touchpad));a.setClipboard(I(n.mapClipboard));Wa(x);a.run(99997,!1,!0);a.onclipdata=jb};this.sendPing=function(a){R("\x00")};this.startPing=function(a){S||(S=new hi5.tool.ResponseMonitor(function(){ia&&f.sendPing()},function(){ia&&S.check(1)}));S.setInterval(a,a);setTimeout(function(){S.check()},1E3*a)};this.stopPing=function(){S&&S.stop()};this.writeText=R;var Aa=!1,pa=0,qa=0,Ba=0,ea=!1,$a=0,ab=0,fa=null;this.writeRawInput=
function(a){if(E){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");switch(b){case 128:pa=parseInt(a[0]);qa=parseInt(a[1]);Ba=parseInt(a[2]);ea=!1;Aa=!0;$a=Math.floor(pa/w)*w;ab=Math.floor(qa/k)*k;la&&R("\u001b[M"+a[2]+String.fromCharCode(Math.floor(pa/w)+33)+String.fromCharCode(Math.floor(qa/k)+33));return;case 129:la&&R("\u001b[M3"+String.fromCharCode(Math.floor(parseInt(a[0])/w)+33)+String.fromCharCode(Math.floor(parseInt(a[1])/k)+33));Ba=parseInt(a[2]);2==Ba&&Aa&&!ea?(P&&(P.value=
""),setTimeout(Va,50)):ea&&(a=z.getMultiLines(Math.floor(pa/w)+1,Math.floor(qa/k+.1)+1,Math.floor(parseInt(a[0])/w+.4)+1,Math.floor(parseInt(a[1])/k-.4)+1))&&x&&x.copyToClip("text/plain;"+a);fa&&(x.removeWhiteboard(),fa=null);ea=Aa=!1;return;case 130:if(Aa){b=parseInt(a[0]);a=parseInt(a[1]);if(!ea){if(3>Math.abs(b-pa)&&3>Math.abs(a-qa))return;ea=!0}if(0==Ba){if(!fa){var d=x.initWhiteboard().getContext("2d");fa=new hi5.canvas.TextSelect(d,k,null,"1px",p)}fa.clear();fa.draw($a,ab,b,a)}}return;case 131:la&&
R("\u001b[M"+("1"==a[2]?4:5)+String.fromCharCode(Math.floor(parseInt(a[0])/w)+64)+String.fromCharCode(Math.floor(parseInt(a[1])/k)+64));return;case 132:d=0==a[0];b=parseInt(a[1]);d&&(U||za)?(a=b,28==a?(u.send((U?"5B":"5D")+aa),aa="",U?U=!1:(za=!1,t+=k,r=0)):14==a&&0<aa.length&&(aa=aa.substring(0,aa.length-1),U&&(Ea(),ca(" "),Ea()))):(R(Ha.process(d,b,0)),28!=b&&(T||(T=M())));return;case 139:b=parseInt(a[1]);d=0==a[0];R(Ha.process(d,b,1));return;case 134:U||za?(a=a[0],aa+=a,U&&ca(a)):(T||(T=M()),R(Ha.process(!0,
a[0],3)));return}svGlobal.logger.warn("Unknowncode: "+a[1]+" type:"+b)}};var Ha=new function(){var a=!1,b=!1,d=!1;this.process=function(c,e,f){if(3==f)return e;if(0==f){switch(e){case 29:case 157:return a=c,"";case 56:case 184:return b=c,"";case 42:case 54:return d=c,""}if(c){switch(e){case 28:c="\r";break;case 200:c="\u001bOA";break;case 208:c="\u001bOB";break;case 205:c="\u001bOC";break;case 203:c="\u001bOD";break;case 59:c="\u001bOP";break;case 60:c="\u001bOQ";break;case 61:c="\u001bOR";break;
case 62:c="\u001bOS";break;case 63:c="\u001b[15~";break;case 64:c="\u001b[17~";break;case 65:c="\u001b[18~";break;case 66:c="\u001b[19~";break;case 67:c="\u001b[20~";break;case 68:c="\u001b[21~";break;case 87:c="\u001b[23~";break;case 88:c="\u001b[24~";break;case 15:c="\t";break;case 209:c="\u001b[6~";break;case 201:c="\u001b[5~";break;case 199:c="\u001b[H";break;case 207:c="\u001b[F";break;case 14:c=d?"\b":"\u007f";break;case 211:c="\u001b[3~";break;case 197:c="\u00ff\u00f3";break;case 210:c="\u001b[2~";
break;case 1:c="\u001b";break;default:return console.log("Invalid code:"+e),""}b&&(c="\u001b"+c);return c}return""}if(1==f&&c&&a){if(64<e&&91>e)return String.fromCharCode(e-64);switch(e){case 54:return"\u001e";case 219:return"\u001b";case 220:return"\u001c";case 221:return"\u001d";case 32:return"\x00";case 192:return"\u001e";case 191:return"\u001f";default:return console.log("Invalid key code:"+e),""}}if(b)return"\u001b"+String.fromCharCode(e).toLowerCase()}}};
