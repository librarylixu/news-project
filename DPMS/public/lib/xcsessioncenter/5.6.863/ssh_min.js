var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(f,p,q){if(null==f)throw new TypeError("The 'this' value for String.prototype."+q+" must not be null or undefined");if(p instanceof RegExp)throw new TypeError("First argument to String.prototype."+q+" must not be a regular expression");return f+""};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,p,q){f!=Array.prototype&&f!=Object.prototype&&(f[p]=q.value)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,p,q,y){if(p){q=$jscomp.global;f=f.split(".");for(y=0;y<f.length-1;y++){var I=f[y];I in q||(q[I]={});q=q[I]}f=f[f.length-1];y=q[f];p=p(y);p!=y&&null!=p&&$jscomp.defineProperty(q,f,{configurable:!0,writable:!0,value:p})}};
$jscomp.polyfill("String.prototype.startsWith",function(f){return f?f:function(f,q){var p=$jscomp.checkStringArgs(this,f,"startsWith");f+="";for(var I=p.length,ha=f.length,ua=Math.max(0,Math.min(q|0,p.length)),V=0;V<ha&&ua<I;)if(p[ua++]!=f[V++])return!1;return V>=ha}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(f){return f?f:function(f,q,y){var p=this.length||0;0>q&&(q=Math.max(0,p+q));if(null==y||y>p)y=p;y=Number(y);0>y&&(y=Math.max(0,p+y));for(q=Number(q||0);q<y;q++)this[q]=f;return this}},"es6-impl","es3");var svManager={getInstance:function(){var f=window.$ssh;return f&&f.running&&f.running()?f:null}};
function connvertServer(f){var p={};p.id=f.id;p.server=f.id;p.displayName=f.displayName||f.id;if(f=f.ssh){for(var q in f)p[q]=f[q];p.user=f.username||"";p.pwd=f.password||""}return p}
svGlobal.SSH=function(f,p,q,y){function I(a){return"on"==a||"true"==a}function ha(){var a=f.indexOf("://"),b=f.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function ua(a){return va?hi5.browser.httpGet(ha()+"/CLIP?s="+va+"&t="+(new Date).getTime(),!1):""}function V(a,b){b&&(H=b);a&&(J=a,wa=(J-1)*k);Ka=1==H&&J==Math.floor(q/k)}function Fa(a,b){var d=Math.floor(b/k),c=Math.floor(a/w),e=null;E&&(e=l.getImageData(0,0,Math.min(c*w,F),Math.min(d*k,W*k)));p=a;
q=b;x.setSize(a,b);N.width=a;N.height=b;l.textBaseline="top";var g=m.fontFamily||"Courier New";0<g.indexOf(" ")&&(g="'"+g+"'");l.font=m.fontSize+"px "+g;xa();e&&l.putImageData(e,0,0);W=d;X=c;F=X*w;V(Math.floor(q/k));z=new La(X,W);if(h.onresolutionchange)h.onresolutionchange(p,q)}function ya(a){u.send(a)}function Ma(a,b,d){this.need=a;this.handler=b;this.repeat=d||1}function eb(a){O=new RecordingManager;O.setHeader({name:0<a.user.length?a.server+"_"+a.user:a.server,width:a.width,height:a.height,color:a.fontSize,
namesuffix:".sshv",filetag:"SSHV",duration:0})}function fb(a,b){var d=0,c=!1;this.width=a;this.interval=b;var e=0;this.start=function(){c||(c=!0,d=setInterval(function(){if(x&&E){var b=x.getThumbnail(a);b&&b.length!=e&&(u.send("8E7"+b),e=b.length)}},b))};this.stop=function(){clearInterval(d)}}function gb(a,b){!K||K.width==a&&K.interval==b||(K.stop(),K=null);K||(K=new fb(a,b));K.start()}function hb(a){var b=parseInt(a.substring(0,1),16),d=a.substring(1);a=!1;var c=h.sessionInfo.appInfo;switch(b){case 1:var e=
JSON.parse(d);h.onsessionjoin&&(a=h.onsessionjoin(e));if(a)break;h.showMessage(__svi18n.info.joinsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 2:e=JSON.parse(d);h.onsessionexit&&(a=h.onsessionexit(e));if(a)break;h.showMessage(__svi18n.info.exitsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 3:e=JSON.parse(d);c.joinMode!=e.mode&&(c.joinMode=e.mode,b=hi5.$("joinSelect"))&&(b.value=e.mode);if(c.hasControl)break;x.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;h.ongivecontrol&&
(a=h.ongivecontrol());if(a)break;h.showMessage(__svi18n.info.givecontrol);break;case 4:x.setReadOnly(!0);c.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;h.ontakebackcontrol&&(a=h.ontakebackcontrol());if(a)break;h.showMessage(__svi18n.info.nocontrol);break;case 5:e=JSON.parse(d);h.onrequirecontrol&&(a=h.onrequirecontrol(e));if(a)break;a=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);hi5.notifications.notify({title:a,msg:__svi18n.info.recontrol,cbYes:function(){h.giveControl(e.numericId);
this.destroy()},cbNo:function(){h.refuseControl(e.numericId);this.destroy()}});break;case 6:x.setTouchRemoting(!0);break;case 7:e=JSON.parse(d);e.width&&e.height&&Fa(e.width,e.height);break;case 8:e=JSON.parse(d);if(h.onrequestcredential&&h.onrequestcredential(e))break;x.requestCredential(e);break;case 9:e=JSON.parse(d);0<e.interval&&0<e.width?gb(e.width,e.interval):K&&(K.stop(),K=null);break;case 11:e=JSON.parse(d),h.onrequirejoin&&(a=h.onrequirejoin(e)),a||(a=__svi18n.info.title.applyArgs([e.name,
e.numericId,e.__ip]),hi5.notifications.notify({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){h.allowJoin(e.numericId,!0);this.destroy()},cbNo:function(){h.allowJoin(e.numericId,!1);this.destroy()}}))}}function ba(a){ia.style.display=a?"none":"block"}function ib(a){svGlobal.logger.info("opened...");E=!0;u.send("87"+navigator.userAgent);if(h.onopen)h.onopen()}function jb(a){svGlobal.logger.warn(a)}function za(a){svGlobal.logger.warn("closed ...");ba(!0);ja=E=!1;if(h&&h.onclose)h.onclose();try{null!=
O&&(O.exit(),O=null),x&&x.close()}catch(b){}Y&&(Y.release(),Y=null);N=l=null;u&&(u.onopen=null,u.onmessage=null,u.onclose=null,u=u.onerror=null);x=Na=null;h&&(h=null);window&&window.$ssh&&(window.$ssh=null);null!=O&&(O.exit(),O=null)}function Oa(){10>m.fontSize&&(m.fontSize=10);13>m.fontSize?k=m.fontSize+6:12<m.fontSize&&19>m.fontSize?k=m.fontSize+8:18<m.fontSize&&25>m.fontSize?k=m.fontSize+12:24<m.fontSize&&(k=m.fontSize+16);m.lineHeight&&(k=parseInt(m.lineHeight));Pa=(k-m.fontSize)/2|0;l.textBaseline=
"top";var a=m.fontFamily||"Courier New";0<a.indexOf(" ")&&(a="'"+a+"'");l.font=m.fontSize+"px "+a;w=l.measureText("X").width;W=parseInt(q/k);X=parseInt(p/w);F=X*w;V(parseInt(q/k));z=new La(X,W)}function Ga(){xa();t=r=0;Oa();ia.style.width=w+"px";ia.style.height=k+"px";remotectrl.style.cursor="text";ja=!0}function ka(){Qa.drawImage(N,0,0)}function Ra(a){switch(a){case 0:break;case 5:break;case 7:break;case 8:Ha();break;case 9:a=r/w/8;a=parseInt(a)+1;r=8*a*w;la();break;case 10:t+=k;la();break;case 11:t+=
k;la();break;case 12:break;case 13:if(U){if(U&&(a=z.getSingleLine(L(),U,M()))){if(h.oncommand)h.oncommand(a);a.startsWith("cd /")&&x.setDirectory(a.substring(3))}U=0}r=0;t>(J-1)*k&&(t=(J-1)*k);break;case 14:break;case 15:break;default:console.log("Unknown C0 control:"+a)}}function kb(a){var b=a.getPosition();if(!Q.parse(a))return a.setPosition(b-2),!1;a=Q.count;b=Q.parameters;switch(Q.command){case 64:0==a&&(b[0]=1);a=b[0];for(var b="",d=a*w,c=l.getImageData(r,t,F-r-d,k),e=0;e<a;e++)b+=" ";ca(b);
r-=d;l.putImageData(c,r+d,t);z.insertSpace(a,M(),L());break;case 65:0==a&&(b[0]=1);t-=(b[0]||1)*k;break;case 66:0==a&&(b[0]=1);t+=(b[0]||1)*k;break;case 67:0==a&&(b[0]=1);r+=(b[0]||1)*w;break;case 68:0==a&&(b[0]=1);r-=(b[0]||1)*w;break;case 69:0==a&&(b[0]=1);t+=b[0]*k;r=0;break;case 70:0==a&&(b[0]=1);t-=b[0]*k;r=0;break;case 71:0==a&&(b[0]=1);Aa(0,b[0]);break;case 72:case 102:0==a&&(b[0]=b[1]=1);Aa(b[0]||1,b[1]||1);break;case 74:a||(b[0]=0);switch(b[0]){case 0:l.fillStyle=C;l.fillRect(r,t,F-r,W*k-
t);l.fillStyle=A;z.clearEOS(M(),L());break;case 1:l.fillStyle=C;l.fillRect(0,0,r,t);l.fillStyle=A;z.clearBOS(M(),L());break;case 2:xa();t=r=0;z.cleanScreen();break;case 3:xa();t=r=0;z.cleanScreen();break;default:console.log("invalid CSI J:"+b[0])}break;case 75:a||(b[0]=0);switch(b[0]){case 0:Sa();break;case 1:l.fillStyle=C;l.fillRect(0,t,r,k);l.fillStyle=A;z.clearBOL(M(),L());break;case 2:l.fillStyle=C;l.fillRect(0,t,F,k);l.fillStyle=A;z.clearLine(L());break;default:console.log("invalid CSI K:"+b[0])}break;
case 76:case 84:a||(b[0]=1);Ta(b[0]);break;case 77:case 83:a||(b[0]=1);Ua(b[0]);break;case 80:a||(b[0]=1);a=b[0];b=r+a*w;b=l.getImageData(b,t,F-b,k);Sa();l.putImageData(b,r,t);z.deleteChars(M(),L(),a);break;case 88:a||(b[0]=1);a=b[0];l.fillStyle=C;l.fillRect(r,t,a*w,k);l.fillStyle=A;z.eraseChars(M(),L(),a);break;case 90:a||(b[0]=1);r=8*((r/w/8|0)-b[0]+1)*w;la();break;case 100:a||(b[0]=1);Aa(b[0]);break;case 101:a||(b[0]=1);Aa(L()+b[0]);break;case 104:if(63==Q.mode)switch(b[0]){case 1:da.setEscMode(1);
break;case 7:console.log("wraparound mode on");ma=!0;break;case 25:ba(!1);break;case 45:console.log("reverse-wraparound mode on");break;case 1E3:case 1001:case 1002:case 1003:console.log("mouse tracking on");na=b[0];break;default:console.log("CSI ? Pm h, Ps:"+b[0])}break;case 108:if(63==Q.mode)switch(b[0]){case 1:da.setEscMode(0);break;case 2:da.setEscMode(2);case 7:ma=!1;break;case 12:break;case 25:ba(!0);break;case 45:console.log("reverse-wraparound mode off");break;case 1E3:case 1001:case 1002:case 1003:na=
0;break;default:console.log("CSI ? Pm l, Ps:"+b[0])}break;case 109:0==a&&(a=1,b[0]=0);for(d=0;d<a;d++)switch(b[d]){case 0:oa(7);pa(0);Ia(!1);break;case 1:Ia(!0);break;case 2:break;case 4:break;case 5:case 8:break;case 7:oa(0);pa(7);break;case 27:oa(7);pa(0);break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:oa(b[d]-30);break;case 38:return 2==b[d+1]&&(A="rgb("+b[d+2]+","+b[d+3]+","+b[d+4]+")",l.fillStyle=A),!0;case 39:oa(7);break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:pa(b[d]-
40);break;case 48:return 2==b[d+1]&&(C="rgb("+b[d+2]+","+b[d+3]+","+b[d+4]+")"),!0;case 49:pa(0);1==d&&39==b[0]&&Ia(!1);break;default:return console.log("TODO: SGR="+Q.toString()),!0}break;case 114:Q.mode||V(b[1],b[0]);break;default:console.log("TODO: CSI="+Q.toString())}return!0}function Ta(a){a||(a=1);var b=(H-1)*k,d=l.getImageData(0,b,F,(J-H-a+1)*k);l.fillStyle=C;l.fillRect(0,b,F,k*a);l.putImageData(d,0,(H+a-1)*k);l.fillStyle=A;z.scrollUp(a,H,J)}function Ua(a){a||(a=1);var b=(H-1)*k,d=J*k,c=a*
k,e=b+c,e=l.getImageData(0,e,F,d-e);l.fillStyle=C;l.fillRect(0,d-c,F,c);l.fillStyle=A;l.putImageData(e,0,b);z.scrollDown(a,H,J)}function la(){ma&&r>F&&(r=0,t+=k);if(ma&&t>wa){for(;t>wa;)t-=k;if(Ka)l.drawImage(N,0,-k),l.fillStyle=C,l.fillRect(0,wa,p,k),z.appendLines(1);else{var a=l.getImageData(0,0+(H-0)*k,F,(J-H)*k);l.fillStyle=C;l.fillRect(0,(H-1)*k,F,(J-H+1)*k);l.putImageData(a,0,0+(H-1)*k)}l.fillStyle=A}}function Ha(){r-=w;0>r&&(r=0)}function L(){return parseInt(t/k)+1}function M(){return parseInt(r/
w)+1}function Aa(a,b){b&&(r=(b-1)*w,0>r&&(r=0));a&&(t=(a-1)*k)}function pa(a){C=Ba[a];C||(C=m.bgColor||"black",console.log("xx colorIndex:"+a))}function oa(a){Va=a;A=qa[a];A||(A=m.fgColor||"white",console.log("xx colorIndex:"+a));l.fillStyle=A}function Ia(a){qa=a?Wa:Ba;A=qa[Va]}function Sa(){l.fillStyle=C;l.fillRect(r,t,F-r,k);l.fillStyle=A;z.clearEOL(M(),L())}function xa(){l.fillStyle=C;l.fillRect(0,0,N.width,N.height);l.fillStyle=A}function Ca(){ia.style.top=t+"px";ia.style.left=r+"px"}function ca(a){if(a){z.writeText(M(),
L(),a);C==A&&console.log("text:"+a+" bgColor:"+C+" fgColor:"+A);Xa=a.length;var b=Xa*w;l.fillStyle=C;l.fillRect(Math.floor(r),t,Math.ceil(b),k);l.fillStyle=A;l.fillText(a,r,t+Pa);r+=b;la()}}function lb(a,b){for(var d=a.getPosition(),c,e="",g=a.getEnd(),n=a.getData();d<g;)if(c=n[d++],c!=b)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(c);break;case 12:case 13:e+=String.fromCharCode((c&31)<<6|n[d++]&63);break;case 14:e+=String.fromCharCode((c&15)<<12|(n[d++]&
63)<<6|(n[d++]&63)<<0)}else break;a.setPosition(d);return e}function Ya(a){Z+=a;R&&(ca(a),ka(),Ca())}function mb(a){if(E)return(a=a.getData("text/plain"))?(a=a.replace(/\r\n/g,"\n"),R||ra?Ya(a):S(a),!0):!1}function Za(){if(P){var a=!!P.value;P.value=z.toString();a||(a=new hi5.ui.Lightbox(document.getElementById("copydialog")),a.show(),x&&x.setIgnorePaste(!1),a.onclose=function(){P.value=""});setTimeout(function(){P.scrollTop=P.scrollHeight},10)}}function nb(a){var b={},d=0,c=a;this.enabled=!1;hi5.EventControl(this);
var e=this,g=null,n=0,v=!0,D=!0;this.setDownload=function(a){v=a};this.setUpload=function(a){D=a};this.release=function(){b=c=a=e=null};this.read=function(c,n,g){var v=b[b[c]];if("undefined"!=typeof v){var D=v.name;if(1>v.size)h.showMessage(__svi18n.file.zero+D,null,3E3);else{var D=v.slice(n,n+g),f=new FileReader;f.onloadend=function(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(c,n,g,b,v.preferPaste),d+=g,e.fireEvent("progress",[d]))};f.readAsArrayBuffer(D)}}};
this.mkdirs=function(b){e.enabled&&("/"!=b.charAt(b.length-1)&&(b+="/"),a.start([b],0,!0))};this.addFiles=function(c,d){var g=c.length;if(g&&e.enabled&&D){var v=d&&!!(aa&65536);n=Date.now();for(var f=0;f<g;f++){var ea=c[f];d&&(ea.preferPaste=!0);var k=ea.fullPath||ea.name;if(h.beforeupload&&h.beforeupload(ea,k,v))return;e.fireEvent("beforeupload",[ea,k,v]);k=encodeURIComponent(k);b[k]=ea}a.start(c,d);e.fireEvent("uploadstarted",[v])}};this.removeFile=function(a){c.remove(a)};this.confirmId=function(a,
e,c){b[a]=e;c&&(d+=parseInt(c))};this.close=function(a){var c=!0,g={size:d,duration:Date.now()-n};if(a){var v=b[a];if(v){c=b[v].preferPaste;delete b[a];delete b[v];a=decodeURIComponent(v);if(h.onfileuploaded)h.onfileuploaded(a,c,g);e.fireEvent("fileuploaded",[a,c&&!!(aa&65536),g])}for(var D in b)return}else b={};n=d=0;e.fireEvent("uploaded",[c&&!!(aa&65536),g]);if(h.onuploaded)h.onuploaded(c&&!!(aa&65536),g)};this.cancelAll=function(){c.cancelAll();if(h.onuploadingCancelled)h.onuploadingCancelled();
e.fireEvent("uploadingCancelled");e.close()};this.list=function(a,b){g=b;c.list(a)};this.notifyFiles=function(a){g&&g(a);e.fireEvent("files")};this.download=function(){v&&c.download()}}function ob(){function a(a,d){var b=d.length,e=new Uint8Array(2+2*b);e[0]=58;e[1]=a;for(var g,n=2,v=0;v<b;v++)g=d.charCodeAt(v),e[n++]=g&255,e[n++]=g>>8&255;ya(e.buffer)}this.start=function(a,d,c){for(var b=a.length,g=20*b+2,n=0,v=new Uint8Array(8),D=2,h,f,k;n<b;n++)g=c?g+2*(encodeURIComponent(a[n]).length+1):g+2*(encodeURIComponent(a[n].fullPath||
a[n].name).length+1);g=new Uint8Array(g);g[0]=58;g[1]=0;d&&(g[1]|=128);for(n=0;n<b;n++){d=c?0:a[n].size;g[D++]=d&255;g[D++]=d>>8&255;g[D++]=d>>16&255;g[D++]=d>>24&255;D+=4;c||hi5.NumUtils.toBytes(a[n].lastModified||a[n].lastModifiedDate.getTime(),v);g.set(v,D);D+=12;d=encodeURIComponent(c?a[n]:a[n].fullPath||a[n].name);h=d.length;for(f=0;f<h;f++)k=d.charCodeAt(f),g[D++]=k&255,g[D++]=k>>8&255;D+=2}ya(g.buffer)};this.send=function(a,d,c,e,g){var b=new Uint8Array(22+c);b[0]=58;b[1]=3;g&&(b[1]|=128);
g=2;b[g++]=a&255;b[g++]=a>>8&255;b[g++]=a>>16&255;b[g++]=a>>24&255;b[g++]=d&255;b[g++]=d>>8&255;b[g++]=d>>16&255;b[g++]=d>>24&255;g+=4;b[g++]=c&255;b[g++]=c>>8&255;b[g++]=c>>16&255;b[g++]=c>>24&255;b.set(e,g+4);ya(b.buffer)};this.remove=function(b){a(6,b)};this.list=function(b){a(5,b)};this.cancelAll=function(){a(7,"")};this.download=function(){a(136,"")}}function $a(a){I(m.mapDisk)&&(G||(G=new nb(new ob),G.enabled=!0),a.setFileHandler(G))}function S(a){if(a){a=unescape(encodeURIComponent(a));var b=
a.length+1,d=new Uint8Array(b);d[0]=147;for(var c=1;c<b;c++)d[c]=a.charCodeAt(c-1);u.send(d.buffer)}}function La(a,b,d){function c(){var b=Array(a);hi5.Arrays.fill(b,0,a," ");return b}var e=0,g=[];if(!d||10>d/b)d=10*b;this.writeText=function(a,b,d){b--;a--;var n=g[e+b];n||(n=c(),g[e+b]=n);b=0;for(var v=d.length;b<v;b++)n[b+a]=d[b]};this.appendLines=function(a){e+=a};this.scrollDown=function(a,b,d){d=e+d-1-a;for(b=e+b-1;b<=d;b++)g[b]=g[b+a];d++;for(b=0;b<a;b++)g[d+b]=c()};this.scrollUp=function(a,
b,d){b=e+b-1+a;for(d=e+d-1;d>=b;d--)g[d]=g[d-a];b--;for(d=0;d<a;d++)g[b-d]=c()};this.cleanScreen=function(){e=g.length;if(e>=d){var a=2*b;g.splice(0,a);e-=a}};this.clearEOS=function(c,d){d--;c--;for(var n=e+d,f,h,v=0,k=b-d;v<k;v++)if(h=g[n+v])for(f=c;f<a;f++)h[f]=" "};this.clearBOS=function(a,b){b--;a--;for(var c=e,d,n,f=0;f<b;f++)if(n=g[c+f])for(d=0;d<a;d++)n[d]=" "};this.clearLine=function(b){b--;hi5.Arrays.fill(g[e+b],0,a," ")};this.clearBOL=function(a,b){b--;a--;var c=g[e+b];if(c)for(var d=0;d<
a;d++)c[d]=" "};this.clearEOL=function(b,c){c--;b--;var d=g[e+c];if(d)for(var n=b;n<a;n++)d[n]=" "};this.eraseChars=function(a,b,c){b--;a--;if(b=g[e+b]){var d=a;for(a+=c;d<a;d++)b[d]=" "}};this.deleteChars=function(a,b,c){b--;a--;(b=g[e+b])&&b.splice(a,c)};this.insertSpace=function(a,b,c){c--;b--;if(c=g[e+c]){for(var d=c.length-1;d>=b;d--)c[d+a]=c[d];for(d=0;d<a;d++)c[b+d]=" "}};this.getSingleLine=function(a,b,c){a--;b--;c--;var d="";if(a=g[e+a])for(;b<c;b++)d+=a[b];return d.trimRight()};this.getMultiLines=
function(b,c,d,f){if(f<c)return this.getMultiLines(d,f,b,c);var n=f-c+1;if(1>n)return null;if(1==n)return this.getSingleLine(c,b,d);b=this.getSingleLine(c,b,a);d=this.getSingleLine(f,1,d);n-=2;c+=e;for(var h=0;h<n;h++)b=(f=g[h+c])?b+("\r\n"+f.join("").trimRight()):b+"\r\n\r\n";return b+"\r\n"+d};this.toString=function(){for(var a="",b=0,c=g.length;b<c;b++)g[b]&&(a+=g[b].join("").trimRight()),a+="\r\n";return a}}var U=0,T=null;this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;
this.mode=0;this.getHistory=function(){return z.toString()};var Ja="object"==typeof f?f:null,ab="object"==typeof f||0<f.indexOf("/PLAY?");ab?(this.mode=1,Ja&&(f=""),f+="&touchpad=on"):0<f.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var B=hi5.appcfg||{img:{},toolbar:{fadable:!0}},m=hi5.tool.queryToObj(f.substring(f.indexOf("?")+1));m.color||(m.color=32);var P=I(m.mapClipboard)?document.getElementById("copytextarea"):null,z=null;P&&(P.value="");this.server=m.server;this.port=parseInt(m.port,
10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var x=null,E=!1,ja=!1,aa=0,va="",na=0,G=null;B.copyDialog=!0;var r=0,t=0,w=0,k=18,Pa=0,Ba="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),Wa="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),qa=Ba,A=m.fgColor||qa[7],C=m.bgColor||qa[0],Va=0,ma=!0;m.wraparoundMode&&(ma=I(m.wraparoundMode));var H=1,J=24,wa=0,Ka=!0,ia=document.getElementById("cursorID"),W=0,X=0,
F=0,Xa=0,O=null;window.$ssh=this;var Y=new function(a){var b=0,d=0,c=new Uint8Array(a),e=this,g=new Ma(0,null,0);this.needMore=!1;this.release=function(){e=c=g=null};this.getHandler=function(){return g};this.getData=function(){return c};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=function(){return d};this.has=function(a){return d-b>=a};this.set=function(a){var e=a.length,g=d-b;if(1>g)d=e,c=a;else{var f=c.subarray(b,d);d=g+e;e=new Uint8Array(d);e.set(f);e.set(a,
g);c=e}b=0};this.handle=function(){g.handler(e,g)};this.setHandler=function(a){a&&1>a.need&&svGlobal.logger.warn("need < 1");(g=a)&&d-b>=a.need&&a.handler(e,a)};this.getByte=function(){return c[b++]};this.peekByte=function(){return c[b]};this.getBE32=function(){return c[b++]<<24|c[b++]<<16|c[b++]<<8|c[b++]};this.getBE16=function(){return c[b++]<<8|c[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=function(a,e){if(e)for(var d=0;d<a;d++)e[d]=c[b++];else return d=b,b+=
a,c.subarray(d,b)};this.copyToByteArray=function(a,b,e,d){hi5.Arrays.arraycopy(c,e,a,b,d)}}(4194304);this.__que=Y;this.running=function(){return E};this.setColorTable=function(a){Ba=a};this.setColorTableBright=function(a){Wa=a};this.loadbalanceToken=B.loadbalanceTokenName?B.loadbalanceTokenName+"="+hi5.tool.uuid():"";var h=this,u=null;p||(p=window.innerWidth);m.width=p;f+="&width="+p;q||(q=window.innerHeight);m.height=q;f+="&height="+q;y=(y=y||m.fontSize)?parseInt(y):13;m.fontSize?(y=parseInt(m.fontSize,
10),m.fontSize=y):(m.fontSize=y,f+="&fontSize="+y);var Qa,N=document.createElement("canvas"),l;this.modifyURL=function(a){h.loadbalanceToken&&(a+="&"+h.loadbalanceToken);return a};this.__write=ya;this.getFileUrl=function(a){return h.modifyURL(ha()+"/DOWNLOAD?s="+va+"&f="+a)};this.listFiles=function(a,b){G&&G.list(a,b)};var Na=new function(a){this.setJoinMode=h.setJoinMode;this.requestControl=h.requestControl;this.writeKeyComb=h.writeKeyComb;this.getAppMode=function(){return h.mode};this.send=function(b){"891"!=
b&&E&&a.__write(b)};this.sendInput=function(a){h.writeRawInput(a);if(h.onactivity)h.onactivity(a)};var b=null;this.getAppInfo=function(){return h.sessionInfo.appInfo};this.onresize=function(a){if(a=a.target.svSurface){a=a.getFreeSpace();var c=a.width,e=a.height;hi5.browser.isTouch||hi5.browser.isOpera||!E||(b&&(clearTimeout(b),b=null),b=setTimeout(function(){Fa(c,e);var a=p,b=q;var d=parseInt(a/w);var f=parseInt(b/k);u.send("ED"+d+"\t"+f+"\t"+a+"\t"+b)},200))}};this.onorientationchange=function(a){};
this.getClipData=ua;this.onfocus=function(a){};this.getShareFiles=a.listFiles;this.getFile=function(b){var c=a.getFileUrl(b);h.ondownload&&h.ondownload({fileName:b,url:c})||window.open(c)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return f};this.reconnect=function(a,b,e){}}(this);void 0!=B.displayMsg&&(this.displayMsg=B.displayMsg);void 0!=B.reconnectTimes&&(this.reconnectTimes=B.reconnectTimes);void 0!=B.openLink&&(this.openLink=B.openLink);void 0!=B.setTitle&&(this.setTitle=B.setTitle);
"boolean"==typeof B.useWSS&&(f=(B.useWSS?"wss":"ws")+f.substring(f.indexOf("://")));this.getURL=function(){return f};var pb=parseInt(m.server_bpp||m.color||24);this.getColor=function(){return pb};this.run=function(){if(!E){if(Ja)u=Ja,Ga();else{Oa();var a=f+="&cols="+X+"&rows="+W;hi5.browser.binaryWS()&&(a+="&binary=on");var b=window.opener;if(b){var d=null;try{d=b.__sparkUser}catch(c){}d&&(b=d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d))}f=a+("&pasteCap="+(hi5.browser.isChrome&&
hi5.browser.isDesktop?3:0));a=0==h.mode&&B.wsPost?f.substring(0,f.indexOf("?"))+"?_METHOD=post":f;u=new WebSocket(a,"ssh");u.binaryType="arraybuffer"}svGlobal.logger.info(f);u.onopen=ib;void 0!=m.recording&&"on"==m.recording&&eb(m);u.onmessage=function(a){a=a.data;if("string"!=typeof a){var b=new Uint8Array(a);null!=O&&O.add(new RecordingObj(b,0,a.byteLength));Y.set(b);Y.handle()}else{var c=parseInt(a.substring(0,2),16),b=a.substring(2);switch(c){case 0:a=f.substring(f.indexOf("?")+1);u.send("00"+
a);u.send("87"+navigator.userAgent);break;case 15:a=JSON.parse(b);u.send("8D");if(h){h.sessionInfo.protocolVersion=a.protocolVersion;if(h.onready)h.onready();if(h.onloggedin)h.onloggedin();B.pingInterval&&h.startPing(B.pingInterval);G&&(G.enabled=!0)}ba(!1);break;case 26:a=JSON.parse(b);if(a.name){svGlobal.logger.info("msg="+b);if(h.onerror)h.onerror(a);b=__svi18n.errorCode["S"+a.name]||"";b+=a.message;h.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:0!=
B.drawLicense&&x.drawLicense(b);break;case 56:a=JSON.parse(b);va=a.session;a.server=h.server;if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;var b=B.page&&B.page.joinssh||"joinssh.html",b=location.protocol+"//"+location.host+"/"+b+"?id="+a.numericId,d=a.webAddress;d&&0<d.length&&(c=d.indexOf("://"),d=d.substring(c+3),c=d.indexOf("/"),0<c&&(d=d.substring(0,c)),d.toLowerCase()!=location.host.toLowerCase()&&(b+="&gateway="+d));a.joinLink=b;h.sessionInfo.appInfo=
a;a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);Ga();if(h.onsessionstart)h.onsessionstart(h.sessionInfo);break;case 58:if(G)if(a=parseInt(b.charAt(0),10),b=b.substring(1),5==a)G.notifyFiles(JSON.parse(b));else switch(b=b.split("\t"),a){case 1:G.confirmId(b[0],b[1],b[2]);break;case 2:G.read(b[0],parseInt(b[1],10),parseInt(b[2],10));break;case 4:G.close(b[0]);break;case 9:a='<a href="'+b[0]+'" download="'+b[1]+'" target="_blank">'+__svi18n.info.fileReady+
"</a>",surfaces.getFocused().showMessage({msg:a,title:__svi18n.info.download})}break;case 59:a=hi5.Base64.dec(b,0);aa=a[3]<<24|a[2]<<16|a[1]<<8|a[0];aa&64&&h.showMessage(__svi18n.info.recording);x.setFeature(aa);break;case 61:a=JSON.parse(b);switch(a.type){case 0:m.fontSize=parseInt(a.fontSize);p=a.width;q=a.height;Ga();x.setAutoScale(!0);Fa(p,q);if(b=a.server)h.server=a.server,h.setTitle&&(document.title=m.displayName||h.server);(b=a.mapDisk)&&$a(x);ba(!1);bb=a.length;if(h.onopened)h.onopened(a);
break;case 1:a=a.duration;if(h.onprogress)h.onprogress(a,bb);break;case 2:2==a.status?E=!0:(b=0==a.status,a.warn&&h.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:hb(b);break;case 91:ja=!0;ca(__svi18n.info.user||b);R=!0;ka();Ca();break;case 93:t+=k;r=0;ca(__svi18n.info.password||b);ra=!0;ka();Ca();break;case 148:break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}}};u.onclose=za;u.onerror=jb;h.setTitle&&(document.title=m.displayName||h.server)}};this.setJoinMode=
function(a){E&&u.send("8E1"+a)};this.refuseControl=function(a){E&&u.send("8E3"+a)};this.giveControl=function(a){E&&u.send("8E4"+a)};this.requestControl=function(){E&&u.send("8E2")};this.play=function(){u.send("F3")};this.pause=function(){u.send("F2")};this.scan=function(a){u.send("F4"+(a?"1":"0"))};this.seek=function(a){x&&E&&u.send("F4"+(a?"1":"0")+"\t"+(a/x.getScale()|0))};var K=null,R=!1,ra=!1,Z="",bb=0;this.hide=function(){x&&(ba(!0),x.hide())};this.showMessage=function(a){h.displayMsg&&a&&hi5.notifications.notify({msg:a})};
this.close=function(){if(u&&E)try{u.send("85"),u.close()}catch(a){}else za()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(za):window.addEventListener("unload",za,!1);var qb=new Ma(1024,function(a){var b=r,d=t;for(a.needMore=!1;a.has(1);){var c=a.getByte();if(31>=c)if(27==c){a:if(c=a,c.has(1)){var e=c.getByte();switch(e){case 40:c.getByte();break;case 41:c.getByte();break;case 55:break;case 61:break;case 62:break;case 68:Ua();break;case 77:Ta();break;case 92:console.log("ST");break;
case 93:console.log("OSC:"+lb(c,7));break;case 91:c=kb(c);break a;default:console.log("unkown cmd for ESC:"+e)}c=!0}else c.skipBack(1),c=!1;if(!c)return}else Ra(c);else if(128<=c&&159>=c)switch(c){case 146:a.skip(2);break;default:console.log("C1:"+c)}else{a.skipBack(1);a:{for(var c=a,e=c.getPosition(),g,f="",h=c.getEnd(),k=c.getData();e<h;)if(g=k[e++],31<g&&(128>g||159<g)){if(177!=g)switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:f+=String.fromCharCode(g);break;case 12:case 13:if(e<
h)f+=String.fromCharCode((g&31)<<6|k[e++]&63);else{c.needMore=!0;c=f;break a}break;case 14:if(1<h-e)f+=String.fromCharCode((g&15)<<12|(k[e++]&63)<<6|(k[e++]&63)<<0);else{c.needMore=!0;c=f;break a}}}else{e--;break}c.setPosition(e);c=f}ca(c);if(a.needMore)return}}b==r&&d==t||Ca();ka();T&&T.check()});Y.setHandler(qb);var Q={mode:0,parameters:[0],count:0,trailing:0,command:0,toString:function(){var a="CSI, ";this.mode&&(a+="mode:"+String.fromCharCode(this.mode));0<this.count&&(a+=" parameters:"+this.parameters.slice(0,
this.count).join(";"));this.trailing&&(a+=" trailing:"+String.fromCharCode(this.trailing));return a+=" cmd:"+String.fromCharCode(this.command)},parse:function(a){var b=0,d=!1,c=a.getByte();if(!c)return!1;if(60<=c&&63>=c)this.mode=c,c=a.getByte();else if(this.mode=0,31>=c||128<=c&&159>=c)Ra(c),c=a.getByte();if(!c)return!1;for(this.count=0;48<=c&&57>=c||59==c;)if(59==c?(this.parameters[this.count]=d?b:null,this.count++,b=0,d=!1):(b=10*b+(c-48),d=!0),c=a.getByte(),!c)return!1;d?(this.parameters[this.count]=
b,this.count++):0<this.count&&(this.parameters[this.count]=1,this.count++);if(32<=c&&47>=c){if(this.trailing=c,c=a.getByte(),!c)return!1}else this.trailing=0;64<=c&&127>=c?this.command=c:(this.command="",console.log("Invalid CSI final char:"+String.fromCharCode(c)));return!0}};this.showHistory=Za;this.getUploadManager=function(){return G};this.addSurface=function(a){x=a;ab&&a.setPlayerMode();Qa=x.context;N.width=p;N.height=q;l=N.getContext("2d",{alpha:!1});a.forceTextArea=!0;a.alwaysPaste=!0;a.setAutoScale(0<
h.mode);a.setSize(p,q);a.setController(Na);a.setFastCopy(I(m.fastCopy));a.setTouchpad(I(m.touchpad));a.setClipboard(I(m.mapClipboard));$a(x);a.run(99997,!1,!0);a.onclipdata=mb};this.sendPing=function(a){S("\x00")};this.startPing=function(a){T||(T=new hi5.tool.ResponseMonitor(function(){ja&&h.sendPing()},function(){ja&&T.check(1)}));T.setInterval(a,a);setTimeout(function(){T.check()},1E3*a)};this.stopPing=function(){T&&T.stop()};this.writeText=S;var Da=!1,sa=0,ta=0,Ea=0,fa=!1,cb=0,db=0,ga=null;this.writeRawInput=
function(a){if(E){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");switch(b){case 128:sa=parseInt(a[0]);ta=parseInt(a[1]);Ea=parseInt(a[2]);fa=!1;Da=!0;cb=Math.floor(sa/w)*w;db=Math.floor(ta/k)*k;na&&S("\u001b[M"+a[2]+String.fromCharCode(Math.floor(sa/w)+33)+String.fromCharCode(Math.floor(ta/k)+33));return;case 129:na&&S("\u001b[M3"+String.fromCharCode(Math.floor(parseInt(a[0])/w)+33)+String.fromCharCode(Math.floor(parseInt(a[1])/k)+33));Ea=parseInt(a[2]);2==Ea&&Da&&!fa?(P&&(P.value=
""),setTimeout(Za,50)):fa&&(a=z.getMultiLines(Math.floor(sa/w)+1,Math.floor(ta/k+.1)+1,Math.floor(parseInt(a[0])/w+.4)+1,Math.floor(parseInt(a[1])/k-.4)+1))&&x&&x.copyToClip("text/plain;"+a);ga&&(x.removeWhiteboard(),ga=null);fa=Da=!1;return;case 130:if(Da){b=parseInt(a[0]);a=parseInt(a[1]);if(!fa){if(3>Math.abs(b-sa)&&3>Math.abs(a-ta))return;fa=!0}if(0==Ea){if(!ga){var d=x.initWhiteboard().getContext("2d");ga=new hi5.canvas.TextSelect(d,k,null,"1px",p)}ga.clear();ga.draw(cb,db,b,a)}}return;case 131:na&&
S("\u001b[M"+("1"==a[2]?4:5)+String.fromCharCode(Math.floor(parseInt(a[0])/w)+64)+String.fromCharCode(Math.floor(parseInt(a[1])/k)+64));return;case 132:d=0==a[0];b=parseInt(a[1]);R||ra?d&&(a=b,28==a?(u.send((R?"5B":"5D")+Z),Z="",R?R=!1:(ra=!1,t+=k,r=0)):14==a&&0<Z.length&&(Z=Z.substring(0,Z.length-1),R&&(Ha(),ca(" "),ka(),Ha()))):(S(da.process(d,b,0)),28!=b&&(U||(U=M())));return;case 139:b=parseInt(a[1]);d=0==a[0];S(da.process(d,b,1));return;case 134:R||ra?Ya(a[0]):(U||(U=M()),S(da.process(!0,a[0],
3)));return}svGlobal.logger.warn("Unknowncode: "+a[1]+" type:"+b)}};var da=new function(){var a=!1,b=!1,d=!1,c=0;this.setEscMode=function(a){c=a;console.log("Esc mode:"+a)};this.process=function(e,f,h){if(3==h)return f;if(0==h){switch(f){case 29:case 157:return a=e,"";case 56:case 184:return b=e,"";case 42:case 54:return d=e,""}if(e){switch(f){case 28:e="\r";break;case 200:e=0==c?"\u001b[A":"\u001bOA";break;case 208:e=0==c?"\u001b[B":"\u001bOB";break;case 205:e=0==c?"\u001b[C":"\u001bOC";break;case 203:e=
0==c?"\u001b[D":"\u001bOD";break;case 59:e="\u001bOP";break;case 60:e="\u001bOQ";break;case 61:e="\u001bOR";break;case 62:e="\u001bOS";break;case 63:e="\u001b[15~";break;case 64:e="\u001b[17~";break;case 65:e="\u001b[18~";break;case 66:e="\u001b[19~";break;case 67:e="\u001b[20~";break;case 68:e="\u001b[21~";break;case 87:e="\u001b[23~";break;case 88:e="\u001b[24~";break;case 15:e="\t";break;case 209:e="\u001b[6~";break;case 201:e="\u001b[5~";break;case 199:e=0==c?"\u001b[H":"\u001bOH";break;case 207:e=
0==c?"\u001b[F":"\u001bOF";break;case 14:e=d?"\b":"\u007f";break;case 211:e="\u001b[3~";break;case 197:e="\u00ff\u00f3";break;case 210:e="\u001b[2~";break;case 1:e="\u001b";break;default:return console.log("Invalid code:"+f),""}b&&(e="\u001b"+e);return e}return""}if(1==h&&e&&a){if(64<f&&91>f)return String.fromCharCode(f-64);switch(f){case 54:return"\u001e";case 219:return"\u001b";case 220:return"\u001c";case 221:return"\u001d";case 32:return"\x00";case 192:return"\u001e";case 191:return"\u001f";default:return console.log("Invalid key code:"+
f),""}}if(b)return"\u001b"+String.fromCharCode(f).toLowerCase()}}};
