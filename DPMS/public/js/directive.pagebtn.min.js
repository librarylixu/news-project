appModule.directive('crmBindHtml',['$compile',function($compile){return{restrict:'ECAM',link:function(scope,element,attrs){scope.$watch(function(){return scope.$eval(attrs.crmBindHtml)},function(value){element.html(value);$compile(element.contents())(scope)})}}}]);appModule.directive('pageBtn',function(){return{restrict:'ECAM',templateUrl:__URL+'Crmbase/Baseinfo/pagebtn',replace:true,controller:function($scope){$scope.serachPageRef=function(){if(parent.pageRefAuth==undefined||Object.keys(parent.pageRefAuth).length==0||parent.pageRefAuth[__APPID]==undefined){console.log('Search serachPageRef');var param=new URLSearchParams();param.append('$json',true);param.append('$where',JSON.stringify({appid:__APPID}));$scope.service.postData(__URL+'Crmuser/RefauthRefapp/select_page_data',param).then(function(data){parent.pageRefAuth[__APPID]={btns:[]};angular.forEach(data,function(value,key){parent.pageRefAuth[value.appid]={btns:[],is_update:true,is_del:true};if(value.btns!=null){var tempBtns=value.btns.split(',');parent.pageRefAuth[value.appid].btns=parent.pageRefAuth[value.appid].btns.concat(tempBtns)}parent.pageRefAuth[value.appid].authid=value.authid});$scope.pageRefauth=parent.pageRefAuth;$scope.pageRefBtns=$scope.pageRefauth[__APPID].btns})}else{$scope.pageRefauth=parent.pageRefAuth;$scope.pageRefBtns=$scope.pageRefauth[__APPID].btns}}$scope.findBtndata=function(){if(parent==undefined||parent.pageBtns==undefined||Object.keys(parent.pageBtns).length==0){console.log('Search findBtndata');var param=new URLSearchParams();param.append('$json',true);$scope.service.postData(__URL+'Crmuser/Sysbtns/select_page_data',param).then(function(data){if(parent==undefined){parent={}}if(parent.pageBtns==undefined||Object.keys(parent.pageBtns).length==0){parent.pageBtns=data}$scope.btnsData=parent.pageBtns;if(__APPID!=undefined&&__APPID!=""){$scope.serachPageRef()}},function(error){console.log(error)})}else{$scope.btnsData=parent.pageBtns;if(__APPID!=undefined&&__APPID!=""){$scope.serachPageRef()}}};$scope.findBtndata()}}});