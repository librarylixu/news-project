<extend name="angular-base.html" />
<block name="momentjs">
</block>
<block name="headcss">

</block>
<block name="headjs">
        <!--select start-->
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select.css">
    <script src="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select.js"></script>
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/select2.css">
    <link rel="stylesheet" href="{$Think.const.BOOTSTRAP_URL}select2/3.4.5/selectize.default.css">
    <!--select end-->
    <link rel="stylesheet" href="{$Think.const.PAGE_URL}css/crmSchedule/Workerorder/workerorder.css" /><!-- 这里公用了工单css -->
    <link rel="stylesheet" href="{$Think.const.CSS_URL}upload.css" />   
    <style>
        .btn-box{
            position:relative;
        }
        .search-section{
            width:41%;
            height:auto;
            position:absolute;
            left:59%;
            background-color:rgba(0, 0, 0, 0.4);
            border:1px solid #ccc;
            z-index:1;
            padding-left:5px;
             padding-right:5px;
        }
        .clearfix{
            margin-top:5px;
        }  
    </style> 

    <script src="{$Think.const.BOOTSTRAP_URL}angular-file-upload/angular-file-upload.min.js"></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-rangy.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular-sanitize.min.js'></script>
    <script src='{$Think.const.BOOTSTRAP_URL}textAngular/textAngular.min.js'></script>
    <script>
        var userid = "{$userid}";
        var projectids = '{$project_ref_auth}'
        var _appid = "{$appid}";
        var _authappid = "{$authappid}";
    </script>
</block>
<block name="pageContent">
    <main class="js-canvi-content canvi-content">
        <div class="col-xs-12">
            <!--操作区域-->
            <div class="btn-box">
                <page-btn></page-btn>&nbsp;
                <a class="display" ng-click="selectprotect()">查看受保护项目</a>&nbsp;&nbsp;
                <a class="display" ng-click="selectclose()">查看已关闭项目</a>
                <!--展示检索条件区域-->
                <div class="search-box">
                    <span class="display" ng-if="iffunnel()" ng-click="selectfunnel()">进入销售漏斗页面</span>&nbsp;
                    <span class="display" ng-click="search=!search"><span ng-bind="search?'隐藏':'点击'"></span>根据条件检索</span>&nbsp;
                    <span class="input-search"> 
                        <input type="text" placeholder="标题检索 ..." class="search-input" ng-model="filtername">
                        <i class="fa fa-search search-icon"></i>
                    </span>
                </div>
                <div class="search-section toggle clearfix"  ng-show="search">
                    <div class="text-right" style="border-bottom:1px solid #fff;"><b style="cursor:pointer;padding:8px 3px; color:#fff;" ng-click="search=false;"><i class="fa fa-close"></i></b></div>
                    <!--展示检索条件区域-->   
                    <div class="clearfix">
                        <ui-select multiple ng-model="service.refcustomer" on-select="addTags('refcustomers', $item)" >
                            <ui-select-match placeholder="下拉检索客户" ng-bind=""></ui-select-match>
                            <ui-select-choices repeat="person.value as (key, person) in selectCustomerinfoData | filter: { value: { name: $select.search }} track by $index">
                                <div ng-bind-html="person.value.name | highlight: $select.search" title="{{person.value.name}}"></div>
                            </ui-select-choices>
                        </ui-select>                      
                    </div>
                    <div class="clearfix">                       
                        <ui-select multiple ng-model="service.citydata" on-select="addTags('city', $item)"  >
                            <ui-select-match placeholder="检索产品使用地" ng-bind=""></ui-select-match>
                            <ui-select-choices repeat="person.value as (key, person) in service.privateDateObj.citykeyData | filter: { value: { province_name: $select.search }} track by $index">
                                <div ng-bind-html="person.value.province_name | highlight: $select.search" title="{{person.value.province_name}}"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="clearfix">
                        <!-- 时间插件 -->
                        <div>
                            <div style="float:left;width:180px;">
                                <p class="input-group">
                                    <input style="border-radius:0;" ng-click="open1()" type="text" class="form-control" current-text="今天" clear-text="清空" close-text="关闭" uib-datepicker-popup ng-model="service.start" ng-readonly="true" is-open="popup1.opened" datepicker-options="dateOptions1" ng-required="true" close-text="Close" />
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-sm btn-warning" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button>
                                    </span>
                                </p>
                            </div>
                            <span style="float:left;line-height:36px;margin:0 8px;color:#fff;">至</span>
                            <div style="float:left;width:180px;">
                                <p class="input-group">
                                    <input style="border-radius:0;" ng-click="open2()" type="text" class="form-control" current-text="今天" clear-text="清空" close-text="关闭" uib-datepicker-popup ng-model="service.end" ng-readonly="true" is-open="popup2.opened" datepicker-options="dateOptions2" ng-required="true" close-text="Close" />
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-sm btn-warning" ng-click="open2()"><i class="glyphicon glyphicon-calendar"></i></button>
                                    </span>
                                </p>
                            </div>

                        </div>                       
                    </div>
                    <div class="clearfix">
                        <select class="select" ng-model="status" ng-options="v.name for v in projectstatusData" ng-change="addTags('statusid');"><option value='' disabled selected style='display:none;' ng-selected="">检索状态</option> </select>
                        <select class="select" ng-model="user" ng-options="v.description for v in selectUserData" ng-change="addTags('user');"><option value='' disabled selected style='display:none;' ng-selected="">检索负责人</option> </select>
                    </div>
                    <div class="clearfix">
                        <span class="label left-5 label-info" ng-show="service.forecastmoney" ng-bind="'预计成交金额：'+service.forecastmoney"></span>
                    </div>
                    <div class="clearfix" style="margin-bottom:10px;">
                        <button class="btn btn-sm btn-info" style="margin-left: 8px; margin-top: 5px;" ng-click="selectwheretime()">查询</button>
                        <button class="btn btn-sm btn-warning" style="margin-left: 8px; margin-top: 5px;" ng-click="reduction()">还原</button>
                        <button class="btn btn-sm btn-success" style="margin-left: 8px; margin-top: 5px;" ng-click="forecast()">展示预测</button>
                    </div>
                </div>
                
                
                <div class="row">
                   
                </div>
            </div>
        </div>
        <!--表格展示区-->
        <div class="col-xs-12">
            <!--条件检索区-->
            <div class="col-xs-10">
                <span class="tag" ng-repeat="item in tagsData" ng-class="item.key">
                    <span ng-if="item.key=='statusid'" ng-bind="item.value.name"></span>
                    <span ng-if="item.key=='userid'" ng-bind="item.value.description"></span>
                    <span ng-if="item.key=='refcustomers'" ng-bind="item.value.name"></span>
                    <span ng-if="item.key=='city'" ng-bind="item.value.province_name"></span>
                    <button type="button" class="close" ng-click="removeTag(item)">×</button>
                </span>
            </div>
            <div class="col-xs-2">
                共<b class="blue" ng-if="service.privateDateObj.projectData" ng-bind="service.projectArrData.length"></b>条项目信息
                <!--<div ng-include="'__APP__/Crmbase/Baseinfo/setpaging'"></div>-->
            </div>
            <table class="table" ng-init="projectDataCount={count:0};orderName = '-createtime'" style="margin-bottom:2px;" >
                <thead>
                    <tr> 
                        <th style="width:5%;">序号</th>
                        <th style="width:12%;" class="mousehand" ng-click="orderName=(orderName=='name'?'-name':'name')">项目名称<i class="fa" ng-class="orderName=='name'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:7%;" class="mousehand" ng-click="orderName=(orderName=='userid'?'-userid':'userid')">负责人<i class="fa" ng-class="orderName=='userid'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:8%;" class="mousehand" ng-click="orderName=(orderName=='statusid'?'-statusid':'statusid')">当前阶段<i class="fa" ng-class="orderName=='statusid'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:7%;" class="mousehand" ng-click="orderName=(orderName=='grasp'?'-grasp':'grasp')">把握度<i class="fa" ng-class="orderName=='grasp'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th ng-if="false" style="width:9%;" class="mousehand" ng-click="orderName=(orderName=='integrate'?'-integrate':'integrate')">集成项目<i class="fa" ng-class="orderName=='integrate'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:9%;" class="mousehand" ng-click="orderName=(orderName=='createtime'?'-createtime':'createtime')">创建时间<i class="fa" ng-class="orderName=='createtime'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:11%;" class="mousehand">客户名称</th>
                        <th style="width:9%;" class="mousehand" ng-click="orderName=(orderName=='totalmoney'?'-totalmoney':'totalmoney')">项目金额(元)<i class="fa" ng-class="orderName=='totalmoney'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:10%;" class="mousehand" ng-click="orderName=(orderName=='contracttime'?'-contracttime':'contracttime')">预计结束时间<i class="fa" ng-class="orderName=='contracttime'?'fa-caret-up':'fa-caret-down'"></i></th>
                        <th style="width:10%;" class="mousehand">产品使用地</th>
                        <th style="width:12%;">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <!--ng-class="item.assignid==service.userid?'bg-pink-red':''" $scope.service.timeprojectData-->
                    <tr ng-repeat="(key,item) in service.projectArrData | orderBy:orderName |filterByAttr:filtername:projectDataCount track by $index" ng-init="getonlymoney(item)" class="profile-activity">
                        <td><span class="badge" ng-bind="key+1"></span></td>
                        <td>
                            <span>
                                <!-- 项目名称 -->
                                <a class="user" href="" ng-click="selectdetailed(item)" ng-bind="item.name"></a>
                            </span>
                        </td>
                        <td ng-init='buildUserdata(item)' ng-bind="service.privateDateObj.usersData[item.userid].description"></td>
                        <td><span ng-bind="service.privateDateObj.projectstatusData[item.statusid].name" class="label" style="background:{{ service .privateDateObj.projectstatusData[item.statusid].labelclass; }};"></span></td>
                        <td><span ng-bind="item.grasp"></span>%</td>
                        <td ng-if="false"><span class="label left-5" ng-class="item.integrate==0?'label-default':'label-info'" ng-bind="item.integrate == 0?'否':'是'"></span></td>
                        <td><span ng-bind="formatDate(item.createtime)"></span></td>
                        <td><span ng-bind="(item.customerinfoData?item.customerinfoData:service.privateDateObj.tempcustomerinfoData[item.refcustomers]).name" title="{{(item.customerinfoData?item.customerinfoData:service.privateDateObj.tempcustomerinfoData[item.refcustomers]).name}}"></span></td>
                        <td ng-bind="item.totalmoney | currency:'￥':0"></td>
                        <td><span ng-bind="formatDate(item.contracttime)"></span></td>
                        <td ng-bind="getcityData(item.city)"></td>
                        <td>
                            <a href="javascript:;" ng-click="selectdetailed(item)" title="详细" class="btn btn-xs green"><i class="ace-icon fa fa-search"></i>&nbsp;详细</a>
                            <a href="javascript:;" ng-if="item.userid==service.userid" ng-click="close(item)" title="关闭项目" class="btn btn-xs"><i class="ace-icon fa fa-close "></i>&nbsp;关闭项目</a>
                            <a href="javascript:;" ng-if="service.refedit && item.userid==service.userid" ng-click="updateInfo(item)" title="修改" class="btn btn-xs green"><i class="ace-icon fa fa-pencil "></i>&nbsp;修改</a>
                            <a href="javascript:;" ng-if="service.refdel && item.userid==service.userid" ng-click="remove(item)" class="btn btn-xs  green"><i class="ace-icon fa fa-times"></i>&nbsp;删除</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!--<div class="text-right footer"><a href="javascrip:;">页面分页栏</a></div>-->
    </main>
    <!--增加修改模态框-->
    <aside class="projectmodaltemplate canvi-navbar">
        <div class="canvi-user-info">
            <div class="canvi-user-info__image">
                <img src="{$Think.const.APP_PUBLIC}win10-ui/img/icon/diary.png">
            </div>
            <div class="canvi-user-info__data">
                <span class="canvi-user-info__title" ng-bind="projectModal.title"></span>
                <!--<a href="#" class="canvi-user-info__meta">XXXX编辑</a>-->
                <div class="canvi-user-info__close" ng-click="projectModal.toggle();"></div>
            </div>
        </div>
       
       <form name="Form" class="container-fluid" verify-scope="">
                <table class="table" style="margin-bottom:8px;">
                    <tr class="info">
                        <td colspan="8">基本信息</td>
                    </tr>
                    <tr>
                        <td class="text-right"><b class="c-red">*</b>项目名称</td>
                        <td colspan="3" class="project-name">
                            <input type="text" ng-verify="min:1, max:40" style="width:100%" class="form-control"
                                   ng-model="selectItem.name" id="protected" ng-change="isprotect()"
                                   ng-blur="isprojectblur = false"
                                   ng-focus="isprojectblur = true" placeholder="输入1~40位字符名称" />
                            <ul ng-show="Action==0 && selectItem.name && isprojectblur">
                                <li ng-repeat="value in service.privateDateObj.isprojectData |filter:selectItem.name">
                                    [<span ng-bind="value.name;"></span>]:项目已有<span class="red" ng-bind="service.privateDateObj.usersData[value.userid].description;"></span>创建
                                </li>
                                <!--+'--'+service.privateDateObj.usersData[value.userid].description-->
                            </ul>
                        </td>
                        <td class="text-right">集成项目</td>
                        <td colspan="3">
                            <input type="checkbox" ng-model='selectItem.integrate' />是
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right"><b class="c-red">*</b>当前阶段</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.statusid" ng-verify="option:0">
                                <ui-select-match placeholder="请选择项目阶段">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.projectstatusData | filter: { value: { name: $select.search }}" style="max-height: 150px;">
                                    <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </td>
                        <td class="text-right"><b class="c-red">*</b>项目把握度</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.grasp" ng-verify="option:0">
                                <ui-select-match placeholder="请选择项目把握度">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.projectgraspData | filter: { value: { name: $select.search }}" style="max-height: 150px;">
                                    <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right"><b class="c-red">*</b>预计合同时间</td>
                        <td colspan="3">
                            <div class="width:100%">
                                <p class="input-group">
                                    <input style="border-radius:0;" ng-click="open()" type="text" current-text="今天" clear-text="清空" close-text="关闭" uib-datepicker-popup ng-model="dt" class="form-control" ng-readonly="true" is-open="popup.opened" datepicker-options="dateOptions" ng-required="true" close-text="Close" ng-verify="{min:1,max:10}" />
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-default" ng-click="open()"><i class="glyphicon glyphicon-calendar"></i></button>
                                    </span>
                                </p>
                            </div>
                        </td>
                        <td class="text-right">项目保护</td>
                        <td colspan="3">
                            <input type="checkbox" ng-model="selectItem.isprotected"/>是
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right"><b class="c-red">*</b>客户</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.refcustomers" on-select="selectContact(1)" ng-verify="option:0">
                                <ui-select-match placeholder="请选择客户">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in service.privateDateObj.customerinfoData | filter: { value: { name: $select.search }}" style="max-height: 150px;">
                                    <div ng-bind-html="item.value.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </td>
                        <td class="text-right"><b class="c-red"></b>关联商机</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.refclue">
                                <ui-select-match placeholder="请选择商机">
                                    <span ng-bind="$select.selected.value.customername" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in service.projectRefcluedata | filter: { value: { customername: $select.search }}" style="max-height: 150px;">
                                    <div ng-bind-html="item.value.customername | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">重要联系人</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.refinformant">
                                <ui-select-match placeholder="请选择重要联系人">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in selectcontactData | filter: { value: { name: $select.search }} " style="max-height: 150px;">
                                    <span ng-bind-html="item.value.name | highlight: $select.search"></span>
                                    &nbsp;(职位：<span ng-bind="item.value.position"></span> &nbsp;联系方式：<span ng-bind="item.value.mobilephone"></span>)
                                </ui-select-choices>
                            </ui-select>
                        </td>
                        <td class="text-right">使用者</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.refusing">
                                <ui-select-match placeholder="请选择使用者">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in selectcontactData | filter: { value: { name: $select.search}}" style="max-height: 150px;">
                                    <span ng-bind-html="item.value.name | highlight: $select.search"></span>
                                    &nbsp;(职位：<span ng-bind="item.value.position"></span> &nbsp;联系方式：<span ng-bind="item.value.mobilephone"></span>)
                                </ui-select-choices>
                            </ui-select>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">技术把关者</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.reftechnical">
                                <ui-select-match placeholder="请选择技术把关者">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key as (key,item) in selectcontactData | filter: { value: { name: $select.search }}" style="max-height: 150px;">
                                    <span ng-bind-html="item.value.name | highlight: $select.search"></span>
                                    &nbsp;(职位：<span ng-bind="item.value.position"></span> &nbsp;联系方式：<span ng-bind="item.value.mobilephone"></span>)
                                </ui-select-choices>
                            </ui-select>
                        </td>
                        <td class="text-right">决策者</td>
                        <td colspan="3">
                            <ui-select style="width:100%" ng-model="selectItem.refdecision">
                                <ui-select-match placeholder="请选择决策者">
                                    <span ng-bind="$select.selected.value.name" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.key  as (key,item) in selectcontactData | filter: { value: { name: $select.search }} " style="max-height: 150px;">
                                    <span ng-bind-html="item.value.name | highlight: $select.search"></span>
                                    &nbsp;(职位：<span ng-bind="item.value.position"></span> &nbsp;联系方式：<span ng-bind="item.value.mobilephone"></span>)
                                </ui-select-choices>
                            </ui-select>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right"><b class="c-red">*</b>产品决策地                  
                        </td>
                        <td colspan="3">
                            <div style="width:45%;display:inline-block;">
                                <ui-select ng-model="selectItem.__decisionprovince" ng-verify="option:0"
                                           style="width:100%;"
                                           on-select="selectdecision(1);">
                                    <ui-select-match>
                                        <span ng-bind="$select.selected.value.province_name">
                                        </span>
                                    </ui-select-match>
                                    <ui-select-choices repeat="item.value.id as (key,item) in service.privateDateObj.citykeyData | filter: { value: { province_name: $select.search }}">
                                        <div ng-bind="item.value.province_name"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                            <div style="width:45%;display:inline-block;margin-left:10px;" ng-if="selectItem.__decisionprovince &&selectItem.__decision">
                                <ui-select ng-model="selectItem.__decision" style="width:100%;" on-select="selectItem.decisioncity = selectItem.__decisionprovince + selectItem.__decision">
                                    <ui-select-match>
                                        <span ng-bind="$select.selected.value.city">
                                        </span>
                                    </ui-select-match>

                                    <ui-select-choices repeat="item.value.id as (key,item) in service.privateDateObj.citykeyData[selectItem.__decisionprovince]['city']| filter: { value: { city: $select.search }}">
                                        <div ng-bind="item.value.city"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </td>
                        <td class="text-right"><b class="c-red">*</b>产品使用地              
                        </td>
                        <td colspan="3">
                            <div style="width:45%;display:inline-block;">
                                <ui-select ng-model="selectItem.__province" ng-verify="option:0"
                                           on-select="selectdecision(2);" style="width:100%;">
                                    <ui-select-match>
                                        <span ng-bind="$select.selected.value.province_name">
                                        </span>
                                    </ui-select-match>
                                    <ui-select-choices repeat="item.value.id as (key,item) in service.privateDateObj.citykeyData | filter: { value: { province_name: $select.search }}">
                                        <div ng-bind="item.value.province_name"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                            <div style="width:45%;display:inline-block;margin-left:10px;" ng-if="selectItem.__province && selectItem.__citylevel">
                                <ui-select ng-model="selectItem.__citylevel" style="width:100%;" on-select="selectItem.city = selectItem.__province + selectItem.__citylevel">
                                    <ui-select-match>
                                        <span ng-bind="$select.selected.value.city">
                                        </span>
                                    </ui-select-match>
                                    <ui-select-choices repeat="item.value.id as (key,item) in service.privateDateObj.citykeyData[selectItem.__province]['city']| filter: { value: { city: $select.search }}">
                                        <div ng-bind="item.value.city"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </td>
                    </tr>
                    <tr class="info" ng-init="total=0" ng-if="Action>-1">
                        <td colspan="8"><span>关联产品(<b style="color:red;"> * 必填</b>)</span><button type="button" ng-click="addProductlist()" class="btn btn-xs btn-success f-r">新增产品</button>
                        <span class="f-r" style="padding-right:10px;">当前总价<b ng-bind="totalmoney|currency:'￥':'0'"></b></span></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td >产品名称</td>
                        <td colspan="2">产品型号</td>
                        <td>数量</td>
                        <td>列表价（元）</td>
                        <td>总价（元）</td>
                        <td>操作</td>
                    </tr>
                    <tbody class="project-tr" ng-repeat="item in selectItem.__refprojectdevicelist"  ng-if="!item.__delelte&&!item.__deleted">
                        <tr>
                            <td>
                                <span ng-bind="$index+1"></span>
                            </td>
                            <td><span ng-bind="service.privateDateObj.productData[service.privateDateObj.productmodelData[item.productmodelid].productid].name"></span></td>
                            <td colspan="2" style="width:35%">
                                <ui-select style="width:100%;" ng-model="item.productmodelid" ng-verify 
                                           on-select="item.__update = true;item.money = item.number * service.privateDateObj.productmodelData[item.productmodelid].plist; item.number = (item.number ? item.number : 1); submoney()">
                                    <ui-select-match>
                                        <span ng-bind="$select.selected.value.name">
                                        </span>
                                    </ui-select-match>
                                    <ui-select-choices group-by="'productid'" repeat="val.value.idproductmodel as (key,val) in service.privateDateObj.productmodelData | filter: { value: { name: $select.search }}">
                                        <div ng-bind-html="val.value.name| highlight: $select.search"></div>
                                        <small>
                                            <span style="color:#666" ng-bind-html="'&nbsp;&nbsp;'+service.privateDateObj.productData[val.value.productid].name | highlight: $select.search"></span>
                                        </small>
                                    </ui-select-choices>
                                </ui-select>
                            </td>

                            <td style="">
                                <input type="text" ng-model="item.number" ng-verify style="width:50px;" onkeyup=" if (this.value.length == 1) { this.value = this.value.replace(/[^1-9]/g, '') } else { this.value = this.value.replace(/\D/g, '') }" onafterpaste="    if (this.value.length == 1) { this.value = this.value.replace(/[^1-9]/g, '') } else { this.value = this.value.replace(/\D/g, '') }"
                                       ng-keyup="item.__update = true;item.money=item.number*service.privateDateObj.productmodelData[item.productmodelid].plist;submoney()" />
                            </td>
                            <td style="">
                                <span ng-bind="service.privateDateObj.productmodelData[item.productmodelid].plist|currency:'￥':'0'"></span>
                            </td>
                            <td style="">
                                <input type="text" ng-verify ng-model="item.money" onkeyup="if (this.value.length == 1) { this.value = this.value.replace(/[^1-9]/g, '') } else { this.value = this.value.replace(/\D/g, '') }" onafterpaste="    if (this.value.length == 1) { this.value = this.value.replace(/[^1-9]/g, '') } else { this.value = this.value.replace(/\D/g, '') }"
                                       ng-keyup="item.__update = true;submoney();" />
                            </td>
                            <td style="">
                                <button class="btn  btn-xs btn-warning" type="button" ng-click="delProductlist(item);submoney()"><i class="fa fa-trash"></i></button>
                            </td>
                        </tr>
                        <tr><td colspan="8"><span ng-bind="service.privateDateObj.productmodelData[item.productmodelid].description"></span></td></tr>
                    </tbody>
                    <tr class="info">
                        <td colspan="8">其他信息</td>
                    </tr>
                    <tr>
                        <td class="text-right">项目备注</td>
                        <td colspan="7">
                            <textarea style="width:100%;" class="form-control" ng-model="selectItem.mark"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">抄送人</td>
                        <td colspan="7">
                            <ui-select multiple ng-model="selectItem.refusers" theme="select2" style="width:100%;">
                                <ui-select-match placeholder="请选择抄送">
                                    <span ng-bind="$item.value.description" style="margin-right: 5px;">
                                    </span>
                                </ui-select-match>
                                <ui-select-choices repeat="item.value.idusers  as (key,item) in service.privateDateObj.usersData | filter: { value: { description: $select.search }}" style="max-height: 150px;">
                                    <div ng-bind-html="item.value.description | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">附件</td>
                        <td colspan="7">
                            <label>请选择文件：<!--<small ng-hide="service.uploadannex" class="small-tip red">只支持.xlsx格式、docx格式或图片等文件上传</small>--> </label>
                            <div class="choose-file-area">
                                <div class="blue" ng-repeat="idannex in selectItem.refannexs.split(',') track by $index">
                                        <span title="点击下载" ng-click="downLoad(idannex)" style="font-weight: normal; cursor: pointer;" ng-bind="service.privateDateObj.annexData[idannex].name"></span>
                                        <span style="font-weight:normal" ng-if="selectItem.refannexs.spilt(',').length>0&&($index+1)<selectItem.refannexs.spilt(',').length">；</span>
                                </div>
                                <span  ng-bind="filename"></span>
                                <a href="javascript:;" class="btn btn-sm btn-success choose-book" ng-show="selectfile">
                                    <input type="file" name="fileaddress" accept="application/msexcel" nv-file-select uploader="uploader" ng-click="uplodefile()" />
                                    浏览
                                </a>
                                <input type="button" ng-show="uploadfile" class="btn btn-primary btn-sm" ng-click="UploadFile()" value="上传" />
                            </div>
                        </td>
                    </tr>
                </table>
            </form>
        
        <div class="col-xs-12 text-right">
            <button class="btn btn-primary btn-sm" ng-disabled="saveone" ng-verify="control:'Form'" title="请检查数据是否正确填写！" type="button" ng-click="savetip();">
                保存
            </button>
            <button class="btn btn-warning btn-sm" type="button" ng-click="projectModal.toggle();">取消</button>
        </div>
    </aside>
    <!--关闭项目模态框-->
    <aside class="projectdetailtemplate canvi-navbar">
        <div class="canvi-user-info">
            <div class="canvi-user-info__image">
                <img src="{$Think.const.APP_PUBLIC}win10-ui/img/icon/diary.png">
            </div>
            <div class="canvi-user-info__data">
                <span class="canvi-user-info__title" ng-bind="projectdetailModal.title"></span>
                <!--<a href="#" class="canvi-user-info__meta">XXXX编辑</a>-->
                <div class="canvi-user-info__close" ng-click="projectdetailModal.toggle();"></div>
            </div>
        </div>

        <form name="Form" class="container-fluid" verify-scope="">
            <table class="table" style="margin-bottom:8px;">
                <tr>
                    <td class="text-right">项目名称</td>
                    <td colspan="3" class="project-name" ng-bind="selectItem.name"></td>
                </tr>
                <tr>
                    <td class="text-right"><b class="c-red">*</b>选择类型</td>
                    <td colspan="3" class="project-name">
                        <select ng-model="closetypevalue" class="form-control" ng-options="value.name for (key,value) in service.privateDateObj.closetypeData" ng-selected="value.id == 0"></select>
                    </td>
                </tr>
                <tr>
                    <td class="text-right"><b class="c-red">*</b>项目备注</td>
                    <td colspan="3" class="project-name">
                        <!-- 加载编辑器的容器 -->
                        <script class="col-xs-10" style="padding: 0px;" id="detailcontainer" name="content" type="text/plain">
                        </script>
                    </td>
                </tr>
            </table>
        </form>

        <div class="col-xs-12 text-right">
            <button class="btn btn-primary btn-sm" type="button" title="请检查数据是否正确填写！" ng-click="saveclose();">
                保存
            </button>
            <button class="btn btn-warning btn-sm" type="button" ng-click="projectdetailModal.toggle();">取消</button>
        </div>
    </aside>
</block>
<block name="scriptTemplate">
</block>
<block name="footjs">
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmproject/Project/index.js?v={$Think.const.CRM_VERSION}"></script>
    <script type="text/javascript" src="{$Think.const.JS_URL}directive.pagebtn.js"></script>
    <script type="text/javascript" src="{$Think.const.PAGE_URL}js/Crmproject/Project/uploadBtn.js"></script>
    <!-- 配置文件 -->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <script type="text/javascript" src="{$Think.const.BOOTSTRAP_URL}ueditor/1.4.3.3/ueditor.all.js"></script>
    <script type="text/javascript" src="{$Think.const.JS_URL}directive.pagecomment.js"></script>
</block>
​